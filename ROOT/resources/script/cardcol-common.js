var bTypes=[["A","业务"],["B","流程"]];Ext.apply(Ext.form.field.VTypes,{password:function(c,b){if(b.initialPassField){var a=b.up("form").down("#"+b.initialPassField);return(c==a.getValue())}return true},passwordText:"两次密码输入不一致！",daterange:function(d,c){var b=c.parseDate(d);if(!b){return}if(c.startDateField&&(!this.dateRangeMax||(b.getTime()!=this.dateRangeMax.getTime()))){var e=Ext.getCmp(c.startDateField);e.setMaxValue(b);e.validate();this.dateRangeMax=b}else{if(c.endDateField&&(!this.dateRangeMin||(b.getTime()!=this.dateRangeMin.getTime()))){var a=Ext.getCmp(c.endDateField);a.setMinValue(b);a.validate();this.dateRangeMin=b}}return true}});Ext.define("Ext.ux.TextField",{extend:"Ext.form.field.Text",alias:"widget.text",requires:["*"],alternateClassName:["Ext.ux.TextField","Ext.ux.Text"],initComponent:function(){var a=this;a.callParent()}});Ext.define("Ext.ux.DateField",{extend:"Ext.form.field.Date",alias:"widget.date",requires:["*"],alternateClassName:["Ext.ux.DateField","Ext.ux.Date"],format:"Y-m-d",initComponent:function(){var a=this;a.callParent()},setValue:function(b){var a=this;if(Ext.isString(b)){b=b.substring(0,10)}a.callParent(arguments);return a}});Ext.define("Ext.ux.NumberField",{extend:"Ext.form.field.Number",alias:"widget.number",initComponent:function(){var a=this;a.callParent()}});Ext.define("Ext.ux.MailField",{extend:"Ext.ux.TextField",alias:"widget.mail",mailTitle:"Data Input Error",mailText:"this input value is not match a Standard Email Format for {0}",mailTest:/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/,initComponent:function(){var a=this;a.callParent()}});Ext.define("Ext.ux.TellField",{extend:"Ext.ux.TextField",alias:"widget.tell",tellTitle:"Data Input Error",tellText:"this input value is not match a Standard Tell Format for {0}",tellTest:/^\d{2,4}-\d{7,8}|-\d{1,5}$/,initComponent:function(){var a=this;a.callParent()}});Ext.define("Ext.ux.JsonStore",{extend:"Ext.data.JsonStore",alias:"widget.mystore",constructor:function(a){a=Ext.apply({proxy:{type:"ajax",reader:{type:"json",root:a.root||"items",idProperty:a.idProperty||"id"},writer:"json",url:a.loadUrl},fields:a.bean||["id","code","name","desc"],autoLoad:a.autoLoad||true},a);this.callParent([a])}});Ext.define("Ext.ux.Grid",{extend:"Ext.grid.Panel",requires:["*"],alias:"widget.mygrid",listUrl:"",bean:[],border:false,frame:false,gridEdit:false,pageSize:20,hasPage:true,params:{},initComponent:function(){var a=this;a.columnLines=true;if(a.gridEdit===true){a.plugins=[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})]}if(!a.store){a.store=Ext.create("Ext.data.JsonStore",{storeId:a.id+"sotre",pageSize:a.pageSize,remoteSort:true,autoLoad:true,autoSync:false,autoDestroy:true,proxy:{type:"ajax",url:a.listUrl,reader:{type:"json",root:"items",totalProperty:"results"},actionMethods:{read:"POST"}},fields:a.bean})}a.store.on("beforeload",a.onBeforeLoad,a);if(a.hasPage===true){a.bbar=Ext.create("Ext.PagingToolbar",{store:a.store,displayInfo:true})}a.selModel=Ext.create("Ext.selection.RowModel",{mode:"MULTI"});a.fieldId=a.id;a.id=a.id+"grid";a.callParent()},onBeforeLoad:function(a,c,b){Ext.apply(a.proxy.extraParams,this.params)},setValues:function(d){var c=this,a=c.getStore();a.removeAll();for(var b=0;b<d.length;b++){a.add(d[b])}},getValues:function(h){var g=this,c=g.getStore().getModifiedRecords(),f="",a=c.length,e,b;for(var d=0;d<c.length;d++){b=Ext.JSON.encode(c[d].data);f+=b+(d<a-1?",":"")}f="["+f+"]";return f}});Ext.define("Ext.ux.Combox",{extend:"Ext.form.field.ComboBox",alternateClassName:"",alias:"widget.combox",triggerAction:"all",queryMode:"local",typeAhead:true,allowBlank:false,loadUrl:"",bean:null,root:"items",idProperty:"id",valueField:"id",displayField:"name",initComponent:function(){var a=this;if(!a.store){if(!a.data){a.store=Ext.create("Ext.data.Store",{proxy:{type:"ajax",url:a.loadUrl,reader:{type:"json",root:a.root,idProperty:a.idProperty}},fields:a.bean||["id","code",a.displayField,"desc"],autoLoad:true})}else{a.store=Ext.create("Ext.data.ArrayStore",{fields:[{type:"string",name:"id"},{type:"string",name:"code"},{type:"string",name:a.displayField}],data:a.data})}}a.callParent()}});Ext.define("Ext.ux.TextArea",{extend:"Ext.form.field.TextArea",alternateClassName:"",alias:"widget.mytextarea",initComponent:function(){var a=this;a.callParent()}});Ext.define("Ext.ux.GridField",{extend:"Ext.form.FieldContainer",alias:"widget.gridfield",columns:null,listUrl:null,deleUrl:null,hasRow:true,bean:[],gridEdit:true,pageSize:20,hasPage:false,initComponent:function(){var a=this;a.initial();a.grid=Ext.create("Ext.grid.Panel",{store:{xtype:"json",remoteSort:true,autoLoad:false,autoSync:false,autoDestroy:true,proxy:{type:"ajax",url:a.listUrl,reader:{type:"json",root:"items",totalProperty:"results"}},fields:a.bean},border:true,columns:a.columns,columnLines:true,height:a.height,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],bbar:[{xtype:"button",text:"新增",iconCls:"x-button-add",handler:a.onAddData,scope:a},{xtype:"button",text:"删除",iconCls:"x-button-delete",handler:a.onDelete,scope:a}]});a.items=[a.grid];a.callParent()},initial:function(){var a=this;if(a.hasRow===true){a.columns=[{xtype:"rownumberer",width:30}].concat(a.columns)}},onAddData:function(){var a=this;a.grid.getStore().add({})},onDelete:function(){var d=this,a=d.grid.getSelectionModel().getSelection();if(a.length==0){Ext.Msg.alert("提示","请先选择需要删除的数据再进行删除！");return}var c="";for(var b=0;b<a.length;b++){c+="ids="+a[b].get("id")+"&"}Ext.Ajax.request({url:d.deleUrl,method:"post",params:c,waitMsg:"请稍候，正在删除数据......",success:function(f){var e=Ext.JSON.decode(f.responseText);if(e.success==true){Ext.Msg.alert("提示","当前所有选择的数据已经成功删除！");d.grid.getStore().reload()}else{Ext.Msg.alert("提示","数据删除出错，可能的原因为："+e.message)}}})},reload:function(a){var b=this;b.grid.store.proxy.extraParams={id:a};b.grid.store.load()},getValue:function(){var d=this,e=d.grid.getStore().getModifiedRecords();var a="",f,b;if(e.length>0){for(var c=0;c<e.length;c++){f=e[c];b=Ext.JSON.encode(f.data);a=a+(a==""?"":",")+b}a="{data:["+a+"]}"}return a},setValue:function(a){},getStore:function(){return this.grid.getStore()}});Ext.override(Ext.data.TreeStore,{load:function(a){a=a||{};a.params=a.params||{};var c=this,b=a.node||c.tree.getRootNode();if(!b){b=c.setRootNode({expanded:true},true)}a.id=b.getId();if(c.clearOnLoad){b.removeAll(false)}Ext.applyIf(a,{node:b});a.params[c.nodeParam]=b?b.getId():"root";if(b){b.set("loading",true)}return c.callParent([a])}});Ext.define("Ext.ux.TreeEx",{extend:"Ext.tree.Panel",alias:"widget.tree",requires:["*"],alternateClassName:["Ext.ux.Tree"],async:false,loadUrl:"",rootVisible:false,fields:null,useArrows:true,collapseMode:"header",childs:[],initComponent:function(){var a=this;a.animate=true;a.stateful=true;a.stateId=a.id;a.autoScroll=true;if(a.async===true){a.store=Ext.create("Ext.data.TreeStore",{autoSync:false,autoLoad:true,proxy:{type:"ajax",url:a.loadUrl},root:{text:"tree",id:"0",expanded:true},fields:a.fields||[{name:"id",type:"string"},"text","type","code"],folderSort:false})}else{Ext.Ajax.request({url:a.loadUrl,async:false,method:"post",success:function(b){a.childs=Ext.JSON.decode(b.responseText)}});a.store=Ext.create("Ext.data.TreeStore",{root:{expanded:true,id:"0",text:"tree",children:a.childs},fields:a.fields||[{name:"id",type:"string"},"text","type","code"]})}a.lines=true;a.split=true;a.on("checkchange",a.checkChanged,a);a.callParent()},addNode:function(b){var a=this;a.getRootNode().appendChild(b)},checkChanged:function(c,b){var d=c.parentNode,a=this;if(d!==null){a.parentCheck(d,b)}a.checkRecursion(c,b)},checkRecursion:function(c,b){var a=this;if(!c.isExpanded()){c.expand()}c.set("checked",b);c.eachChild(function(d){a.checkRecursion(d,b)},a)},parentCheck:function(f,e){var d=this,c=false;if(e===false){for(var b=0;b<f.childNodes.length;b++){if(f.childNodes[b].data.checked===true){c=true;break}}}if(c===false){f.set("checked",e);var a=f.parentNode;if(a!==null){d.parentCheck(a,e)}}},childHasChecked:function(a){a.eachChild(function(b){return b.data.checked});return false},setChecked:function(a){if(a==""||a==","){return}var b=this;b.clearAll(b.getRootNode());b.setValue(b.getRootNode(),","+a)},setValue:function(c,a){var d=c.get("id"),b=this;c.expand(true);if(a.indexOf(","+d+",")!==-1){c.set("checked",true)}c.eachChild(function(e){b.setValue(e,a)},b)},clearAll:function(b){var a=this;b.set("checked",false);b.eachChild(function(c){a.clearAll(c)},a)},getCheckedForStr:function(){var b=this,a=b.getValueForStr(b.getRootNode());return a},getValueForStr:function(c){var a="",b=this;c.eachChild(function(f){var e=f.get("type"),d=parseInt(f.get("id"));if(f.data.checked===true){a+=d+","+b.getValueForStr(f)}else{a+=b.getValueForStr(f)}},b);return a},getChecked:function(){var b=this,a=b.getValue(b.getRootNode());return a},getValue:function(c){var a="",b=this;c.eachChild(function(f){var e=f.get("type"),d=parseInt(f.get("id"));if(f.data.checked===true){a+="<"+e+' id="'+d+'">'+b.getValue(f)+"</"+e+">"}else{a+=b.getValue(f)}},b);return a}});Ext.define("Ext.ux.form.CKEditor",{extend:"Ext.form.field.TextArea",alias:"widget.ckeditor",CKConfig:{},onRender:function(b,a){if(!this.el){this.defaultAutoCreate={tag:"textarea",autocomplete:"off"}}this.callParent(arguments);this.CKConfig.toolbar="Standard";this.CKConfig.filebrowserUploadUrl="upload"+Ext.ACTION_SUFFIX+"?type=File";this.CKConfig.filebrowserImageUploadUrl="upload"+Ext.ACTION_SUFFIX+"?type=Image";this.CKConfig.filebrowserFlashUploadUrl="upload"+Ext.ACTION_SUFFIX+"?type=Flash";this.editor=CKEDITOR.replace(this.inputEl.id,this.CKConfig)},setValue:function(a){this.callParent(arguments);if(this.editor){this.editor.setData(a)}},getValue:function(){if(this.editor){this.editor.updateElement();return this.editor.getData()}else{return""}},getRawValue:function(){if(this.editor){this.editor.updateElement();return this.editor.getData()}else{return""}},onDestroy:function(){if(CKEDITOR.instances[this.inputEl.id]){delete CKEDITOR.instances[this.inputEl.id]}}});Ext.define("Ext.ux.CKEditorField",{extend:"Ext.form.FieldContainer",alias:"widget.ckfield",requires:["*"],winTitle:"描述",winWidth:880,winHeight:500,initComponent:function(){this.content=Ext.create("Ext.panel.Panel",{autoScroll:true,border:true,frame:false,tbar:[{text:"修改",iconCls:"x-button-edit",handler:this.open,scope:this},{text:"清空",iconCls:"x-button-reset",handler:this.clean,scope:this}],height:this.height-10,html:""});if(this.hiddenName){this.hiddenField=Ext.create("Ext.form.field.Text",{inputType:"hidden",name:this.hiddenName})}this.items=[this.content,this.hiddenField];this.callParent()},getValue:function(){return this.hiddenField.getValue()},setValue:function(a){this.content.update(a);this.hiddenField.setValue(a)},reset:function(){this.content.update("");this.hiddenField.value=""},open:function(){var a=this.hiddenField.value;this.ckeditor=Ext.create("Ext.ux.form.CKEditor",{value:a,anchor:"100% 100%",CKConfig:{width:"100%",height:350}});this.window=Ext.create("Ext.window.Window",{title:this.winTitle,width:this.winWidth,height:this.winHeight,closeAction:"destroy",bodyStyle:"padding:0px",plain:true,modal:false,items:{xtype:"form",frame:true,border:true,baseCls:"x-plain",layout:"fit",defaultType:"textfield",items:[this.ckeditor]},layout:"fit",buttonAlign:"center",buttons:[{text:"确定",scope:this,handler:this.onRel},{text:"关闭",handler:this.onClose,scope:this}]});this.window.show();this.ckeditor.setValue(a)},clean:function(){this.content.update("");this.hiddenField.setValue("")},onRel:function(){var a=this.ckeditor.getValue();this.hiddenField.setValue(a);this.content.update(a);this.onClose()},onClose:function(){this.window.destroy();this.window=null},setReadOnly:function(a){this.readOnly=a},isDirty:function(){var a=false;if(this.rendered&&!this.disabled){this.items.each(function(b){if(b.isDirty()){a=true;return false}})}return a},onDisable:function(){this.delegateFn("disable")},onEnable:function(){this.delegateFn("enable")},validateValue:function(){return true},delegateFn:function(a){this.items.each(function(b){if(b[a]){b[a]()}})},beforeDestroy:function(){Ext.destroy(this.window);this.callParent(arguments)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.define("Ext.ux.TreeField",{extend:"Ext.form.FieldContainer",alias:"widget.treefield",loadUrl:"",async:false,fields:null,initComponent:function(){var a=this;a.tree=Ext.create("Ext.ux.TreeEx",{loadUrl:a.loadUrl,async:a.async,fields:a.fields,height:a.height});a.items=[a.tree];a.callParent()},checkChanged:function(a){this.tree.checkChanged(this.tree.getRootNode(),a)},setChecked:function(a){this.tree.setChecked(a)},getCheckedForStr:function(){return this.tree.getCheckedForStr()},setValue:function(a){this.tree.setChecked(a)},getValue:function(){return this.tree.getCheckedForStr()},getChecked:function(){return this.tree.getChecked()}});Ext.define("Ext.ux.EditForm",{extend:"Ext.form.Panel",requires:["*"],alias:"widget.editform",fields:[],layouts:{},frame:true,border:false,fieldDefaults:{labelAlign:"right",msgTarget:"side",labelWidth:80,anchor:"100%"},defaultType:"textfield",initComponent:function(){var a=this;a.layout=a.layouts;if(a.layouts.type==="table"){}a.items=a.fields;a.callParent()},loadData:function(a){var b=this;for(var d in a){var c=b.getForm().findField(d);if(c){c.setValue(a[d]);if(b.getForm().trackResetOnLoad){c.resetOriginalValue()}}}}});Ext.define("Ext.ux.ColorField",{extend:"Ext.form.field.Picker",alias:"widget.colorfield",requires:["Ext.picker.Color"],initComponent:function(){var a=this;a.hiddenField=Ext.create("Ext.form.field.Hidden",{id:a.hiddenName,name:a.hiddenName});a.callParent();a.on("afterrender",function(){a.ownerCt.add(a.hiddenField)},this)},createPicker:function(){var a=this;a.picker=Ext.create("Ext.picker.Color",{hidden:true,floating:true,focusOnToFront:true,shadow:true,ownerCt:a.ownerCt});a.picker.on("select",a.onSelect,a);return a.picker},alignPicker:function(){var d=this,c,b,a="-above";if(d.isExpanded){c=d.getPicker();if(d.matchFieldWidth){c.setWidth(d.bodyEl.getWidth())}if(c.isFloating()){c.alignTo(d.inputEl,"",d.pickerOffset);b=c.el.getY()<d.inputEl.getY();d.bodyEl[b?"addCls":"removeCls"](d.openCls+a);c.el[b?"addCls":"removeCls"](c.baseCls+a)}}},onSelect:function(c,a,b){this.setValue("#"+a);this.collapse()},setValue:function(a){this.callParent(arguments);this.setFieldStyle("background: "+a)}});Ext.define("Ext.ux.ComboTree",{extend:"Ext.form.field.Picker",requires:["Ext.tree.Panel"],alias:"widget.combotree",loadUrl:"",rootId:0,rootText:"root",hiddenName:"",initComponent:function(){var a=this;a.hiddenField=Ext.create("Ext.form.field.Hidden",{id:a.hiddenName,name:a.hiddenName});a.callParent();a.on("afterrender",function(){a.ownerCt.add(a.hiddenField)},a)},createPicker:function(){var b=this;var a=Ext.create("Ext.data.TreeStore",{proxy:{type:"ajax",url:b.loadUrl},root:{id:b.rootId,text:b.rootText},fields:["id","text","type"]});b.picker=Ext.create("Ext.tree.Panel",{height:220,autoScroll:true,floating:true,focusOnToFront:false,shadow:true,ownerCt:b.ownerCt,useArrows:true,store:a,rootVisible:false});b.picker.on("itemdblclick",b.onSelect,b);return b.picker},alignPicker:function(){var d=this,c,b,a="-above";if(d.isExpanded){c=d.getPicker();if(d.matchFieldWidth){c.setWidth(d.bodyEl.getWidth())}if(c.isFloating()){c.alignTo(d.inputEl,"",d.pickerOffset);b=c.el.getY()<d.inputEl.getY();d.bodyEl[b?"addCls":"removeCls"](d.openCls+a);c.el[b?"addCls":"removeCls"](c.baseCls+a)}}},onSelect:function(h,a,j,b,c,d){var g=this,i=a.get("id"),f=a.get("text");g.setValue(f);g.hiddenField.setValue(i);g.collapse()},setValue:function(a){this.callParent(arguments);this.hiddenField.setValue(a)}});Ext.define("Ext.ux.PopupTreeField",{extend:"Ext.form.field.Trigger",alias:"widget.popuptree",loadUrl:"",title:"",async:false,fields:null,onTriggerClick:function(){var a=this;a.tree=Ext.create("Ext.ux.TreeEx",{region:"center",loadUrl:a.loadUrl,async:a.async,fields:a.fields,height:a.height});a.tree.on("itemdblclick",onDblclick,a);a.window=Ext.create("Ext.window.Window",{modal:true,closeAction:"close",width:300,height:400,title:a.title,layout:"border",items:[a.tree]});a.window.show()},onDblclick:function(b,c,h,d,i,g){var f=c.get("id"),a=c.get("name")},onClose:function(){var a=this;a.window.destroy()}});Ext.define("Ext.ux.PopupGridField",{extend:"Ext.form.field.Trigger",alias:"widget.popupgrid",onTriggerClick:function(){}});Ext.define("Ext.ux.SelectWindow",{extend:"Ext.window.Window",requires:["*"],alias:"widget.selectwindow",columns:[],bean:[],sorted:true,params:null,isExt:false,layouts:{type:"form"},grid:null,tree:null,treeTitle:null,hasHistory:false,hasTool:true,hasPage:true,hasLog:false,pageSize:20,where:[],queryField:[],fbars:[],lbars:[],loadUrl:"",node:null,rightNode:null,async:true,mapping:"parent",findField:[],retuField:[],initComponent:function(){Ext.state.Manager.setProvider(new Ext.state.CookieProvider());var a=this;a.modal=true;a.closeAction="close";a.initWhere();a.initColumns();a.initBean();a.initUrl();a.layout={type:"border"};a.frame=false;a.border=false;a.tbar=Ext.create("Ext.toolbar.Toolbar",{layout:{overflowHandler:"Menu"},items:a.initBars()});if(a.loadUrl!=""){a.tree=Ext.create("Ext.ux.Tree",{region:"west",width:200,async:a.async,loadUrl:a.loadUrl});a.tree.on("itemclick",a.nodeClick,a)}a.grid=Ext.create("Ext.ux.Grid",{id:a.id,region:"center",border:true,hasPage:a.hasPage,gridEdit:true,listUrl:a.listUrl,columns:a.columns,bean:a.bean});a.items=[a.tree,a.grid];if(a.grid){if(a.grid.getXType()=="grid"||a.grid.getXType()==="mygrid"){a.grid.getStore().on("beforeload",a.onBeforeLoad,a);a.grid.on("itemdblclick",a.onSelected,a)}else{if(a.grid.getXType()=="tree"){if(a.fields&&a.fields.length>0){a.grid.on("itemdblclick",a.onSelected1,a)}}}}a.addEvents("beforeselect","afterselect");a.callParent()},initUrl:function(){var a=this,b=a.id;a.listUrl=(a.listUrl||b+"!query")+Ext.ACTION_SUFFIX+(a.params?"?"+a.params:"");if(a.loadUrl!=""){a.loadUrl=a.loadUrl+Ext.ACTION_SUFFIX}},initColumns:function(){var d=this,b=d.columns,a=d.columns.length;for(var c=0;c<a;c++){b[c].sorted=d.sorted}if(d.hasLog===true){b[b.length]={header:"创建时间",dataIndex:"createTime",width:120,hidden:true};b[b.length]={header:"创建用户",dataIndex:"createUser",width:120,hidden:true};b[b.length]={header:"修改时间",dataIndex:"modifyTime",width:120,hidden:true};b[b.length]={header:"修改用户",dataIndex:"modifyUser",width:120,hidden:true}}d.columns=[{xtype:"rownumberer"}].concat(b)},initWhere:function(){var d=this,b=0,a=d.where.length;for(var c=0;c<a;c++){if(d.where[c].id){d.queryField[b]=d.where[c].id;d.where[c].id=d.id+d.where[c].id+"query";b++}}},initBean:function(){var c=this,a=c.bean.length;for(var b=0;b<a;b++){if(Ext.isString(c.bean[b])){c.bean[b]={name:c.bean[b]}}}if(c.hasLog===true){c.bean[c.bean.length]={name:"createUser",type:"string"};c.bean[c.bean.length]={name:"createTime",type:"string"};c.bean[c.bean.length]={name:"modifyUser",type:"string"};c.bean[c.bean.length]={name:"modifyTime",type:"string"}}},initBars:function(){var c=this,a=[],b=0;if(c.where&&c.where.length>0){for(;b<c.where.length;b++){a[b]=c.where[b]}}a[b++]={id:c.id+"-reset-btn",text:"重置",tooltip:"重置所有查询条件",iconCls:"x-button-reset",handler:c.onReset,scope:c};if(c.hasHistory===true){a[b++]={id:c.id+"-query-btn",xtype:"splitbutton",text:"查询",tooltip:"查询符合条件的所有数据",iconCls:"x-button-query",handler:c.onQuery,scope:c,menu:[{text:"删除查询"}]}}else{a[b++]={id:c.id+"-query-btn",text:"查询",tooltip:"查询符合条件的所有数据",iconCls:"x-button-query",handler:c.onQuery,scope:c}}a[b++]="-";a[b++]={id:c.id+"-add-btn",text:"确定",iconCls:"x-button-ok",handler:c.onSelected,scope:c};a[b++]={text:"关闭",tooltip:"关闭当前业务窗口",iconCls:"x-button-close",handler:c.onExit,scope:c};return a},onReset:function(){var b=this;for(var a=0;a<b.queryField.length;a++){Ext.getCmp(b.id+b.queryField[a]+"query").setValue("")}},onBeforeLoad:function(a,c,b){Ext.apply(a.proxy.extraParams,this.getParameters())},onQuery:function(){var b=this,a=b.getParameters();a.page=1;b.grid.getStore().reload({params:a})},getParameters:function(){var f=this,d=-1,e={limit:f.pageSize};if(f.node){e["query.id"]=f.node.get("id");e.type=f.node.get("type")}var b="",g,h,a;for(var c=0;c<f.queryField.length;c++){b=f.queryField[c];a=Ext.getCmp(f.id+b+"query");if(a){h=a.xtype;g=a.getValue();if(h=="radiogroup"&&g){g=g.inputValue}if(Ext.isBoolean(g)){g=(g?1:0)}e["query."+b]=g}}return e},nodeClick:function(i,d,l,f,g,c){var h=this,b=true,j=d.get("id"),a=d.get("leaf");h.node=d;var k=h.getParameters();h.grid.getStore().reload({params:k})},onExit:function(){this.destroy()},onSelected:function(a,b,e){var d=this;if(d.fireEvent("beforeselect",d,b)){var g,f;if(d.isExt===true){for(var c=0;c<this.findField.length;c++){g=b.get(this.findField[c]);f=Ext.getCmp(this.retuField[c]);if(f){f.setValue(g)}}}else{for(var c=0;c<this.findField.length;c++){g=b.get(this.findField[c]);f=Ext.query("input[id="+this.retuField[c]+"]");if(f.length>0){f[f.length-1].value=g}}}this.close();this.fireEvent("afterselect",this,b)}},onSelected1:function(){}});Ext.define("Ext.ux.GridPicker",{extend:"Ext.form.field.Picker",xtype:"gridpicker",triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",config:{store:null,columns:null,selectOnTab:null,maxPickerHeight:300,minPickerHeight:100},editable:false,pageSize:20,listUrl:"",where:null,queryField:[],bean:null,valueField:"id",displayField:"name",hiddenName:null,initComponent:function(){var a=this;a.initWhere();a.columns=[{xtype:"rownumberer",width:30}].concat(a.columns);a.store=Ext.create("Ext.data.JsonStore",{storeId:a.id+"sotre",pageSize:a.pageSize,remoteSort:true,autoLoad:true,autoSync:false,autoDestroy:true,proxy:{type:"ajax",url:a.listUrl,reader:{type:"json",root:"items",totalProperty:"results"},actionMethods:{read:"POST"}},fields:a.bean});a.hiddenField=Ext.create("Ext.form.field.Hidden",{id:a.hiddenName,name:a.hiddenName});a.callParent(arguments);a.on("afterrender",function(){a.ownerCt.add(a.hiddenField)},a);a.addEvents("select");a.store.on("load",a.onLoad,a)},initWhere:function(){var c=this,a=0;if(c.where&&Ext.isArray(c.where)){for(var b=0;b<c.where.length;b++){if(c.where[b].id){c.where[b].id="query."+c.where[b].id;c.queryField[a++]=c.where[b].id}}}},createPicker:function(){var d=this,e=[],c=0;if(d.where&&Ext.isArray(d.where)){for(;c<d.where.length;c++){e[c]=d.where[c]}}e[c++]={text:"查询",iconCls:"x-button-query",handler:d.onQuery,scope:d};e[c++]={text:"确定",iconCls:"x-button-ok",handler:d.onOk,scope:d};e[c++]={text:"删除",iconCls:"x-button-del",handler:d.onDelete,scope:d};var b=Ext.create("Ext.grid.Panel",{store:d.store,columns:d.columns,columnLines:true,bbar:{xtype:"pagingtoolbar",store:d.store,displayInfo:true},selModel:{xtype:"rowmodel",mode:"MULTI"},floating:true,hidden:true,border:true,frame:false,height:200,shadow:false,tbar:e,manageHeight:true,listeners:{itemdblclick:Ext.bind(d.onItemClick,d)},viewConfig:{listeners:{render:function(f){f.getEl().on("keypress",d.onPickerKeypress,d)}}}});var a=b.getView();a.on("render",d.setPickerViewStyles,d);if(Ext.isIE9&&Ext.isStrict){a.on("highlightitem",d.repaintPickerView,d);a.on("unhighlightitem",d.repaintPickerView,d);a.on("afteritemexpand",d.repaintPickerView,d);a.on("afteritemcollapse",d.repaintPickerView,d)}return b},setPickerViewStyles:function(a){a.getEl().setStyle({"min-height":this.minPickerHeight+"px","max-height":this.maxPickerHeight+"px"})},repaintPickerView:function(){var a=this.picker.getView().getEl().dom.style;a.display=a.display},alignPicker:function(){var b=this,a;if(b.isExpanded){a=b.getPicker();if(b.matchFieldWidth){a.setWidth(b.bodyEl.getWidth())}if(a.isFloating()){b.doAlign()}}},onBeforeLoad:function(a,c,b){Ext.apply(a.proxy.extraParams,this.getParameters())},onQuery:function(){var b=this,a=b.getParameters();if(b.fireEvent("beforequery",this,a)===true){a.page=1;b.getPicker().getStore().currentPage=1;b.getPicker().getStore().reload({params:a})}},getParameters:function(){var e=this,d={limit:e.pageSize};var b="",f,g,a;for(var c=0;c<e.queryField.length;c++){b=e.queryField[c];a=Ext.getCmp(b);if(a){g=a.xtype;f=a.getValue();if(g=="radiogroup"&&f){f=f.inputValue}if(Ext.isBoolean(f)){f=(f?1:0)}d[b]=f}}return d},onItemClick:function(b,a,c,f,d){this.selectItem(a)},onPickerKeypress:function(c,b){var a=c.getKey();if(a===c.ENTER||(a===c.TAB&&this.selectOnTab)){this.selectItem(this.picker.getSelectionModel().getSelection()[0])}},selectItem:function(a){var b=this;b.hiddenField.setValue(a.get(b.valueField));b.setRawValue(a?a.get(this.displayField):"");b.picker.hide();b.inputEl.focus();b.fireEvent("select",b,a)},onExpand:function(){var c=this,b=c.picker,a=b.store,d=c.value;if(d){b.getSelectionModel().select(a.getById(d))}Ext.defer(function(){b.getView().focus()},1)},setValue:function(c){var b=this,a;b.value=c;if(b.store.loading){return b}a=c?b.store.getById(c):null;b.setRawValue(a?a.get(this.displayField):"");return b},getValue:function(){return this.value},onDelete:function(){this.hiddenField.setValue("");this.setValue("");this.setRawValue("")},onLoad:function(){var a=this.value;if(a){this.setValue(a)}}});function rendYesNo(a,d,b){return a=="1"?"是":"否"}function rendDate(a,d,b){return a==null?"":a.substring(0,10)}function rendAudit(a,d,b){return a==="1"?"已审核":"未审核"}Ext.define("Ext.ux.PlanGrid",{extend:"Ext.form.FieldContainer",alias:"widget.plangrid",listUrl:"",initComponent:function(){var e=this;var d=[],a=[],c=[];c[0]={name:"id",type:"long"};c[1]={name:"day",type:"int"};for(var b=0;b<12;b++){c[b+2]={name:"month"+b,type:"string"};a[b]={dataIndex:"month"+b,header:(b+1)+"月",width:35,editor:{xtype:"text"}}}for(var b=0;b<31;b++){d[b]={};d[b].day=b}e.grid=Ext.create("Ext.grid.Panel",{store:{xtype:"store",fields:c,data:{items:d},proxy:{type:"memory",reader:{type:"json",root:"items"}}},border:true,columns:[{xtype:"rownumberer",width:30}].concat(a),columnLines:true,height:e.height,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})]});e.items=[e.grid];e.callParent()},getValue:function(){var e=this,l=e.grid.getStore().getModifiedRecords();if(l&&l.length>0){var h="";for(var c=0;c<l.length;c++){var d=l[c];var k=d.get("day")+1,f=d.get("id"),g,b="";for(var a=0;a<12;a++){if(d.isModified("month"+a)){b=d.get("month"+a)==""?" ":d.get("month"+a);g=a+1;h+=(h==""?"":",")+"{monthField: "+g+", dayField: "+k+", type: '"+b+"'"+(f===undefined?"":",id:"+f)+"}"}}}return"{data:["+h+"]}"}return""},reload:function(c){var a=this,b=a.grid.getStore();Ext.Ajax.request({url:a.listUrl,method:"post",params:"id="+c,success:function(h){var f=Ext.JSON.decode(h.responseText);if(f.success===true){var d=f.items,j;for(var e=0;e<d.length;e++){j=d[e];var g=b.getAt(j.dayField-1);g.set("id",j.id);g.set("month"+(j.monthField-1),j.type)}b.commitChanges()}}})},setValue:function(a){},getStore:function(){return this.grid.getStore()}});Ext.define("Ext.ux.CascadeCombox",{extend:"Ext.form.FieldContainer",alias:"widget.cascade",urls:null,stores:null,layout:"hbox",comboxs:[],initComponent:function(){var d=this,b=d.stores,c=d.urls;if(b&&Ext.isArray(b)){for(var a=0;a<b.length;a++){d.comboxs[a]={xtype:"combox",id:d.id+"combox_"+a,width:100,store:b[a],listeners:{select:{fn:d.select,scope:d}}}}}else{if(c&&Ext.isArray(c)){for(var a=0;a<c.length;a++){d.comboxs[a]={xtype:"combox",id:d.id+"combox_"+a,width:100,loadUrl:c[a],listeners:{select:{fn:d.select,scope:d}}}}}else{Ext.Msg.alert("提示","缺少必须的值，请设定[store]或者[url]！")}}d.items=d.comboxs;d.callParent()},select:function(g,d,f){var h=this,c=g.id.split("_"),i=parseInt(c[1]),a=i+1;if(Ext.getCmp(h.id+"combox_"+a)){var b=Ext.getCmp(h.id+"combox_"+a),e=g.getValue();b.setValue();b.getStore().reload({params:{index:i,id:e}})}},setValue:function(a){var c=this;if(a!=""){var d=a.split(","),f,e;for(var b=0;b<d.length;b++){f=parseInt(d[b].trim());e=Ext.getCmp(c.id+"combox_"+b);e.setValue(f)}}else{c.items.each(function(g){g.setValue("")})}},getValue:function(){}});Ext.define("Ext.ux.GridFilterText",{extend:"Ext.form.field.Text",alias:"widget.headtext",flex:1,margin:2,enableKeyEvents:true,initComponent:function(){var a=this;a.listeners={keyup:function(){var b=this.up("tablepanel").store;b.clearFilter();if(this.value){b.filter({property:"name",value:this.value,anyMatch:true,caseSensitive:false})}},buffer:500};a.callParent()}});Ext.define("Ext.ux.List2ListView",{extend:"Ext.form.FieldContainer",alias:"widget.list2list",columns:null,listUrl:null,bean:[],pageSize:20,hasPage:false,layout:"hbox",initComponent:function(){var c=this,a=[];for(var b=0;b<c.columns.length;b++){a[b]=Ext.applyIf({},c.columns[b]);delete a[b].items}c.toGrid=Ext.create("Ext.grid.Panel",{title:"已选择数据",store:{xtype:"json",remoteSort:true,autoLoad:false,autoSync:false,autoDestroy:true,proxy:{type:"ajax",url:c.listUrl,reader:{type:"json",root:"items",totalProperty:"results"}},fields:c.bean},border:true,flex:0.8,selModel:{mode:"MULTI"},columns:a,columnLines:true,height:c.height});c.operPanel=Ext.create("Ext.panel.Panel",{border:false,layout:{type:"vbox",align:"center",pack:"center"},flex:0.1,height:c.height,items:[{xtype:"button",width:30,text:"<",style:"margin-bottom: 2px;",handler:c.right2Left,scope:c},{xtype:"button",width:30,text:"<<",style:"margin-bottom: 2px;",handler:c.rightAll2Left,scope:c},{xtype:"button",width:30,text:">",style:"margin-bottom: 2px;",handler:c.left2Right,scope:c},{xtype:"button",width:30,text:">>",handler:c.leftAll2Right,scope:c}]});c.fromGrid=Ext.create("Ext.ux.Grid",{title:"被选择数据",listUrl:c.listUrl,border:true,flex:0.8,selModel:{mode:"MULTI"},hasPage:c.hasPage,columns:c.columns,bean:c.bean,columnLines:true,height:c.height});c.items=[c.toGrid,c.operPanel,c.fromGrid];c.callParent()},right2Left:function(){var b=this,a=b.fromGrid.getSelectionModel().getSelection();if(a.length>0){b.toGrid.getStore().add(a);b.fromGrid.getStore().remove(a)}},rightAll2Left:function(){var b=this,a=b.fromGrid.getStore().getRange();if(a.length>0){b.toGrid.getStore().add(a);b.fromGrid.getStore().remove(a)}},left2Right:function(){var b=this,a=b.toGrid.getSelectionModel().getSelection();if(a.length>0){b.fromGrid.getStore().add(a);b.toGrid.getStore().remove(a)}},leftAll2Right:function(){var b=this,a=b.toGrid.getStore().getRange();if(a.length>0){b.fromGrid.getStore().add(a);b.toGrid.getStore().remove(a)}},getValue:function(){var d=this,e=d.toGrid.getStore().getRange();var a="",f,b;if(e.length>0){for(var c=0;c<e.length;c++){f=e[c];b=Ext.JSON.encode(f.data);a=a+(a==""?"":",")+b}a="["+a+"]"}return a},setValue:function(a){var b=this,c=b.toGrid;c.getStore().remove(c.getStore().getRange());if(a&&Ext.isArray(a)){c.getStore().add(a)}}});Ext.define("Ext.ux.MultipleComboBox",{extend:"Ext.form.field.ComboBox",alias:"widget.checkcombo",multiSelect:true,allSelector:false,addAllSelector:false,allText:"All",separator:",",createPicker:function(){var c=this,a,d=Ext.baseCSSPrefix+"menu",b=Ext.apply({pickerField:c,selModel:{mode:c.multiSelect?"SIMPLE":"SINGLE"},floating:true,hidden:true,ownerCt:c.ownerCt,cls:c.el.up("."+d)?d:"",store:c.store,displayField:c.displayField,focusOnToFront:false,pageSize:c.pageSize,tpl:['<ul style="list-style-type:none;margin:0px;padding:0px;"><tpl for=".">','<li role="option" class="'+Ext.baseCSSPrefix+'boundlist-item" style="text-align:left;list-style-type:none;"><span class="x-combo-checker">&nbsp;</span> {'+c.displayField+"}</li>","</tpl></ul>"]},c.listConfig,c.defaultListConfig);a=c.picker=Ext.create("Ext.view.BoundList",b);if(c.pageSize){a.pagingToolbar.on("beforechange",c.onPageChange,c)}c.mon(a,{itemclick:c.onItemClick,refresh:c.onListRefresh,scope:c});c.mon(a.getSelectionModel(),{beforeselect:c.onBeforeSelect,beforedeselect:c.onBeforeDeselect,selectionchange:c.onListSelectionChange,scope:c});return a},getValue:function(){if(this.value==undefined||this.value==""){return""}return this.value.join(this.separator)},getSubmitValue:function(){return this.getValue()},expand:function(){var c=this,a,b,d;if(c.rendered&&!c.isExpanded&&!c.isDestroyed){a=c.bodyEl;b=c.getPicker();d=c.collapseIf;b.show();c.isExpanded=true;c.alignPicker();a.addCls(c.openCls);if(c.addAllSelector==true&&c.allSelector==false){c.allSelector=b.getEl().insertHtml("afterBegin",'<div class="x-boundlist-item" role="option"><span class="x-combo-checker">&nbsp;</span> '+c.allText+"</div>",true);c.allSelector.on("click",function(g){if(c.allSelector.hasCls("x-boundlist-selected")){c.allSelector.removeCls("x-boundlist-selected");c.setValue("");c.fireEvent("select",c,[])}else{var f=[];c.store.each(function(e){f.push(e)});c.allSelector.addCls("x-boundlist-selected");c.select(f);c.fireEvent("select",c,f)}})}c.mon(Ext.getDoc(),{mousewheel:d,mousedown:d,scope:c});Ext.EventManager.onWindowResize(c.alignPicker,c);c.fireEvent("expand",c);c.onExpand()}},onListSelectionChange:function(b,d){var a=this,e=a.multiSelect,c=d.length>0;if(a.isExpanded){if(!e){Ext.defer(a.collapse,1,a)}if(e||c){a.setValue(d,false)}if(c){a.fireEvent("select",a,d)}a.inputEl.focus()}if(a.addAllSelector==true&&a.allSelector!=false){if(d.length==a.store.getTotalCount()){a.allSelector.addCls("x-boundlist-selected")}else{a.allSelector.removeCls("x-boundlist-selected")}}},initComponent:function(){var a=this;a.setValues=function(g){var f=this,h=f.valueField,d=f.getStore();if(d.getRange().length&&g.length){var c=[];for(var e=0;e<g.length;e++){var j=g[e];var b=d.findRecord(h,j);if(b){c.push(b)}}if(c.length){f.select(c);f.fireEvent("select",f,c)}}};a.callParent()}});Ext.Ajax.on("requestcomplete",checkSessionStatus,this);function checkSessionStatus(d,b,c){try{var a=b.getResponseHeader("sessionstatus");if(a==="timeout"){Ext.Msg.alert("系统提示","登入超时,系统将自动跳转到登陆页面,请重新登入!",function(e){if(e=="ok"){window.location.href="logout.asp"}})}}catch(f){}}Ext.define("Ext.ux.MainView",{extend:"Ext.container.Viewport",layout:"border",navigateStyle:"text",panelStyle:1,userName:"",tabSize:5,menus:null,initComponent:function(){var b=this;b.top=Ext.create("Ext.panel.Panel",{contentEl:"topdiv",region:"north",height:80});for(var a=0;a<b.menus.length;a++){b.menus[a].listeners={itemclick:b.nodeClick,scope:b}}b.navigate=Ext.create("Ext.panel.Panel",{id:"navigate",title:"当前用户："+b.userName,collapsible:true,split:true,frame:false,border:true,layout:"accordion",width:200,region:"west",items:b.menus});if(b.panelStyle===1){b.content=Ext.create("Ext.tab.Panel",{region:"center",id:"mainpanel",layout:"fit",items:[{title:"我的桌面",loader:{url:"desktop"+Ext.ACTION_SUFFIX,autoLoad:true,scripts:true}}]})}else{b.content=Ext.create("Ext.ux.Panel",{id:"mainpanel",region:"center",program:{id:0,code:"desktop",name:"我的桌面",url:"desktop.do"},loader:{url:"desktop",autoLoad:true,scripts:true,nocache:false,text:"Loading....",discardUrl:false}})}b.items=[b.top,b.navigate,b.content];b.callParent();if(Ext.get("logout")){Ext.get("logout").on("click",b.onLogout,b)}if(Ext.get("modifypassword")){Ext.get("modifypassword").on("click",b.modifyPassword,b)}},nodeClick:function(j,c,f){var h=this,i=false,b=c.get("leaf"),k=c.get("id"),m=c.get("text"),l=c.get("code"),g="program"+k,e=c.get("limit");if(b===false){j.expand(c);return}if(e==="0"){alert("您无此当前业务的权限！");return}var d=l+Ext.ACTION_SUFFIX+"?programId="+k+"&panelStyle="+h.panelStyle;if(h.panelStyle===1){var a=Ext.getCmp("program|"+l);if(a){h.content.setActiveTab(a)}else{a=Ext.create("Ext.ux.Panel",{id:"program|"+l,program:{id:k,code:l,name:m,url:d}});h.content.add(a);h.content.setActiveTab(a)}}else{h.setProgram({id:k,code:l,name:m,url:d})}},setProgram:function(a){this.content.setProgram(a)},getTabWidth:function(){return this.content.getWidth()},getTabHeight:function(){return this.content.getHeight()},removeTab:function(){this.content.remove(this.content.getActiveTab())},onLogout:function(){Ext.Msg.confirm("提示","是否注销当前的用户？",function(a){if(a=="yes"){Ext.Ajax.request({url:"logout"+Ext.ACTION_SUFFIX,method:"post",success:function(){window.location.href="manager"+Ext.ACTION_SUFFIX}})}},this)},modifyPassword:function(){var a=this;Ext.Ajax.request({url:"frame!loadUser"+Ext.ACTION_SUFFIX,method:"post",waitMsg:"请稍候，正在加载当前用户信息...",success:function(c){var b=Ext.JSON.decode(c.responseText);Ext.create("Ext.window.Window",{id:"modifypasswordwindow",title:"修改密码",width:300,closeAction:"destroy",modal:true,items:[{xtype:"form",id:"modifypasswordform",frame:true,defaults:{labelWidth:80,labelAlign:"right"},defaultType:"textfield",items:[{id:"modifycode",fieldLabel:"用户代号",readOnly:true,value:b.code,allowBlank:false,anchor:"100%"},{id:"modifyname",fieldLabel:"用户名称",value:b.name,readOnly:true,allowBlank:false,anchor:"100%"},{id:"modifypass",name:"password",fieldLabel:'<span class="keyField">原密码</span>',inputType:"password",allowBlank:false,anchor:"100%"},{id:"newpass",name:"password1",fieldLabel:'<span class="keyField">新密码</span>',inputType:"password",allowBlank:false,anchor:"100%"},{id:"newpass1",fieldLabel:'<span class="keyField">确认新密码</span>',inputType:"password",anchor:"100%",vtype:"password",initialPassField:"newpass",allowBlank:false},{id:"modifyid",name:"id",inputType:"hidden",value:b.id}]}],buttonAlign:"center",buttons:[{text:"保存",handler:a.onModify,scope:a},{text:"取消",handler:a.onCancel,scope:a}]}).show()}})},onModify:function(){var b=this,a=Ext.getCmp("modifypasswordform").getForm();if(a.isValid()){a.submit({clientValidation:true,url:"frame!updatePassword"+Ext.ACTION_SUFFIX,success:function(d,c){Ext.Msg.alert("提示","您的密码已经成功修改！")},failure:function(d,c){Ext.Msg.alert("提示","密码保存失败，"+c.result.message)}})}},onCancel:function(){Ext.getCmp("modifypasswordwindow").destroy()}});Ext.define("Ext.ux.Panel",{extend:"Ext.panel.Panel",requires:["*"],program:null,border:true,frame:false,layout:"fit",initComponent:function(){var a=this;a.id="program|"+a.program.code;a.title=a.program.name;a.on("beforedestroy",a.onClose,a);a.on("resize",a.resizePanel,a);if(a.program){a.loader={url:a.program.url,autoLoad:true,scripts:true}}a.callParent()},onClose:function(){if(Ext.getCmp(this.program.code)){Ext.getCmp(this.program.code).destroy()}},setProgram:function(a){var b=this;b.onClose();b.id="program"+a.id;b.program=a;b.setTitle(a.name);b.setLoading(true);b.getLoader().load({url:b.program.url,autoLoad:true,scripts:true,callback:function(){b.setLoading(false)}})},getProgram:function(){return this.program},getProgramCode:function(){return this.program.code},resizePanel:function(b,a,e,c,i,d){var g=this,f=g.program.code;if(Ext.getCmp(f)){Ext.getCmp(f).setWidth(a);Ext.getCmp(f).setHeight(e);Ext.getCmp(f).onResize(a,e)}}});Ext.define("Ext.ux.Desktop",{extend:"Ext.panel.Panel",id:"desktop",renderTo:"divdesktop",border:false,frame:false,layout:{type:"border",padding:"0 5 5 5"},autoScroll:true,columns:2,colItem:[],initComponent:function(){var f=this,g=parseInt(f.colItem.length/f.columns),e=tabs.getHeight()/f.columns-26,c=[];f.width=tabs.getWidth();f.height=tabs.getHeight();if(f.colItem.length%f.columns!=0){g++}for(var d=0;d<g;d++){c[d]={id:"col-"+d,items:[]};var a=0;var h=d*f.columns;for(var b=h;b<h+f.columns&&b<f.colItem.length;b++){f.colItem[b].height=e;c[d].items[a++]=f.colItem[b]}}f.items={xtype:"portalpanel",region:"center",border:false,autoScroll:true,items:c};f.callParent()}});Ext.define("Ext.ux.Frame",{extend:"Ext.panel.Panel",requires:["*"],alias:"widget.frame",program:{},user:{},gridEdit:false,columns:[],fields:[],bean:[],panelStyle:1,sorted:true,params:null,isHtml:false,layouts:{type:"form"},grid:null,editWin:null,editForm:null,menu:null,tree:null,treeTitle:null,winTitle:"",winWidth:800,winHeight:600,hasHistory:false,hasTool:true,hasPage:true,hasMenu:false,hasLog:false,extEdit:true,pageSize:20,funcs:{},where:[],queryField:[],fbars:[],lbars:[],loadUrl:"",node:null,async:true,uiType:0,hasAudit:false,queryNum:10,selectExport:false,mapping:"parent",border:false,fieldPrefix:"",recommendTitleField:"title",initComponent:function(){Ext.state.Manager.setProvider(new Ext.state.CookieProvider());var a=this;a.fieldPrefix=a.panelStyle===1?a.id:"";a.width=mainView.getTabWidth();a.height=mainView.getTabHeight()-26;a.renderTo="div"+a.id;a.initWhere();a.initUrl();a.layout={type:"border"};a.frame=false;a.border=false;if(a.where){if(a.where.length>=a.queryNum){var b=[{xtype:"toolbar",layout:{overflowHandler:"Menu"},items:a.initBars()}].concat(a.getWheres());a.tbar=Ext.create("Ext.container.Container",{border:false,items:b})}else{a.tbar=Ext.create("Ext.toolbar.Toolbar",{layout:{overflowHandler:"Menu"},items:a.initBars()})}}else{a.tbar=Ext.create("Ext.toolbar.Toolbar",{layout:{overflowHandler:"Menu"},items:a.initBars()})}if(a.isHtml===false){a.initBean();a.initField();a.initColumns();a.initial();if(a.grid){if(a.grid.getXType()=="grid"||a.grid.getXType()==="mygrid"){a.grid.getStore().on("beforeload",a.onBeforeLoad,a);a.grid.on("itemclick",a.onSelected,a);a.grid.getStore().on("load",a.onLoadFinsh,a);if(a.fields&&a.fields.length>0){a.grid.on("itemdblclick",a.onEdit,a)}}else{if(a.grid.getXType()=="tree"){if(a.fields&&a.fields.length>0){a.grid.on("itemdblclick",a.onEdit,a)}}}}if(a.tree&&a.hasMenu===true){a.tree.on("itemcontextmenu",a.showMenu,a)}a.on("beforedestroy",a.onBeforeDestroy,a);a.addEvents("beforeload","beforequery","beforesave","saved","beforedelete","deleted","beforeexit","beforeadd","beforeedit","beforeunaudit","afteritemclick","beforeundo","beforeRecommend")}else{if(a.loadUrl!=""){a.tree=Ext.create("Ext.ux.Tree",{region:"west",collapsible:true,split:true,collapseMode:"mini",width:200,async:a.async,loadUrl:a.loadUrl});a.tree.on("itemclick",a.nodeClick,a)}a.htmlPanel=Ext.create("Ext.panel.Panel",{region:"center",autoScroll:true,loader:{url:a.listUrl,autoLoad:true}});a.items=[a.tree,a.htmlPanel];a.addEvents("beforequery")}a.callParent()},initial:Ext.emptyFn,initUrl:function(){var a=this,b=a.id;a.listUrl=(a.listUrl||b+"!query")+Ext.ACTION_SUFFIX+(a.params?"?"+a.params:"");a.editUrl=(a.editUrl||b+"!edit")+Ext.ACTION_SUFFIX;if(a.hasFunc("btnDel")===true){a.deleUrl=(a.deleUrl||b+"!delete")+Ext.ACTION_SUFFIX}if(a.hasFunc("btnEdit")===true||a.hasFunc("btnAdd")===true){a.saveUrl=(a.saveUrl||b+"!save")+Ext.ACTION_SUFFIX}if(a.hasFunc("btnAudit")===true){a.auditUrl=(a.auditUrl||b+"!audit")+Ext.ACTION_SUFFIX}if(a.hasFunc("btnStick")===true){a.stickUrl=(a.stickUrl||b+"!stick")+Ext.ACTION_SUFFIX}if(a.hasFunc("btnImport")===true){a.importUrl=(a.importUrl||b+"!upload")+Ext.ACTION_SUFFIX}if(a.hasFunc("btnExport")===true){a.exportUrl=(a.exportUrl||b+"!export")+Ext.ACTION_SUFFIX}a.adjustUrl=(a.adjustUrl||b+"!adjust")+Ext.ACTION_SUFFIX;if(a.hasFunc("btnRemind")===true){a.remindUrl=(a.remindUrl||b+"!remind")+Ext.ACTION_SUFFIX}if(a.hasFunc("btnUndo")===true){a.undoUrl=(a.undoUrl||b+"!undo")+Ext.ACTION_SUFFIX}if(a.hasFunc("btnRecomm")===true){a.recommendUrl=(a.recommendUrl||b+"!recommend")+Ext.ACTION_SUFFIX}if(a.loadUrl!=""){a.loadUrl=a.loadUrl+Ext.ACTION_SUFFIX}},initColumns:function(){var e=this,b=e.columns,a=e.columns.length,d=e.panelStyle===1&&e.gridEdit===false?true:false;for(var c=0;c<a;c++){if(d===true){b[c].dataIndex=e.id+b[c].dataIndex}b[c].sorted=e.sorted}if(e.hasLog===true){b[b.length]={header:"创建时间",dataIndex:(d===true?e.id+"createTime":"createTime"),width:120,hidden:true};b[b.length]={header:"创建用户",dataIndex:(d===true?e.id+"createUser":"createUser"),width:120,hidden:true};b[b.length]={header:"修改时间",dataIndex:(d===true?e.id+"modifyTime":"modifyTime"),width:120,hidden:true};b[b.length]={header:"修改用户",dataIndex:(d===true?e.id+"modifyUser":"modifyUser"),width:120,hidden:true}}e.columns=[{xtype:"rownumberer",width:50}].concat(b)},getWheres:function(){var f=this,d=f.queryNum,b=parseInt(f.where.length/d),e=[];if(f.where.length%d!=0){b++}for(var c=0;c<b;c++){var g=0;e[c]={xtype:"toolbar",items:[]};for(var a=c*d;a<(c+1)*d;a++){e[c].items[g++]=f.where[a]}}return e},initWhere:function(){var d=this,b=0,a=d.where.length;for(var c=0;c<a;c++){if(d.where[c].id){d.queryField[b]=d.where[c].id;d.where[c].id=d.id+d.where[c].id+"query";b++}}},initBean:function(){var d=this,a=d.bean.length,c=d.panelStyle===1&&d.gridEdit===false?true:false;for(var b=0;b<a;b++){if(Ext.isString(d.bean[b])){d.bean[b]={name:d.bean[b]}}if(!d.bean[b].mapping){d.bean[b].mapping=d.bean[b].name}if(c===true){d.bean[b].name=d.id+d.bean[b].name}}if(d.hasLog===true){d.bean[d.bean.length]={name:(c===true?d.id+"createUser":"createUser"),type:"string",mapping:"createUser"};d.bean[d.bean.length]={name:(c===true?d.id+"createTime":"createTime"),type:"string",mapping:"createTime"};d.bean[d.bean.length]={name:(c===true?d.id+"modifyUser":"modifyUser"),type:"string",mapping:"modifyUser"};d.bean[d.bean.length]={name:(c===true?d.id+"modifyTime":"modifyTime"),type:"string",mapping:"modifyTime"}}if(d.bean.length>0){Ext.define(d.id,{extend:"Ext.data.Model",fields:d.bean})}},initField:function(){var e=this,b=e.fields.length,f;for(var c=0;c<b;c++){f=e.fields[c];if(f.allowBlank===false){f.fieldLabel='<span class="keyField">'+f.fieldLabel+"</span>"}if(f.readOnly===true){f.fieldLabel='<span class="readField">'+f.fieldLabel+"</span>"}f.id=e.fieldPrefix+f.id}if(e.hasLog===true&&e.fields&&e.fields.length>0){var h=e.fields[0].name.split(".");var g=h[0];e.fields[e.fields.length]={id:e.fieldPrefix+"createUser",inputType:"hidden",name:g+".createUser"};e.fields[e.fields.length]={id:e.fieldPrefix+"createTime",inputType:"hidden",name:g+".createTime"};e.fields[e.fields.length]={id:e.fieldPrefix+"modifyUser",inputType:"hidden",name:g+".modifyUser"};e.fields[e.fields.length]={id:e.fieldPrefix+"modifyTime",inputType:"hidden",name:g+".modifyTime"}}if(e.layouts.type==="table"){var a=e.winWidth/e.layouts.columns-e.layouts.columns*2-10,d;for(var c=0;c<b;c++){if(!e.fields[c].colspan){e.fields[c].colspan=1}d=e.fields[c].colspan;this.fields[c].width=d*a}}},hasFunc:function(a){return this.funcs[a]&&this.funcs[a]===true},initBars:function(){var d=this;if(d.hasTool===true){var a=[],c=0;if(d.where.length<d.queryNum){for(;c<d.where.length;c++){a[c]=d.where[c]}}a[c++]={id:d.id+"-reset-btn",text:"重置",tooltip:"重置所有查询条件",iconCls:"x-button-reset",handler:d.onReset,scope:d};if(d.hasHistory===true){a[c++]={id:d.id+"-query-btn",xtype:"splitbutton",text:"查询",tooltip:"查询符合条件的所有数据",iconCls:"x-button-query",handler:d.onQuery,scope:d,menu:[{text:"删除查询"}]}}else{a[c++]={id:d.id+"-query-btn",text:"查询",tooltip:"查询符合条件的所有数据",iconCls:"x-button-query",handler:d.onQuery,scope:d}}a[c++]="-";if(d.fbars!=null){if(Ext.isArray(d.fbars)){for(var b=0;b<d.fbars.length;b++){a[c++]=d.fbars[b]}}else{a[c++]=d.fbars}}if(d.hasFunc("btnRecomm")===true){a[c++]={id:d.id+"-recommend-btn",text:"推荐",tooltip:"推荐选中的数据到指定的栏目中",iconCls:"x-button-recommend",handler:this.onRecommend,scope:d};a[c++]="-"}if(d.hasFunc("btnAdd")===true){a[c++]={id:d.id+"-add-btn",text:"新增",tooltip:"新增一笔数据",iconCls:"x-button-add",handler:this.onAddData,scope:d}}if(d.hasFunc("btnEdit")===true){a[c++]={id:d.id+"-edit-btn",text:"编辑",tooltip:"编辑当前选择的数据",disabled:true,iconCls:"x-button-edit",handler:d.onEdit,scope:d}}if(this.hasFunc("btnDel")===true){a[c++]={id:d.id+"-del-btn",text:"删除",tooltip:"删除当前所有选择的数据",disabled:true,iconCls:"x-button-delete",handler:d.onDelete,scope:d}}if(d.hasFunc("btnSave")===true&&d.gridEdit===true){a[c++]={id:d.id+"-save-btn",text:"保存",tooltip:"保存当前所有修改的数据",disabled:true,iconCls:"x-button-save",handler:d.onSave,scope:d}}if(a.length>0&&a[c-1]!="-"){a[c++]="-"}if(d.hasFunc("btnStick")===true){a[c++]={id:d.id+"-stick-btn",xtype:"splitbutton",text:"置顶",tooltip:"置顶当前数据",iconCls:"x-button-stick",handler:d.onStick,scope:d,menu:[{text:"置顶撤消",handler:d.onUndoStick,scope:d}]}}if(d.hasFunc("btnAudit")===true){a[c++]={id:d.id+"-audit-btn",xtype:"splitbutton",text:"审核",iconCls:"x-button-audit",disabled:true,handler:d.onAudit,scope:d,menu:new Ext.menu.Menu({items:[{id:d.id+"-unaudit.btn",text:"撤消审核",handler:d.onUndoAudit,scope:d}]})}}if(d.lbars!=null){if(Ext.isArray(d.lbars)){for(var b=0;b<d.lbars.length;b++){a[c++]=d.lbars[b]}}else{a[c++]=d.lbars}}if(d.hasFunc("btnImport")===true){a[c++]={id:d.id+"-import-btn",text:"导入",tooltip:"从Excel中导入数据",iconCls:"x-button-import",handler:d.showImport,scope:d}}if(d.hasFunc("btnExport")===true){a[c++]={id:d.id+"-export-btn",text:"导出",tooltip:"将当前符合条件的数据导出至EXCEL表中",iconCls:"x-button-export",handler:d.onExport,scope:d}}if(d.hasFunc("btnRemind")===true){a[c++]={id:d.id+"-remind-btn",disabled:true,text:"提醒",disabled:true,tooltip:"提醒用户处理当前事务",iconCls:"x-button-remind",handler:d.onRemind,scope:d}}if(d.hasFunc("btnHandler")===true){a[c++]={id:d.id+"-handler-btn",disabled:true,text:"处理",disabled:true,tooltip:"处理当前事务",iconCls:"x-button-handler",handler:d.onHandler,scope:d}}if(d.hasFunc("btnUndo")===true){a[c++]={id:d.id+"-undo-btn",disabled:true,text:"撤回",disabled:true,tooltip:"撤回当前事务",iconCls:"x-button-undo",handler:d.onUndo,scope:d}}a[c++]={text:"刷新",tooltip:"重新加载当前数据",iconCls:"x-button-refresh",handler:d.onReload,scope:d};if(d.panelStyle===1){a[c++]="-";a[c++]={text:"关闭",tooltip:"关闭当前业务窗口",iconCls:"x-button-close",handler:d.onExit,scope:d}}return a}return null},onReset:function(){var b=this;for(var a=0;a<b.queryField.length;a++){Ext.getCmp(b.id+b.queryField[a]+"query").setValue("")}if(b.node){b.node=null}},onBeforeLoad:function(a,c,b){Ext.apply(a.proxy.extraParams,this.getParameters())},onLoadFinsh:function(b,a,c){},onQuery:function(){var b=this,a=b.getParameters();if(b.fireEvent("beforequery",this,a)===true){if(b.isHtml===false){a.page=1;b.grid.getStore().currentPage=1;b.grid.getStore().reload({params:a})}else{b.htmlPanel.getLoader().load({method:"post",url:b.listUrl,params:a})}}},getParameters:function(){var f=this,d=-1,e={limit:f.pageSize};if(f.node){e["query.id"]=f.node.get("id");e.type=f.node.get("type")}var b="",g,h,a;for(var c=0;c<f.queryField.length;c++){b=f.queryField[c];a=Ext.getCmp(f.id+b+"query");if(a){h=a.xtype;g=a.getValue();if(h=="radiogroup"&&g){g=g.inputValue}if(Ext.isBoolean(g)){g=(g?1:0)}e["query."+b]=g}}return e},onAddData:Ext.emptyFn,onEdit:Ext.emptyFn,installEvent:function(){var b=this;if(b.editForm){b.controls=[];var a=0,c=",treefield,mygrid,grid,tree,gridfield,combo,combox,";b.editForm.items.each(function(e){if(e.inputType!="hidden"&&e.inputType!=="file"){var d=e.getXType();if(c.indexOf(","+d+",")===-1){e.on("specialkey",b.switchFocus,b);b.controls[a++]=e}}})}},switchFocus:function(g,f,c){if(f.getKey()==Ext.EventObject.ENTER){var d=this,a=-1;for(var b=0;b<d.controls.length;b++){if(d.controls[b].id===g.id){a=b;break}}if(a!==-1){if(a==d.controls.length-1){d.onSave()}else{d.controls[++a].focus()}}}},onDelete:function(){var c=this,a=c.grid.getSelectionModel().getSelection();if(a.length==0){Ext.Msg.alert("提示","请先选择需要删除的数据再进行删除！");return}if(c.hasAudit===true){for(var b=0;b<a.length;b++){if(a[b].get("audit")==="1"){Ext.Msg.alert("提示","当前数据已经审核过，不得删除！");return}}}Ext.Msg.confirm("删除数据","是否删除当前所有选择的数据？",function(e){if(e=="yes"){if(c.fireEvent("beforedelete",c,a)===false){return}var f="";for(var d=0;d<a.length;d++){f+="ids="+a[d].get("id")+"&"}Ext.Ajax.request({url:c.deleUrl,method:"post",params:f,waitMsgTarget:true,waitMsg:"请稍候，正在删除数据......",success:function(h){var g=Ext.JSON.decode(h.responseText);c.fireEvent("deleted",c,a,g);if(g.success==true){Ext.Msg.alert("提示","当前所有选择的数据已经成功删除！");c.grid.getStore().reload()}else{Ext.Msg.alert("提示","数据删除出错，可能的原因为："+g.message)}}})}})},onSave:Ext.emptyFn,nodeClick:function(i,d,l,f,g,c){var h=this,b=true,j=d.get("id"),a=d.get("leaf");h.node=d;if(h.isHtml===false){if(h.onlyLeaf===true){if(a===false){b=false}}if(b===true){var k=h.getParameters();k.page=1;h.grid.getStore().currentPage=1;h.grid.getStore().reload({params:k})}}else{Ext.Ajax.request({url:h.listUrl,method:"post",params:k,success:function(e){h.htmlPanel.html=e.responseText}})}},showImport:function(){var a=this;a.importWin=Ext.create("Ext.window.Window",{modal:true,closeAction:"close",title:"数据导入",width:500,buttonAlign:"center",buttons:[{text:"导入",handler:a.onImport,scope:a},{text:"取消",handler:a.cancelImport,scope:a}],items:[{xtype:"form",bodyPadding:5,id:a.id+"importform",frame:false,border:false,layout:"form",fieldDefaults:{msgTarget:"side",labelWidth:75,labelAlign:"right"},defaultType:"textfield",items:[{xtype:"filefield",fieldLabel:"选择文件",name:"file.file"}]}]});a.importWin.show()},onImport:function(){var b=this,a=Ext.getCmp(b.id+"importform").getForm();if(a.isValid()){a.submit({clientValidation:true,url:b.importUrl,waitMsgTarget:true,waitMsg:"请稍候，正在上传文件......",success:function(d,c){Ext.Msg.alert("提示","当前数据已经成功导入！");b.importWin.destroy()},failure:function(d,c){Ext.Msg.alert("提示","数据导入出错，可能的原因为："+c.result.message)}})}},onStick:function(){var c=this,e=(c.panelStyle===1?c.id:""),d=c.grid.getSelectionModel().getSelection();if(d.length<=0){Ext.Msg.alert("提示","请先选择需要置顶的数据再进行编辑！");return}var b="";for(var a=0;a<d.length;a++){b+="ids="+d[a].get(e+"id")+"&"}b+="stick=1";Ext.Ajax.request({url:c.stickUrl,method:"post",params:b,waitMsgTarget:true,waitMsg:"请稍候，数据正在处理中......",success:function(g){var f=Ext.JSON.decode(g.responseText);if(f.success==true){Ext.Msg.alert("提示","当前所有选择的数据已经成功置顶！");c.grid.getStore().reload()}else{Ext.Msg.alert("提示","数据置顶出错，可能的原因为："+f.message)}}})},onUndoStick:function(){var c=this,e=(c.panelStyle===1?c.id:""),d=c.grid.getSelectionModel().getSelection();if(d.length<=0){Ext.Msg.alert("提示","请先选择需要撤消置顶的数据再进行编辑！");return}var b="";for(var a=0;a<d.length;a++){b+="ids="+d[a].get(e+"id")+"&"}b+="stick=0";Ext.Ajax.request({url:c.stickUrl,method:"post",params:b,waitMsgTarget:true,waitMsg:"请稍候，数据正在处理中......",success:function(g){var f=Ext.JSON.decode(g.responseText);c.grid.getSelectionModel().deselectAll();if(f.success==true){Ext.Msg.alert("提示","当前所有选择的数据已经成功撤消置顶！");c.grid.getStore().reload()}else{Ext.Msg.alert("提示","撤消置顶出错，可能的原因为："+f.message)}}})},onAudit:function(){var c=this,e=(c.panelStyle===1?c.id:""),d=c.grid.getSelectionModel().getSelection();if(d.length<=0){Ext.Msg.alert("提示","请先选择需要审核的数据再进行编辑！");return}var b="";for(var a=0;a<d.length;a++){if(d[a].get(e+"audit")==="1"){Ext.Msg.alert("提示","当前数据已经审核过，不得重复进行审核！");return}b+="ids="+d[a].get(e+"id")+"&"}b+="audit=1";Ext.Ajax.request({url:c.auditUrl,method:"post",params:b,waitMsgTarget:true,waitMsg:"请稍候，正在提交数据进行审核中......",success:function(g){var f=Ext.JSON.decode(g.responseText);c.grid.getSelectionModel().deselectAll();if(f.success==true){Ext.Msg.alert("提示","当前所有选择的数据已经成功审核！");c.grid.getStore().reload()}else{Ext.Msg.alert("提示","数据审核出错，可能的原因为："+f.message)}}})},onUndoAudit:function(){var c=this,e=(c.panelStyle===1?c.id:""),d=c.grid.getSelectionModel().getSelection();if(d.length<=0){Ext.Msg.alert("提示","请先选择需要撤消审核的数据再进行编辑！");return}if(c.fireEvent("beforeunaudit",c,d)===false){return}var b="";for(var a=0;a<d.length;a++){b+="ids="+d[a].get(e+"id")+"&"}b+="audit=0";Ext.Ajax.request({url:c.auditUrl,method:"post",params:b,waitMsgTarget:true,waitMsg:"请稍候，正在撤消审核数据......",success:function(g){var f=Ext.JSON.decode(g.responseText);c.grid.getSelectionModel().deselectAll();if(f.success==true){Ext.Msg.alert("提示","当前所有选择的数据已经成功撤消审核！");c.grid.getStore().reload()}else{Ext.Msg.alert("提示","数据撤消审核出错，可能的原因为："+f.message)}}})},onRecommend:function(){var c=this,b=c.getRecord();if(!b){Ext.Msg.alert("提示","请先选择需要推荐的数据！");return}if(c.hasAudit===true&&b.get(c.fieldPrefix+"audit")!=1){Ext.Msg.alert("提示","当前数据尚未审核，不能进行推荐！");return}var a=Ext.create("Ext.form.Panel",{id:c.id+"recommendform",frame:true,border:false,baseCls:"x-plain",layout:"form",fileUpload:true,defaults:{labelAlign:"right",labelWidth:60},defaultType:"textfield",items:[{id:c.id+"said",inputType:"hidden",name:"sa.id"},{id:c.id+"saarticleId",inputType:"hidden",name:"sa.recommId",value:b.get(c.fieldPrefix+"id")},{id:c.id+"satitle",fieldLabel:"推荐标题",name:"sa.title",value:b.get(c.fieldPrefix+c.recommendTitleField),anchor:"100%",allowBlank:false},{id:c.id+"sacolor",fieldLabel:"标题颜色",xtype:"colorfield",value:"#333333",msgTarget:"qtip",fallback:true,name:"sa.color",anchor:"30%"},{id:c.id+"sasectorId",fieldLabel:"推荐栏目",xtype:"combotree",width:200,hiddenName:"sa.sector",loadUrl:"sector!loadRecomm"+Ext.ACTION_SUFFIX,allowBlank:false},{id:c.id+"safilerecomm",fieldLabel:"推荐图片",xtype:"filefield",name:"file.file",anchor:"100%"},{id:c.id+"salink",fieldLabel:"推荐链接",name:"sa.link",anchor:"100%"},{id:c.id+"sasummary",fieldLabel:"摘要描述",xtype:"htmleditor",name:"sa.summary",anchor:"100% 50%"}]});c.recommendWin=Ext.create("Ext.window.Window",{title:"数据推荐",id:c.id+"recommendWin",width:600,closeAction:"destroy",bodyStyle:"padding:0px",plain:true,height:400,modal:false,items:a,buttonAlign:"center",buttons:[{text:"确定",handler:c.onRelRecommend,scope:c},{text:"关闭",handler:c.onCloseRecommend,scope:c}]});c.recommendWin.show()},onRelRecommend:function(){var b=this,a=null;b.recommendWin.items.each(function(f,e,d){if(f.getXType()==="form"){a=f}});if(a){var c=a.getForm();if(c.isValid()){c.submit({url:b.recommendUrl,waitMsgTarget:true,waitMsg:"请稍候，正在保存数据....",success:function(d,e){Ext.Msg.alert("提示","数据已经成功推荐！")}})}}},onCloseRecommend:function(){this.recommendWin.destroy()},cancelImport:function(){if(this.importWin){this.importWin.destroy()}},onExport:function(){var e=this,b="",h=(e.panelStyle===1?e.id:"");if(e.selectExport===true){var g=e.grid.getSelectionModel().getSelection();if(g.length<=0){Ext.Msg.alert("提示","请先选择需要导出的数据再进行编辑！");return}var d="";for(var c=0;c<g.length;c++){d+="ids="+g[c].get(h+"id")+"&"}b=e.exportUrl+"?"+d}else{var f=e.getParameters(),a="";for(o in f){a+=(a==""?"":"&")+o+"="+f[o]}b=e.exportUrl+"?"+a}if(this.frame){this.frame.src=b}else{this.frame=Ext.DomHelper.append(Ext.getBody(),'<iframe name="'+e.id+'-export-frm" style="display:none" src="'+b+'"></iframe>')}},onRemind:function(){},onHandler:function(){var j=this,e=j.grid.getSelectionModel(),h=e.getSelection(),i=e.getLastSelected();if(h==null){Ext.Msg.alert("提示","请先选择您需要办理的事务再进行处理！");return}var d=i.get("bussId"),f=i.get("process"),c=i.get("programCode"),a=i.get("programName"),b=i.get("programId"),g=i.get("id");var k="task.program.id="+b+"&task.process="+f+"&task.bussId="+d+"&task.id="+g;Ext.Ajax.request({method:"post",url:c+"!findInfoForNode.do",params:k,waitMsgTarget:true,waitMsg:"请稍候，正在加载事务数据......",success:function(m){var l=Ext.JSON.decode(m.responseText);if(l.success==false){j.onReload();Ext.Msg.alert("提示",l.message);return}Ext.create("Ext.ux.TaskWindow",{program:{id:b,code:c,name:a},bid:d,start:l.start,end:l.end,currentProcess:l.current,node:{id:l.node,name:l.nodeName},orderProcess:l.orders,returnProcess:l.returns}).show()}})},onUndo:function(){var e=this,a=e.getRecords();if(a.length<=0){Ext.Msg.alert("撤回","请先选择需要撤回的事务！");return}if(e.fireEvent("beforeundo",e,a)==true){var d="";for(var c=0;c<a.length;c++){d+="ids="+a[c].get("id")+"&"}var b=e.undoUrl;Ext.Msg.confirm("撤回","您是否撤回当前选择的事务?",function(f){if(f=="yes"){Ext.Ajax.request({method:"post",url:b,params:d,scope:e,waitMsgTarget:true,waitMsg:"请稍候，正在撤回选择的事务......",success:function(h){var g=Ext.JSON.decode(h.responseText);if(g.success===true){Ext.Msg.alert("撤回","当前所选择的事务已经成功撤回！");e.onReload()}else{Ext.Msg.alert("撤回","撤回事务失败，可能的原因为："+g.desc)}}})}},e)}},onReload:function(){var b=this,a=b.getParameters();if(b.isHtml===false){b.grid.getStore().reload({params:a})}else{b.htmlPanel.getLoader().load({method:"post",url:b.listUrl,params:a})}},onExit:function(){var a=this;a.fireEvent("beforeexit",a);if(a.editWin){a.editWin.destroy()}mainView.removeTab();a.destroy()},onClean:function(){var a=this;a.editForm.getForm().reset()},onClose:function(){var a=this;a.editForm.getForm().reset();a.editWin.hide()},onSelected:function(a,b,e){var d=this,c=b?false:true;if(Ext.getCmp(d.id+"-edit-btn")){Ext.getCmp(d.id+"-edit-btn").setDisabled(c)}if(Ext.getCmp(d.id+"-del-btn")){Ext.getCmp(d.id+"-del-btn").setDisabled(c)}if(Ext.getCmp(d.id+"-save-btn")){Ext.getCmp(d.id+"-save-btn").setDisabled(c)}if(Ext.getCmp(d.id+"-audit-btn")){Ext.getCmp(d.id+"-audit-btn").setDisabled(c)}if(Ext.getCmp(d.id+"-unaudit-btn")){Ext.getCmp(d.id+"-unaudit-btn").setDisabled(c)}if(Ext.getCmp(d.id+"-remind-btn")){Ext.getCmp(d.id+"-remind-btn").setDisabled(c)}if(Ext.getCmp(d.id+"-handler-btn")){Ext.getCmp(d.id+"-handler-btn").setDisabled(c)}if(Ext.getCmp(d.id+"-undo-btn")){Ext.getCmp(d.id+"-undo-btn").setDisabled(c)}d.fireEvent("afteritemclick",c)},showMenu:function(a,b,g,c,h,d){h.preventDefault();h.stopEvent();var f=this;f.node=b;if(!f.menu){f.menu=Ext.create("Ext.menu.Menu",{floating:true,plain:true,items:[{text:"新增",handler:f.onAddNode,scope:f},{text:"删除",handler:f.onDelNode,scope:f},"-",{text:"刷新",handler:f.onRefreshNode,scope:f}]})}f.menu.showAt(h.getXY())},onAddNode:function(){var a=this;if(a.editForm){a.editForm.getForm().reset()}if(a.node){if(Ext.getCmp(a.mapping)){Ext.getCmp(a.mapping).setValue(a.node.get("id"))}}},onDelNode:function(){var a=this;if(a.node){Ext.Msg.confirm("删除节点","是否确认删除当前节点？",function(b){if(b=="yes"){Ext.Ajax.request({url:a.deleUrl,params:"ids="+a.node.get("id"),method:"post",success:function(c){a.tree.getStore().load({node:a.node.parentNode})}})}},a)}},onRefreshNode:function(){var b=this,a=b.node?b.node:b.tree.getStore().getRootNode();b.tree.getStore().load({node:a})},onBeforeDestroy:function(){var a=this;if(a.editWin){a.editWin.destroy();a.editWin=null}},getRecord:function(){return this.grid.getSelectionModel().getLastSelected()},getRecords:function(){return this.grid.getSelectionModel().getSelection()}});Ext.define("Ext.ux.TreeFormPanel",{extend:"Ext.ux.Frame",alias:"widget.treeform",requires:["*"],node:null,hasMenu:true,initial:function(){var a=this;a.tree=Ext.create("Ext.ux.TreeEx",{region:"west",async:a.async,loadUrl:a.loadUrl,width:200});a.tree.on("itemclick",a.nodeClick,a);a.editForm=Ext.create("Ext.ux.EditForm",{region:"center",buttonAlign:"center",collapseMode:"header",buttons:[{text:"保存",handler:a.onSave,scope:a}],fields:a.fields});a.items=[a.tree,a.editForm];a.installEvent()},onAddData:function(){var a=this;a.editForm.getForm().reset();a.node=null;a.editForm.items.each(function(b){if(b.xtype=="treefield"){b.setValue(0)}else{if(b.xtype=="gridfield"){b.reload(0)}else{if(b.xtype=="ckfield"){b.setValue("")}else{if(b.xtype=="list2list"){b.setValue(null)}}}}})},onReload:function(){var a=this;a.tree.getStore().load({node:a.tree.getStore().getRootNode()})},nodeClick:function(a,b,h,d){var g=this,e=g.panelStyle===1?g.id:"";if(g.node==b){}else{g.node=b;var f=parseInt(b.get("id")),c=b.get("type");Ext.Ajax.request({url:g.editUrl,method:"post",params:"id="+f+"&type="+c,success:function(n){var k=Ext.JSON.decode(n.responseText).items[0];if(e===""){g.editForm.loadData(k);g.editForm.items.each(function(p){if(p.xtype=="treefield"){}else{if(p.xtype=="gridfield"){}else{if(p.xtype=="ckfield"){p.setValue(k[p.id])}}}})}else{var j=g.editForm.getForm(),i,l;for(var m in k){i=e+m;if((l=j.findField(i))){if(l.xtype==="treefield"){l.setValue(f)}else{if(l.xtype==="gridfield"){l.reload(f)}else{if(l.xtype==="ckfield"){l.setValue(k[m])}else{l.setValue(k[m])}}}}}}}})}},onSave:function(){var f=this,e=f.editForm.getForm();if(e.isValid()){if(f.fireEvent("beforesave",e)===false){return}var a="",c=f.id,b,d=f.panelStyle===1?Ext.getCmp(c+"id").getValue():Ext.getCmp("id").getValue();f.editForm.items.each(function(g){b=g.id;if(g.getXType()==="treefield"||g.getXType()==="gridfield"||g.getXType()==="plangrid"){a=b.substr(c.length,b.length)+"="+g.getValue()}});e.submit({clientValidation:true,url:f.saveUrl,params:a,waitMsgTarget:true,waitMsg:"请稍候，正在保存数据......",success:function(k,j){f.fireEvent("saved",k,j);var h=j.result.items,i=h.id,g=f.node?f.node:f.tree.getStore().getRootNode();if(d&&d>0){f.node.set("text",h.text);f.node.commit()}else{if(Ext.getCmp("id")){Ext.getCmp("id").setValue(i)}if(g.isLeaf()){g.set("leaf",false)}g.appendChild(h);g.expand()}Ext.Msg.alert("提示","当前数据已经成功保存！")},failure:function(h,g){Ext.Msg.alert("提示","数据保存出错，可能的原因为："+g.result.message)}})}}});Ext.define("Ext.ux.GridEditPanel",{extend:"Ext.ux.Frame",alias:"widget.gridedit",onlyLeaf:false,gridEdit:true,initial:function(){var a=this;if(a.loadUrl!=""){a.tree=Ext.create("Ext.ux.Tree",{region:"west",width:200,async:a.async,loadUrl:a.loadUrl});a.tree.on("itemclick",a.nodeClick,a)}a.grid=Ext.create("Ext.ux.Grid",{id:a.id,region:"center",border:true,hasPage:a.hasPage,gridEdit:true,listUrl:a.listUrl,columns:a.columns,bean:a.bean});a.items=[a.tree,a.grid]},onAddData:function(){var d=this,a={},b;for(var c in d.bean.length){b=d.bean[c];a[b.name]=b.type=="int"||b.tyep=="float"||b.type=="long"?0:""}if(d.tree&&d.node){a[d.mapping]=d.node.get("id")}d.grid.getStore().add(a)},onDelete:function(){var b=this,a=b.grid.getSelectionModel().getSelection();if(a.length==0){Ext.Msg.alert("提示","请先选择需要删除的数据再进行删除！");return}Ext.Msg.confirm("删除数据","是否删除当前所有选择的数据？",function(d){if(d=="yes"){if(b.fireEvent("beforedelete",b,a)===false){return}var e="";for(var c=0;c<a.length;c++){e+="ids="+a[c].get("id")+"&"}Ext.Ajax.request({url:b.deleUrl,method:"post",params:e,waitMsgTarget:true,waitMsg:"请稍候，正在删除数据......",success:function(g){var f=Ext.JSON.decode(g.responseText);b.fireEvent("deleted",b,a,f);if(f.success==true){Ext.Msg.alert("提示","当前所有选择的数据已经成功删除！");b.grid.getStore().reload()}else{Ext.Msg.alert("提示","数据删除出错，可能的原因为："+f.message)}}})}})},onSave:function(){var b=this,c=b.grid.getValues(b.id);var a=b.node?"id="+b.node.get("id")+"&jsons={data:"+c+"}":"jsons={data:"+c+"}";if(b.fireEvent("beforesave",b,b.grid)===false){return}Ext.Ajax.request({url:b.saveUrl,method:"post",params:a,waitMsgTarget:true,waitMsg:"请稍候，正在保存数据......",success:function(e){var d=Ext.JSON.decode(e.responseText);if(d.success===true){b.grid.getStore().commitChanges();Ext.Msg.alert("提示","当前数据已经成功保存！");b.fireEvent("saved",b,b.grid,d)}else{Ext.Msg.alert("提示","数据保存出错，可能的原因为："+d.desc)}}})},onReload:function(){var a=this;if(a.tree){a.tree.getStore().load({node:a.tree.getRootNode()})}else{a.grid.getStore().reload()}}});Ext.define("Ext.ux.GridFormPanel",{extend:"Ext.ux.Frame",alias:"widget.gridform",requires:["*"],onlyLeaf:false,upload:true,detailUrl:null,detailTitle:null,detailBean:null,detailColumns:null,initial:function(){var a=this;if(a.loadUrl!=""){a.tree=Ext.create("Ext.ux.Tree",{region:"west",collapsible:true,split:true,collapseMode:"mini",width:200,async:a.async,loadUrl:a.loadUrl});a.tree.on("itemclick",a.nodeClick,a)}a.grid=Ext.create("Ext.ux.Grid",{id:a.id,region:"center",border:true,hasPage:a.hasPage,gridEdit:a.gridEdit,listUrl:a.listUrl,columns:a.columns,bean:a.bean});if(a.detailBean){a.grid.on("itemclick",a.showDetail,a);a.detailColumns=[{xtype:"rownumberer"}].concat(a.detailColumns);a.detail=Ext.create("Ext.ux.Grid",{id:a.id+"-detail",title:a.detailTitle,region:"south",collapsible:true,split:true,collapseMode:"mini",height:200,collapsed:true,border:true,hasPage:false,listUrl:a.detailUrl,columns:a.detailColumns,bean:a.detailBean})}a.items=[a.tree,{xtype:"panel",layout:"border",region:"center",frame:false,border:false,items:[a.grid,a.detail]}]},showDetail:function(a,g,f,b,h,c){var d=this;if(d.detail.getCollapsed()===true||d.detail.getCollapsed()==="bottom"){d.detail.expand()}d.detail.getStore().reload({params:{id:g.get("id")}})},onAddData:function(){var a=this;if(a.extEdit===true){a.createEditWindow();a.editWin.show();a.editForm.getForm().reset();a.editForm.items.each(function(b){if(b.xtype=="treefield"||b.xtype==="cascade"){b.setValue(0)}else{if(b.xtype=="gridfield"){b.reload(0)}else{if(b.xtype=="ckfield"){b.setValue("")}}}});a.installEvent()}else{window.showModalDialog(a.editUrl,null,"dialogHeight:"+a.winHeight+",dialogWidth:"+a.winWidth+",center:yes,resizable:yes,status:yes")}},addDetailGridData:function(f,a){var e=Ext.getCmp(f).getStore(),d=this;e.removeAll();for(var b=0;b<a.length;b++){e.add({});var c=e.getAt(b);c.beginEdit();for(var g in a[b]){c.set(g,a[b][g])}c.endEdit()}},onEdit:function(){var c=this,e=c.grid.getSelectionModel().getSelection();if(e.length<=0){Ext.Msg.alert("提示","请先选择需要编辑的数据再进行编辑！");return}var d=e[0];if(c.hasAudit===true&&d.get("audit")==="1"){Ext.Msg.alert("提示","当前数据已经审核过，不得进行编辑！");return}if(c.fireEvent("beforeedit",c,d)===false){return}c.createEditWindow();c.editWin.show();c.installEvent();c.editForm.getForm().loadRecord(d);var b=d.get("id"),a=c.panelStyle===1?c.id:"";c.editForm.items.each(function(g){if(g.xtype=="treefield"||g.xtype==="cascade"||g.xtype==="ckfield"||g.xtype==="list2list"){var h=d.get(g.id);g.setValue(h)}else{if(g.xtype=="gridfield"||g.xtype=="plangrid"){g.reload(b)}else{if(g.xtype==="radiogroup"){var h=d.get(g.id);g.items.each(function(f){f.setValue(f.inputValue===h)})}}}})},onSave:function(){var h=this,a=h.id,c=h.editForm.getForm();Ext.getCmp(a+"-save-btn-win").setDisabled(true);if(c.isValid()){if(h.fireEvent("beforesave",c)===true){var k={},f="",a=h.id,b=h.panelStyle===1,i,d=0;try{h.editForm.items.each(function(e){f=e.getXType();i=e.id;if(f==="treefield"||f==="gridfield"||f==="plangrid"||f==="cascade"||f==="list2list"){k[b===true?i.substr(a.length):i]=e.getValue()}});c.submit({clientValidation:true,url:h.saveUrl,params:k,waitMsgTarget:true,waitMsg:"请稍候，正在保存数据...",success:function(m,l){try{h.fireEvent("saved",m,l);h.grid.getStore().reload();var j=Ext.getCmp(a+"-chk-add").getValue();if(j===false){var p=l.result.key;h.editForm.getForm().findField(b===true?a+"id":"id").setValue(p);h.editForm.items.each(function(e){if(e.xtype=="treefield"){e.setValue(p)}else{if(e.xtype=="gridfield"||e.xtype=="plangrid"){e.reload(p)}}})}else{h.editForm.getForm().findField(b===true?a+"id":"id").setValue("")}Ext.Msg.alert("提示","当前数据已经成功保存！")}catch(n){alert(n)}},failure:function(j,e){Ext.Msg.alert("提示","数据保存出错，可能的原因为："+e.result.message)}})}catch(g){alert(g)}}}Ext.getCmp(h.id+"-save-btn-win").setDisabled(false)},createEditWindow:function(){var a=this;if(!a.editWin){a.editForm=Ext.create("Ext.ux.EditForm",{fields:a.fields,region:"center",layouts:a.layouts});a.editWin=Ext.create("Ext.window.Window",{title:a.winTitle,width:a.winWidth,height:a.winHeight,forceFit:true,layout:"border",stateful:true,stateId:a.id+"-edit-win",items:a.editForm,border:true,modal:true,closeAction:"hide",buttonAlign:"center",buttons:[{xtype:"checkbox",id:a.id+"-chk-add"},{xtype:"label",text:"连续新增",forId:a.id+"-chk-add"},"->",{id:a.id+"-save-btn-win",text:"保存",handler:a.onSave,scope:this},{id:a.id+"-clean-btn-win",text:"清除",handler:a.onClean,scope:this},{id:a.id+"-cancel-btn-win",text:"关闭",handler:a.onClose,scope:this}]});if(a.layouts.type==="table"){a.editWin.on("resize",a.winResize,a)}}},winResize:function(f,a,c,b){var d=this,e=d.layouts.columns;f.items.each(function(h){if(h.getXType()==="editform"){var g=a/e-e*2-10;h.items.each(function(i){i.setWidth(i.colspan*g)})}})}});Ext.define("Ext.ux.TreeGridPanel",{extend:"Ext.ux.GridFormPanel",alias:"widget.treegrid",initial:function(){var a=this;a.grid=Ext.create("Ext.tree.Panel",{region:"center",rootVisible:false,store:Ext.create("Ext.data.TreeStore",{model:a.id,proxy:{type:"ajax",url:a.listUrl},folderSort:true}),multiSelect:true,singleExpand:true,columns:a.columns});a.items=[a.grid]}});