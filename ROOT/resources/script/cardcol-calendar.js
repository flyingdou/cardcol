Ext.calendar.CalendarPanel=Ext.extend(Ext.Panel,{showDayView:true,showWeekView:true,showMonthView:true,showNavBar:true,todayText:"今天",showTodayText:true,showTime:true,dayText:"日视图",weekText:"周视图",monthText:"月视图",canDrag:false,parameter:{},workDays:"",workTimes:"",layoutConfig:{layoutOnCardChange:true,deferredRender:true},startDate:new Date(),initComponent:function(){this.tbar={cls:"ext-cal-toolbar",border:true,buttonAlign:"center",items:[{id:this.id+"-tb-prev",handler:this.onPrevClick,scope:this,iconCls:"x-tbar-page-prev"}]};this.viewCount=0;if(this.showDayView){this.tbar.items.push({id:this.id+"-tb-day",text:this.dayText,handler:this.onDayClick,scope:this,toggleGroup:"tb-views"});this.viewCount++}if(this.showWeekView){this.tbar.items.push({id:this.id+"-tb-week",text:this.weekText,handler:this.onWeekClick,scope:this,toggleGroup:"tb-views"});this.viewCount++}if(this.showMonthView||this.viewCount==0){this.tbar.items.push({id:this.id+"-tb-month",text:this.monthText,handler:this.onMonthClick,scope:this,toggleGroup:"tb-views"});this.viewCount++;this.showMonthView=true}this.tbar.items.push({id:this.id+"-tb-next",handler:this.onNextClick,scope:this,iconCls:"x-tbar-page-next"});this.tbar.items.push("->");var e=new Ext.ButtonDatePicker({id:"myCalendarBtn"});e.on("select",this.selectDate,this);this.tbar.items.push(e);var a=this.viewCount-1;this.activeItem=this.activeItem===undefined?a:(this.activeItem>a?a:this.activeItem);if(this.showNavBar===false){delete this.tbar;this.addClass("x-calendar-nonav")}Ext.calendar.CalendarPanel.superclass.initComponent.call(this);this.addEvents({eventadd:true,eventupdate:true,eventdelete:true,eventcancel:true,viewchange:true});this.layout="card";if(this.showDayView){var b=Ext.apply({xtype:"dayview",title:this.dayText,showToday:this.showToday,parameter:this.parameter,enableDD:this.canDrag===true,showTodayText:this.showTodayText,showTime:this.showTime,workDays:this.workDays,workTimes:this.workTimes},this.dayViewCfg);b.id=this.id+"-day";b.store=b.store||this.eventStore;this.initEventRelay(b);this.add(b)}if(this.showWeekView){var g=Ext.applyIf({xtype:"weekview",title:this.weekText,type:this.type,enableDD:this.canDrag===true,showToday:this.showToday,showTodayText:this.showTodayText,parameter:this.parameter,showTime:this.showTime,workDays:this.workDays,workTimes:this.workTimes},this.weekViewCfg);g.id=this.id+"-week";g.store=g.store||this.eventStore;this.initEventRelay(g);this.add(g)}if(this.showMonthView){var c=Ext.applyIf({xtype:"monthview",title:this.monthText,showToday:this.showToday,showTodayText:this.showTodayText,enableDD:false,parameter:this.parameter,showTime:this.showTime,listeners:{weekclick:{fn:function(i,h){this.showWeek(h)},scope:this}}},this.monthViewCfg);c.id=this.id+"-month";c.store=c.store||this.eventStore;this.initEventRelay(c);this.add(c)}},initEventRelay:function(a){a.listeners=a.listeners||{};a.listeners.afterrender={fn:function(b){this.relayEvents(b,["eventsrendered","eventclick","eventover","eventout","dayclick","eventmove","datechange","rangeselect","eventdelete","eventresize","initdrag"])},scope:this,single:true}},afterRender:function(){Ext.calendar.CalendarPanel.superclass.afterRender.call(this);this.fireViewChange()},onLayout:function(){Ext.calendar.CalendarPanel.superclass.onLayout.call(this);if(!this.navInitComplete){this.updateNavState();this.navInitComplete=true}},setCurrentDate:function(a){Ext.getCmp("myCalendarBtn").setText(a.format("Y-m-d"))},setActiveView:function(b){var a=this.layout;a.setActiveItem(b);if(b==this.id+"-edit"){this.getTopToolbar().hide();this.doLayout()}else{a.activeItem.setParameter(this.parameter);this.setStartDate(a.activeItem.getStartDate());a.activeItem.refresh();this.getTopToolbar().show();this.updateNavState()}this.activeView=a.activeItem;this.fireViewChange()},fireViewChange:function(){var b=null,a=this.layout.activeItem;if(a.getViewBounds){vb=a.getViewBounds();b={activeDate:a.getStartDate(),viewStart:vb.start,viewEnd:vb.end}}this.fireEvent("viewchange",this,a,b)},updateNavState:function(){if(this.showNavBar!==false){var b=this.layout.activeItem,c=b.id.split(this.id+"-")[1];var a=Ext.getCmp(this.id+"-tb-"+c);a.toggle(true)}},setParameter:function(b){for(var a in b){this.parameter[a]=b[a]}this.setStartDate(this.layout.activeItem.getStartDate())},selectDate:function(a,b){this.startDate=b;this.setStartDate(b)},setStartDate:function(a){this.layout.activeItem.setParameter(this.parameter);this.layout.activeItem.setStartDate(a,true);this.updateNavState();this.fireViewChange()},showWeek:function(a){this.setActiveView(this.id+"-week");this.setStartDate(a)},onPrevClick:function(){this.startDate=this.layout.activeItem.movePrev();this.layout.activeItem.setParameter(this.parameter);this.layout.activeItem.setStartDate(this.startDate,true);this.updateNavState();this.fireViewChange()},onNextClick:function(){this.startDate=this.layout.activeItem.moveNext();this.layout.activeItem.setParameter(this.parameter);this.layout.activeItem.setStartDate(this.startDate,true);this.updateNavState();this.fireViewChange()},onDayClick:function(){this.setActiveView(this.id+"-day")},onWeekClick:function(){this.setActiveView(this.id+"-week")},onMonthClick:function(){this.setActiveView(this.id+"-month")},getActiveView:function(){return this.layout.activeItem}});Ext.reg("calendarpanel",Ext.calendar.CalendarPanel);Ext.calendar.CalendarView=Ext.extend(Ext.BoxComponent,{startDay:0,spansHavePriority:false,trackMouseOver:true,enableFx:true,enableAddFx:true,enableUpdateFx:false,enableRemoveFx:true,enableDD:true,monitorResize:true,ddCreateEventText:"Create event for {0}",ddMoveEventText:"Move event to {0}",ddResizeEventText:"Update event to {0}",weekCount:1,dayCount:1,eventSelector:".ext-cal-evt",eventOverClass:"ext-evt-over",eventElIdDelimiter:"-evt-",dayElIdDelimiter:"-day-",getEventBodyMarkup:Ext.emptyFn,getEventTemplate:Ext.emptyFn,parameter:{},initComponent:function(){this.initialize(this.startDate||new Date());Ext.calendar.CalendarView.superclass.initComponent.call(this);this.addEvents({headClick:true,eventsrendered:true,eventclick:true,eventover:true,eventout:true,datechange:true,rangeselect:true,eventmove:true,initdrag:true,dayover:true,dayout:true})},afterRender:function(){Ext.calendar.CalendarView.superclass.afterRender.call(this);this.renderTemplate();if(this.store){this.setStore(this.store,true)}this.el.on({mouseover:this.onMouseOver,mouseout:this.onMouseOut,click:this.onClick,resize:this.onResize,scope:this});this.el.unselectable();if(this.enableDD&&this.initDD){this.initDD()}this.on("eventsrendered",this.forceSize);this.forceSize.defer(100,this)},forceSize:function(){if(this.el&&this.el.child){var e=this.el.child(".ext-cal-hd-ct"),b=this.el.child(".ext-cal-body-ct");if(b==null||e==null){return}var a=e.getHeight(),c=this.el.parent().getSize();b.setHeight(c.height-a)}},refresh:function(){this.prepareData();this.renderTemplate();this.renderItems()},getWeekCount:function(){var a=Ext.calendar.Date.diffDays(this.viewStart,this.viewEnd);return Math.ceil(a/this.dayCount)},prepareData:function(){var i=this.startDate.getLastDateOfMonth(),c=0,h=0,g=this.viewStart.clone(),e=this.weekCount<1?6:this.weekCount;this.eventGrid=[[]];this.allDayGrid=[[]];this.evtMaxCount=[];var b=this.store.queryBy(function(j){return this.isEventVisible(j.data)},this);for(;c<e;c++){this.evtMaxCount[c]=0;if(this.weekCount==-1&&g>i){break}this.eventGrid[c]=this.eventGrid[c]||[];this.allDayGrid[c]=this.allDayGrid[c]||[];for(d=0;d<this.dayCount;d++){if(b.getCount()>0){var a=b.filterBy(function(l){var k=(g.getTime()==l.data[Ext.calendar.EventMappings.StartDate.name].clearTime(true).getTime());var j=(c==0&&d==0&&(g>l.data[Ext.calendar.EventMappings.StartDate.name]));return k||j},this);this.sortEventRecordsForDay(a);this.prepareEventGrid(a,c,d)}g=g.add(Date.DAY,1)}}this.currentWeekCount=c},prepareEventGrid:function(c,b,h){var g=0,e=this.viewStart.clone(),a=this.maxEventsPerDay?this.maxEventsPerDay:999;c.each(function(i){var k=Ext.calendar.EventMappings,j=Ext.calendar.Date.diffDays(Ext.calendar.Date.max(this.viewStart,i.data[k.StartDate.name]),Ext.calendar.Date.min(this.viewEnd,i.data[k.EndDate.name]))+1;if(j>1||Ext.calendar.Date.diffDays(i.data[k.StartDate.name],i.data[k.EndDate.name])>1){this.prepareEventGridSpans(i,this.eventGrid,b,h,j);this.prepareEventGridSpans(i,this.allDayGrid,b,h,j,true)}else{g=this.findEmptyRowIndex(b,h);this.eventGrid[b][h]=this.eventGrid[b][h]||[];this.eventGrid[b][h][g]=i;if(i.data[k.IsAllDay.name]){g=this.findEmptyRowIndex(b,h,true);this.allDayGrid[b][h]=this.allDayGrid[b][h]||[];this.allDayGrid[b][h][g]=i}}if(this.evtMaxCount[b]<this.eventGrid[b][h].length){this.evtMaxCount[b]=Math.min(a+1,this.eventGrid[b][h].length)}return true},this)},prepareEventGridSpans:function(j,a,i,h,k,l){var g=i,b=h,m=this.findEmptyRowIndex(i,h,l),e=this.viewStart.clone();var c={event:j,isSpan:true,isSpanStart:true,spanLeft:false,spanRight:(h==6)};a[i][h]=a[i][h]||[];a[i][h][m]=c;while(--k){e=e.add(Date.DAY,1);if(e>this.viewEnd){break}if(++b>6){b=0;g++;m=this.findEmptyRowIndex(g,0)}a[g]=a[g]||[];a[g][b]=a[g][b]||[];a[g][b][m]={event:j,isSpan:true,isSpanStart:(b==0),spanLeft:(g>i)&&(b%7==0),spanRight:(b==6)&&(k>1)}}},findEmptyRowIndex:function(b,j,a){var g=a?this.allDayGrid:this.eventGrid,c=g[b]?g[b][j]||[]:[],e=0,h=c.length;for(;e<h;e++){if(c[e]==null){return e}}return h},renderTemplate:function(){if(this.tpl){this.tpl.overwrite(this.el,this.getParams());this.lastRenderStart=this.viewStart.clone();this.lastRenderEnd=this.viewEnd.clone()}},disableStoreEvents:function(){this.monitorStoreEvents=false},enableStoreEvents:function(a){this.monitorStoreEvents=true;if(a===true){this.refresh()}},onResize:function(){this.refresh()},onInitDrag:function(){this.fireEvent("initdrag",this)},onEventDrop:function(c,a){if(Ext.calendar.Date.compare(c.data[Ext.calendar.EventMappings.StartDate.name],a)===0){return}var b=a.getTime()-c.data[Ext.calendar.EventMappings.StartDate.name].getTime();c.set(Ext.calendar.EventMappings.StartDate.name,a);c.set(Ext.calendar.EventMappings.EndDate.name,c.data[Ext.calendar.EventMappings.EndDate.name].add(Date.MILLI,b));this.fireEvent("eventmove",this,c)},onCalendarEndDrag:function(e,a,b){this.dragPending=true;var c={};c[Ext.calendar.EventMappings.StartDate.name]=e;c[Ext.calendar.EventMappings.EndDate.name]=a;this.fireEvent("rangeselect",this,c,this.onCalendarEndDragComplete.createDelegate(this,[b]))},onCalendarEndDragComplete:function(a){a();this.dragPending=false},onUpdate:function(b,c,a){if(this.monitorStoreEvents===false){return}if(a==Ext.data.Record.COMMIT){this.refresh();if(this.enableFx&&this.enableUpdateFx){this.doUpdateFx(this.getEventEls(c.data[Ext.calendar.EventMappings.EventId.name]),{scope:this})}}},doUpdateFx:function(a,b){this.highlightEvent(a,null,b)},onAdd:function(c,a,b){if(this.monitorStoreEvents===false){return}var e=a[0];this.tempEventId=e.id;this.refresh();if(this.enableFx&&this.enableAddFx){this.doAddFx(this.getEventEls(e.data[Ext.calendar.EventMappings.EventId.name]),{scope:this})}},doAddFx:function(a,b){a.fadeIn(Ext.apply(b,{duration:2}))},onRemove:function(a,b){if(this.monitorStoreEvents===false){return}if(this.enableFx&&this.enableRemoveFx){this.doRemoveFx(this.getEventEls(b.data[Ext.calendar.EventMappings.EventId.name]),{remove:true,scope:this,callback:this.refresh})}else{this.getEventEls(b.data[Ext.calendar.EventMappings.EventId.name]).remove();this.refresh()}},doRemoveFx:function(a,b){a.fadeOut(b)},highlightEvent:function(b,a,e){if(this.enableFx){var g;!(Ext.isIE||Ext.isOpera)?b.highlight(a,e):b.each(function(c){c.highlight(a,Ext.applyIf({attr:"color"},e));g=c.child(".ext-cal-evm");if(g){g.highlight(a,e)}},this)}},getEventIdFromEl:function(a){a=Ext.get(a);var b=a.id.split(this.eventElIdDelimiter)[1];if(b.indexOf("-")>-1){b=b.split("-")[0]}return b},getEventId:function(a){if(a===undefined&&this.tempEventId){a=this.tempEventId}return a},getEventSelectorCls:function(b,a){var c=a?".":"";return c+this.id+this.eventElIdDelimiter+this.getEventId(b)},getEventEls:function(b){var a=Ext.select(this.getEventSelectorCls(this.getEventId(b),true),false,this.el.id);return new Ext.CompositeElement(a)},isToday:function(){var a=new Date().clearTime().getTime();return this.viewStart.getTime()<=a&&this.viewEnd.getTime()>=a},onDataChanged:function(a){this.refresh()},isEventVisible:function(j){var b=this.viewStart.getTime(),e=this.viewEnd.getTime(),h=Ext.calendar.EventMappings,k=(j.data?j.data[h.StartDate.name]:j[h.StartDate.name]).getTime(),i=(j.data?j.data[h.EndDate.name]:j[h.EndDate.name]).add(Date.SECOND,-1).getTime(),c=(k>=b&&k<=e),a=(i>=b&&i<=e),g=(k<b&&i>e);return(c||a||g)},isOverlapping:function(m,l){var k=m.data?m.data:m,j=l.data?l.data:l,h=Ext.calendar.EventMappings,c=k[h.StartDate.name].getTime(),i=k[h.EndDate.name].add(Date.SECOND,-1).getTime(),b=j[h.StartDate.name].getTime(),g=j[h.EndDate.name].add(Date.SECOND,-1).getTime();if(i<c){i=c}if(g<b){g=b}var e=(c>=b&&c<=g),n=(i>=b&&i<=g),a=(c<b&&i>g);return(e||n||a)},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){if(Ext.isDate(a)){a=a.format("Ymd")}return this.id+this.dayElIdDelimiter+a},setParameter:function(a){this.parameter=a},getStartDate:function(){return this.startDate},initialize:function(a){this.startDate=a.clearTime();this.setViewBounds(a);this.fireEvent("datechange",this,this.startDate,this.viewStart,this.viewEnd)},setStartDate:function(c,b){this.startDate=c.clearTime();this.setViewBounds(c);var a=this.parameter||{};if(b==true){a.startDate=this.viewStart.format("Y-m-d");a.endDate=this.viewEnd.format("Y-m-d");this.store.load({params:a})}if(b===true){this.refresh()}this.fireEvent("datechange",this,this.startDate,this.viewStart,this.viewEnd)},setViewBounds:function(a){var e=a||this.startDate,c=e.getDay()-this.startDay;switch(this.weekCount){case 0:case 1:this.viewStart=this.dayCount<7?e:e.add(Date.DAY,-c).clearTime(true);this.viewEnd=this.viewStart.add(Date.DAY,this.dayCount||7).add(Date.SECOND,-1);return;case -1:e=e.getFirstDateOfMonth();c=e.getDay()-this.startDay;this.viewStart=e.add(Date.DAY,-c).clearTime(true);var b=e.add(Date.MONTH,1).add(Date.SECOND,-1);this.viewEnd=b.add(Date.DAY,6-b.getDay());return;default:this.viewStart=e.add(Date.DAY,-c).clearTime(true);this.viewEnd=this.viewStart.add(Date.DAY,this.weekCount*7).add(Date.SECOND,-1)}},getViewBounds:function(){return{start:this.viewStart,end:this.viewEnd}},sortEventRecordsForDay:function(a){if(a.length<2){return}a.sort("ASC",function(h,g){var e=h.data,c=g.data,j=Ext.calendar.EventMappings;if(this.spansHavePriority){var i=Ext.calendar.Date.diffDays;if(i(e[j.StartDate.name],e[j.EndDate.name])>0){if(i(c[j.StartDate.name],c[j.EndDate.name])>0){if(e[j.StartDate.name].getTime()==c[j.StartDate.name].getTime()){return c[j.EndDate.name].getTime()-e[j.EndDate.name].getTime()}return e[j.StartDate.name].getTime()-c[j.StartDate.name].getTime()}return -1}else{if(i(c[j.StartDate.name],c[j.EndDate.name])>0){return 1}}return e[j.StartDate.name].getTime()-c[j.StartDate.name].getTime()}else{return e[j.StartDate.name].getTime()-c[j.StartDate.name].getTime()}}.createDelegate(this))},moveTo:function(b,a){if(Ext.isDate(b)){this.setStartDate(b);if(a!==false){this.refresh()}return this.startDate}return b},moveNext:function(a){return this.moveTo(this.viewEnd.add(Date.DAY,1))},movePrev:function(a){var b=Ext.calendar.Date.diffDays(this.viewStart,this.viewEnd)+1;return this.moveDays(0-b,a)},moveMonths:function(b,a){return this.moveTo(this.startDate.add(Date.MONTH,b),a)},moveWeeks:function(b,a){return this.moveTo(this.startDate.add(Date.DAY,b*7),a)},moveDays:function(b,a){return this.moveTo(this.startDate.add(Date.DAY,b),a)},moveToday:function(a){return this.moveTo(new Date(),a)},setStore:function(a,b){if(!b&&this.store){this.store.un("datachanged",this.onDataChanged,this);this.store.un("add",this.onAdd,this);this.store.un("remove",this.onRemove,this);this.store.un("update",this.onUpdate,this);this.store.un("clear",this.refresh,this)}if(a){a.on("datachanged",this.onDataChanged,this);a.on("add",this.onAdd,this);a.on("remove",this.onRemove,this);a.on("update",this.onUpdate,this);a.on("clear",this.refresh,this)}this.store=a;if(a&&a.getCount()>0){this.refresh()}},getEventRecord:function(b){var a=this.store.find(Ext.calendar.EventMappings.EventId.name,b);return this.store.getAt(a)},getEventRecordFromEl:function(a){return this.getEventRecord(this.getEventIdFromEl(a))},getParams:function(){return{viewStart:this.viewStart,viewEnd:this.viewEnd,startDate:this.startDate,dayCount:this.dayCount,weekCount:this.weekCount,title:this.getTitle()}},getTitle:function(){return this.startDate.format("F Y")},onClick:function(c,a){var b=c.getTarget(this.eventSelector,5);if(b){var g=this.getEventIdFromEl(b);this.fireEvent("eventclick",this,this.getEventRecord(g),b);return true}},onMouseOver:function(b,a){if(this.trackMouseOver!==false&&(this.dragZone==undefined||!this.dragZone.dragging)){if(!this.handleEventMouseEvent(b,a,"over")){this.handleDayMouseEvent(b,a,"over")}}},onMouseOut:function(b,a){if(this.trackMouseOver!==false&&(this.dragZone==undefined||!this.dragZone.dragging)){if(!this.handleEventMouseEvent(b,a,"out")){this.handleDayMouseEvent(b,a,"out")}}},handleEventMouseEvent:function(i,c,h){var g=i.getTarget(this.eventSelector,5,true),a,b,j;if(g){a=Ext.get(i.getRelatedTarget());if(g==a||g.contains(a)){return true}j=this.getEventIdFromEl(g);if(this.eventOverClass!=""){b=this.getEventEls(j);b[h=="over"?"addClass":"removeClass"](this.eventOverClass)}this.fireEvent("event"+h,this,this.getEventRecord(j),g);return true}return false},getDateFromId:function(c,b){var a=c.split(b);return a[a.length-1]},handleDayMouseEvent:function(k,g,i){g=k.getTarget("td",3);if(g){if(g.id&&g.id.indexOf(this.dayElIdDelimiter)>-1){var j=this.getDateFromId(g.id,this.dayElIdDelimiter),a=Ext.get(k.getRelatedTarget()),c,b;if(a){c=a.is("td")?a:a.up("td",3);b=c&&c.id?this.getDateFromId(c.id,this.dayElIdDelimiter):""}if(!a||j!=b){var h=this.getDayEl(j);if(h&&this.dayOverClass!=""){h[i=="over"?"addClass":"removeClass"](this.dayOverClass)}this.fireEvent("day"+i,this,Date.parseDate(j,"Ymd"),h)}}}},renderItems:function(){throw"This method must be implemented by a subclass"}});Ext.calendar.DayBodyView=Ext.extend(Ext.calendar.CalendarView,{dayColumnElIdDelimiter:"-day-col-",workDays:"",workTimes:"",initComponent:function(){Ext.calendar.DayBodyView.superclass.initComponent.call(this);this.addEvents({eventresize:true,dayclick:true})},initDD:function(){var a={createText:this.ddCreateEventText,moveText:this.ddMoveEventText,resizeText:this.ddResizeEventText};this.el.ddScrollConfig={vthresh:Ext.isIE||Ext.isOpera?100:40,hthresh:-1,frequency:50,increment:100,ddGroup:"DayViewDD"};this.dragZone=new Ext.calendar.DayViewDragZone(this.el,Ext.apply({view:this,containerScroll:true},a));this.dropZone=new Ext.calendar.DayViewDropZone(this.el,Ext.apply({view:this},a))},refresh:function(){var a=this.el.getScroll().top;this.prepareData();this.renderTemplate();this.renderItems();if(this.scrollReady){this.scrollTo(a)}},scrollTo:function(b,a){a=a||(Ext.isIE||Ext.isOpera);if(a){(function(){this.el.scrollTo("top",b);this.scrollReady=true}).defer(10,this)}else{this.el.scrollTo("top",b);this.scrollReady=true}},afterRender:function(){if(!this.tpl){this.tpl=new Ext.calendar.DayBodyTemplate({id:this.id,dayCount:this.dayCount,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,workDays:this.workDays,workTimes:this.workTimes})}this.tpl.compile();this.addClass("ext-cal-body-ct");Ext.calendar.DayBodyView.superclass.afterRender.call(this);this.scrollTo(7*42)},forceSize:Ext.emptyFn,onEventResize:function(e,b){var c=Ext.calendar.Date,g=Ext.calendar.EventMappings.StartDate.name,a=Ext.calendar.EventMappings.EndDate.name;if(c.compare(e.data[g],b.StartDate)===0&&c.compare(e.data[a],b.EndDate)===0){return}e.set(g,b.StartDate);e.set(a,b.EndDate);this.fireEvent("eventresize",this,e)},getEventBodyMarkup:function(){if(!this.eventBodyMarkup){this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&nbsp;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&nbsp;</i>',"</tpl>"].join("")}return this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){this.eventTpl=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<div id="{_elId}" class="{_selectorCls} {_colorCls} ext-cal-evt ext-cal-evr" style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;background-color: {_bgColor};">','<div class="ext-evt-bd" style="color: {_color};">',this.getEventBodyMarkup(),"</div>",'<div class="ext-evt-bd" style="color: {_color};">{_coach}</div>','<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&nbsp;</div></div>',"</div>"):new Ext.XTemplate('<div id="{_elId}" class="ext-cal-evt {_selectorCls} {_colorCls}-x" style="left: {_left}%; width: {_width}%; top: {_top}px; background: {_bgColor};">','<div class="ext-cal-evb">&nbsp;</div>','<dl style="height: {_height}px;" class="ext-cal-evdm">','<dd class="ext-evt-bd" style="color: {_color};">',this.getEventBodyMarkup(),"</dd>",'<dd class="ext-evt-bd" style="color: {_color};">{_coach}</dd>','<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&nbsp;</div></div>',"</dl>",'<div class="ext-cal-evb">&nbsp;</div>',"</div>");this.eventTpl.compile()}return this.eventTpl},getTemplateEventData:function(b){var a=this.getEventSelectorCls(b[Ext.calendar.EventMappings.EventId.name]),c={},g=Ext.calendar.EventMappings;this.getTemplateEventBox(b);c._selectorCls=a;c._bgColor=b[g.Color.name];c._color=getColor(c._bgColor);c._coach=b[g.CoachName.name]+(b[g.Count.name]>0?" ("+b[g.JoinNum.name]+"/"+b[g.Count.name]+")":"");c._colorCls="ext-color-3";c._elId=a+(b._weekIndex?"-"+b._weekIndex:"");c._isRecurring=b.Recurrence&&b.Recurrence!="";c._isReminder=b[g.Reminder.name]&&b[g.Reminder.name]!="";var e=b[g.CourseName.name];c.Title=(!e||e.length==0?"无标题":e);return Ext.applyIf(c,b)},getTemplateEventBox:function(c){var h=0.7,i=c[Ext.calendar.EventMappings.StartDate.name],b=c[Ext.calendar.EventMappings.EndDate.name],g=i.getHours()*60+i.getMinutes(),a=b.getHours()*60+b.getMinutes(),e=a-g;c._left=0;c._width=100;c._top=Math.round(g*h)+1;c._height=Math.max((e*h)-2,15)},renderItems:function(){var q=0,t=[],p,o,m,s,k,e,b,a,c,h,g,r,n;for(;q<this.dayCount;q++){p=emptyCells=skipped=0;o=this.eventGrid[0][q];m=o?o.length:0;for(;p<m;p++){evt=o[p];if(!evt){continue}s=evt.data||evt.event.data;Ext.apply(s,{cls:"ext-cal-ev",_positioned:true});t.push({data:this.getTemplateEventData(s),date:this.viewStart.add(Date.DAY,q)})}}k=e=a=c=0;b=t.length;for(;k<b;k++){evt=t[k].data;evt2=null;c=a;for(e=0;e<b;e++){if(k==e){continue}evt2=t[e].data;if(this.isOverlapping(evt,evt2)){evt._overlap=evt._overlap==undefined?1:evt._overlap+1;if(k<e){if(evt._overcol===undefined){evt._overcol=0}evt2._overcol=evt._overcol+1;a=Math.max(a,evt2._overcol)}}}}for(k=0;k<b;k++){evt=t[k].data;if(evt._overlap!==undefined){h=100/(a+1);g=100-(h*evt._overlap);evt._width=h;evt._left=h*evt._overcol}r=this.getEventTemplate().apply(evt);n=this.id+"-day-col-"+t[k].date.format("Ymd");Ext.DomHelper.append(n,r)}this.fireEvent("eventsrendered",this)},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){if(Ext.isDate(a)){a=a.format("Ymd")}return this.id+this.dayColumnElIdDelimiter+a},getDaySize:function(){var a=this.el.child(".ext-cal-day-col-inner").getBox();return{height:a.height,width:a.width}},getDayAt:function(o,k){var g=".ext-cal-body-ct",i=this.el.child(".ext-cal-day-times").getWidth(),s=this.el.getBox(),n=this.getDaySize(false),p=o-s.x-i,a=Math.floor(p/n.width),m=this.el.getScroll(),r=this.el.child(".ext-cal-bg-row"),q=r.getHeight()/2,l=k-s.y-q+m.top,j=Math.max(0,Math.ceil(l/q)),b=j*30,e=this.viewStart.add(Date.DAY,a).add(Date.MINUTE,b),c=this.getDayEl(e),h=o;if(c){h=c.getLeft()}return{date:e,el:c,timeBox:{x:h,y:(j*21)+s.y-m.top,width:n.width,height:q}}},onClick:function(h,b){if(this.dragPending||Ext.calendar.DayBodyView.superclass.onClick.apply(this,arguments)){return}if(h.getTarget(".ext-cal-day-times",3)!==null){return}var c=h.getTarget("td",3);if(c){if(c.id&&c.id.indexOf(this.dayElIdDelimiter)>-1){var g=this.getDateFromId(c.id,this.dayElIdDelimiter);this.fireEvent("dayclick",this,Date.parseDate(g,"Ymd"),true,Ext.get(this.getDayId(g,true)));return}}var a=this.getDayAt(h.xy[0],h.xy[1]);if(a&&a.date){this.fireEvent("dayclick",this,a.date,false,null)}}});Ext.reg("daybodyview",Ext.calendar.DayBodyView);Ext.calendar.DayHeaderView=Ext.extend(Ext.calendar.MonthView,{weekCount:1,dayCount:1,allDayOnly:true,monitorResize:false,isHead:true,afterRender:function(){if(!this.tpl){this.tpl=new Ext.calendar.DayHeaderTemplate({id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime})}this.tpl.compile();this.addClass("ext-cal-day-header");Ext.calendar.DayHeaderView.superclass.afterRender.call(this)},forceSize:Ext.emptyFn,refresh:function(){Ext.calendar.DayHeaderView.superclass.refresh.call(this);this.recalcHeaderBox()},recalcHeaderBox:function(){var b=this.el.child(".ext-cal-evt-tbl"),a=b.getHeight();this.el.setHeight(a+7);if(Ext.isIE&&Ext.isStrict){this.el.child(".ext-cal-hd-ad-inner").setHeight(a+4)}if(Ext.isOpera){}},moveNext:function(a){return this.moveDays(this.dayCount,a)},movePrev:function(a){return this.moveDays(-this.dayCount,a)},onClick:function(h,a){var b=h.getTarget("td",3),g,c;if(b){if(b.id&&b.id.indexOf(this.dayElIdDelimiter)>-1){g=b.id.split(this.dayElIdDelimiter);c=g[g.length-1];this.fireEvent("dayclick",this,Date.parseDate(c,"Ymd"),true,Ext.get(this.getDayId(c)));return}}Ext.calendar.DayHeaderView.superclass.onClick.apply(this,arguments)}});Ext.reg("dayheaderview",Ext.calendar.DayHeaderView);Ext.calendar.DayView=Ext.extend(Ext.Container,{showTime:true,showTodayText:true,todayText:"今天",ddCreateEventText:"Create event for {0}",ddMoveEventText:"Move event to {0}",dayCount:1,parameter:{},initComponent:function(){this.dayCount=this.dayCount>7?7:this.dayCount;var b=Ext.apply({},this.initialConfig);b.showTime=this.showTime;b.showTodatText=this.showTodayText;b.todayText=this.todayText;b.dayCount=this.dayCount;b.wekkCount=1;var c=Ext.applyIf({xtype:"dayheaderview",id:this.id+"-hd"},b);var a=Ext.applyIf({xtype:"daybodyview",id:this.id+"-bd"},b);this.items=[c,a];this.addClass("ext-cal-dayview ext-cal-ct");Ext.calendar.DayView.superclass.initComponent.call(this)},afterRender:function(){Ext.calendar.DayView.superclass.afterRender.call(this);this.header=Ext.getCmp(this.id+"-hd");this.body=Ext.getCmp(this.id+"-bd");this.body.on("eventsrendered",this.forceSize,this)},refresh:function(){this.header.refresh();this.body.refresh()},forceSize:function(){(function(){var a=this.el.up(".x-panel-body"),c=this.el.child(".ext-cal-day-header"),b=a.getHeight()-c.getHeight();this.el.child(".ext-cal-body-ct").setHeight(b)}).defer(10,this)},onResize:function(){this.forceSize()},getViewBounds:function(){return this.header.getViewBounds()},getStartDate:function(){return this.header.getStartDate()},setStartDate:function(a){this.header.setParameter(this.parameter);this.header.setStartDate(a,false);this.body.setParameter(this.parameter);this.body.setStartDate(a,true)},setParameter:function(a){this.parameter=a},renderItems:function(){this.header.renderItems();this.body.renderItems()},isToday:function(){return this.header.isToday()},moveTo:function(b,a){this.header.moveTo(b,a);this.body.moveTo(b,a)},moveNext:function(b){var a=this.header.moveNext(b);this.body.moveNext(b);return a},movePrev:function(b){var a=this.header.movePrev(b);this.body.movePrev(b);return a},moveDays:function(b,a){this.header.moveDays(b,a);this.body.moveDays(b,a)},moveToday:function(a){this.header.moveToday(a);this.body.moveToday(a)}});Ext.reg("dayview",Ext.calendar.DayView);Ext.calendar.MonthDayDetailView=Ext.extend(Ext.BoxComponent,{initComponent:function(){Ext.calendar.CalendarView.superclass.initComponent.call(this);this.addEvents({eventsrendered:true});if(!this.el){this.el=document.createElement("div")}},afterRender:function(){this.tpl=this.getTemplate();Ext.calendar.MonthDayDetailView.superclass.afterRender.call(this);this.el.on({click:this.view.onClick,mouseover:this.view.onMouseOver,mouseout:this.view.onMouseOut,scope:this.view})},getTemplate:function(){if(!this.tpl){this.tpl=new Ext.XTemplate('<div class="ext-cal-mdv x-unselectable">','<table class="ext-cal-mvd-tbl" cellpadding="0" cellspacing="0">',"<tbody>",'<tpl for=".">','<tr><td class="ext-cal-ev">{markup}</td></tr>',"</tpl>","</tbody>","</table>","</div>")}this.tpl.compile();return this.tpl},update:function(a){this.date=a;this.refresh()},refresh:function(){if(!this.rendered){return}var a=this.view.getEventTemplate(),b=[];evts=this.store.queryBy(function(j){var g=this.date.clearTime(true).getTime(),e=j.data[Ext.calendar.EventMappings.StartDate.name].clearTime(true).getTime(),h=(g==e),i=false;if(!h){var c=j.data[Ext.calendar.EventMappings.EndDate.name].clearTime(true).getTime();i=e<g&&c>=g}return h||i},this);evts.each(function(c){var e=c.data,g=Ext.calendar.EventMappings;e._renderAsAllDay=e[g.IsAllDay.name]||Ext.calendar.Date.diffDays(e[g.StartDate.name],e[g.EndDate.name])>0;e.spanLeft=Ext.calendar.Date.diffDays(e[g.StartDate.name],this.date)>0;e.spanRight=Ext.calendar.Date.diffDays(this.date,e[g.EndDate.name])>0;e.spanCls=(e.spanLeft?(e.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft"):(e.spanRight?"ext-cal-ev-spanright":""));b.push({markup:a.apply(this.getTemplateEventData(e))})},this);this.tpl.overwrite(this.el,b);this.fireEvent("eventsrendered",this,this.date,evts.getCount())},getTemplateEventData:function(a){var b=this.view.getTemplateEventData(a);b._elId="dtl-"+b._elId;return b}});Ext.reg("monthdaydetailview",Ext.calendar.MonthDayDetailView);
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
;Ext.calendar.MonthView=Ext.extend(Ext.calendar.CalendarView,{showTime:true,showTodayText:true,todayText:"今天",showHeader:false,showWeekLinks:false,showWeekNumbers:false,weekLinkOverClass:"ext-week-link-over",daySelector:".ext-cal-day",moreSelector:".ext-cal-ev-more",weekLinkSelector:".ext-cal-week-link",weekCount:-1,dayCount:7,moreElIdDelimiter:"-more-",weekLinkIdDelimiter:"ext-cal-week-",initComponent:function(){Ext.calendar.MonthView.superclass.initComponent.call(this);this.addEvents({dayclick:true,weekclick:true,dayover:true,dayout:true})},initDD:function(){var a={view:this,createText:this.ddCreateEventText,moveText:this.ddMoveEventText,ddGroup:"MonthViewDD"};this.dragZone=new Ext.calendar.DragZone(this.el,a);this.dropZone=new Ext.calendar.DropZone(this.el,a)},onDestroy:function(){Ext.destroy(this.ddSelector);Ext.destroy(this.dragZone);Ext.destroy(this.dropZone);Ext.calendar.MonthView.superclass.onDestroy.call(this)},afterRender:function(){if(!this.tpl){this.tpl=new Ext.calendar.MonthViewTemplate({id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHeader:this.showHeader,showWeekLinks:this.showWeekLinks,showWeekNumbers:this.showWeekNumbers})}this.tpl.compile();this.addClass("ext-cal-monthview ext-cal-ct");Ext.calendar.MonthView.superclass.afterRender.call(this)},onResize:function(){if(this.monitorResize){this.maxEventsPerDay=this.getMaxEventsPerDay();this.refresh()}},forceSize:function(){if(this.showWeekLinks&&this.el&&this.el.child){var g=this.el.select(".ext-cal-hd-days-tbl"),e=this.el.select(".ext-cal-bg-tbl"),c=this.el.select(".ext-cal-evt-tbl"),b=this.el.child(".ext-cal-week-link").getWidth(),a=this.el.getWidth()-b;g.setWidth(a);e.setWidth(a);c.setWidth(a)}Ext.calendar.MonthView.superclass.forceSize.call(this)},initClock:function(){if(Ext.fly(this.id+"-clock")!==null){this.prevClockDay=new Date().getDay();if(this.clockTask){Ext.TaskMgr.stop(this.clockTask)}this.clockTask=Ext.TaskMgr.start({run:function(){var b=Ext.fly(this.id+"-clock"),a=new Date();if(a.getDay()==this.prevClockDay){if(b){b.update(a.format("g:i a"))}}else{this.prevClockDay=a.getDay();this.moveTo(a)}},scope:this,interval:1000})}},getEventBodyMarkup:function(){if(!this.eventBodyMarkup){this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&nbsp;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&nbsp;</i>',"</tpl>",'<tpl if="spanLeft">','<i class="ext-cal-spl">&nbsp;</i>',"</tpl>",'<tpl if="spanRight">','<i class="ext-cal-spr">&nbsp;</i>',"</tpl>"].join("")}return this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){var b,a=this.getEventBodyMarkup();b=!(Ext.isIE||Ext.isOpera)?new Ext.XTemplate('<div id="{_elId}" class="{_selectorCls} {_colorCls} {values.spanCls} ext-cal-evt ext-cal-evr" style="color: {_bgColor}">',a,"</div>"):new Ext.XTemplate('<tpl if="_renderAsAllDay">','<div id="{_elId}" class="{_selectorCls} {values.spanCls} {_colorCls} ext-cal-evt ext-cal-evo" style="color: {_bgColor}">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',"</tpl>",'<tpl if="!_renderAsAllDay">','<div id="{_elId}" class="{_selectorCls} {_colorCls} ext-cal-evt ext-cal-evr" style="color: {_bgColor}">',"</tpl>",a,'<tpl if="_renderAsAllDay">',"</div>","</div>","</tpl>","</div>");b.compile();this.eventTpl=b}return this.eventTpl},getTemplateEventData:function(b){var e=Ext.calendar.EventMappings,a=this.getEventSelectorCls(b[e.EventId.name]),c=b[e.CourseName.name];return Ext.applyIf({_selectorCls:a,_bgColor:b[e.Color.name],_colorCls:"ext-color-3",_elId:a+"-"+b._weekIndex,_isRecurring:b.Recurrence&&b.Recurrence!="",_isReminder:b[e.Reminder.name]&&b[e.Reminder.name]!="",Title:b[e.StartDate.name].format("g:ia ")+(!c||c.length==0?"无标题":c)},b)},refresh:function(){if(this.detailPanel){this.detailPanel.hide()}Ext.calendar.MonthView.superclass.refresh.call(this);if(this.showTime!==false){this.initClock()}},renderItems:function(){Ext.calendar.WeekEventRenderer.render({eventGrid:this.allDayOnly?this.allDayGrid:this.eventGrid,viewStart:this.viewStart,tpl:this.getEventTemplate(),maxEventsPerDay:this.maxEventsPerDay,id:this.id,templateDataFn:this.getTemplateEventData.createDelegate(this),evtMaxCount:this.evtMaxCount,weekCount:this.weekCount,dayCount:this.dayCount});this.fireEvent("eventsrendered",this)},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){if(Ext.isDate(a)){a=a.format("Ymd")}return this.id+this.dayElIdDelimiter+a},getWeekIndex:function(b){var a=this.getDayEl(b).up(".ext-cal-wk-ct");return parseInt(a.id.split("-wk-")[1],10)},getDaySize:function(g){var c=this.el.getBox(),a=c.width/this.dayCount,b=c.height/this.getWeekCount();if(g){var e=this.el.select(".ext-cal-dtitle").first().parent("tr");b=e?b-e.getHeight(true):b}return{height:b,width:a}},getEventHeight:function(){if(!this.eventHeight){var a=this.el.select(".ext-cal-evt").first();this.eventHeight=a?a.parent("tr").getHeight():18}return this.eventHeight},getMaxEventsPerDay:function(){var b=this.getDaySize(true).height,c=this.getEventHeight(),a=Math.max(Math.floor((b-c)/c),0);return a},getDayAt:function(a,j){var g=this.el.getBox(),b=this.getDaySize(),c=Math.floor(((a-g.x)/b.width)),h=Math.floor(((j-g.y)/b.height)),i=(h*7)+c,e=this.viewStart.add(Date.DAY,i);return{date:e,el:this.getDayEl(e)}},moveNext:function(){return this.moveMonths(1)},movePrev:function(){return this.moveMonths(-1)},onInitDrag:function(){Ext.calendar.MonthView.superclass.onInitDrag.call(this);Ext.select(this.daySelector).removeClass(this.dayOverClass);if(this.detailPanel){this.detailPanel.hide()}},onMoreClick:function(a){if(!this.detailPanel){this.detailPanel=new Ext.Panel({id:this.id+"-details-panel",title:a.format("F j"),layout:"fit",floating:true,renderTo:Ext.getBody(),tools:[{id:"close",handler:function(g,b,c){c.hide()}}],items:{xtype:"monthdaydetailview",id:this.id+"-details-view",date:a,view:this,store:this.store,listeners:{eventsrendered:this.onDetailViewUpdated.createDelegate(this)}}})}else{this.detailPanel.setTitle(a.format("F j"))}this.detailPanel.getComponent(this.id+"-details-view").update(a)},onDetailViewUpdated:function(i,c,j){var b=this.detailPanel,g=b.getFrameHeight(),k=this.getEventHeight(),a=g+(j*k)+3,h=this.getDayEl(c),e=h.getBox();b.updateBox(e);b.setHeight(a);b.setWidth(Math.max(e.width,220));b.show();b.getPositionEl().alignTo(h,"t-t?")},onHide:function(){Ext.calendar.MonthView.superclass.onHide.call(this);if(this.detailPanel){this.detailPanel.hide()}},onClick:function(h,a){if(this.detailPanel){this.detailPanel.hide()}if(Ext.calendar.MonthView.superclass.onClick.apply(this,arguments)){return}if(this.dropZone){this.dropZone.clearShims()}var b=h.getTarget(this.weekLinkSelector,3),c,g;if(b){c=b.id.split(this.weekLinkIdDelimiter)[1];this.fireEvent("weekclick",this,Date.parseDate(c,"Ymd"));return}b=h.getTarget(this.moreSelector,3);if(b){c=b.id.split(this.moreElIdDelimiter)[1];this.onMoreClick(Date.parseDate(c,"Ymd"));return}b=h.getTarget("td",3);if(b){if(b.id&&b.id.indexOf(this.dayElIdDelimiter)>-1){g=b.id.split(this.dayElIdDelimiter);c=g[g.length-1];this.fireEvent("dayclick",this,Date.parseDate(c,"Ymd"),false,Ext.get(this.getDayId(c)));return}}},handleDayMouseEvent:function(g,a,c){var b=g.getTarget(this.weekLinkSelector,3,true);if(b){b[c=="over"?"addClass":"removeClass"](this.weekLinkOverClass);return}Ext.calendar.MonthView.superclass.handleDayMouseEvent.apply(this,arguments)}});Ext.reg("monthview",Ext.calendar.MonthView);Ext.calendar.WeekEventRenderer=function(){var a=function(j,g,e){var i=1,c,b=Ext.get(j+"-wk-"+g);if(b){var h=b.child(".ext-cal-evt-tbl",true);c=h.tBodies[0].childNodes[e+i];if(!c){c=Ext.DomHelper.append(h.tBodies[0],"<tr></tr>")}}return Ext.get(c)};return{render:function(n){var h=0,b=n.eventGrid,l=n.viewStart.clone(),m=n.tpl,r=n.maxEventsPerDay!=undefined?n.maxEventsPerDay:999,t=n.weekCount<1?6:n.weekCount,p=n.weekCount==1?n.dayCount:7,q;for(;h<t;h++){if(!b[h]||b[h].length==0){if(t==1){g=a(n.id,h,0);q={tag:"td",cls:"ext-cal-ev",id:n.id+"-empty-0-day-"+l.format("Ymd"),html:"&nbsp;"};if(p>1){q.colspan=p}Ext.DomHelper.append(g,q)}l=l.add(Date.DAY,7)}else{var g,y=0,c=b[h],A=l.clone(),i=A.add(Date.DAY,p).add(Date.MILLI,-1);for(;y<p;y++){if(c[y]){var x=emptyCells=skipped=0,s=c[y],e=s.length,k;for(;x<e;x++){if(!s[x]){emptyCells++;continue}if(emptyCells>0&&x-emptyCells<r){g=a(n.id,h,x-emptyCells);q={tag:"td",cls:"ext-cal-ev",id:n.id+"-empty-"+e+"-day-"+l.format("Ymd")};if(emptyCells>1&&r-x>emptyCells){q.rowspan=Math.min(emptyCells,r-x)}Ext.DomHelper.append(g,q);emptyCells=0}if(x>=r){skipped++;continue}k=s[x];if(!k.isSpan||k.isSpanStart){var v=k.data||k.event.data;v._weekIndex=h;v._renderAsAllDay=v[Ext.calendar.EventMappings.IsAllDay.name]||k.isSpanStart;v.spanLeft=v[Ext.calendar.EventMappings.StartDate.name].getTime()<A.getTime();v.spanRight=v[Ext.calendar.EventMappings.EndDate.name].getTime()>i.getTime();v.spanCls=(v.spanLeft?(v.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft"):(v.spanRight?"ext-cal-ev-spanright":""));g=a(n.id,h,x);q={tag:"td",cls:"ext-cal-ev",cn:m.apply(n.templateDataFn(v))};var j=Ext.calendar.Date.diffDays(l,v[Ext.calendar.EventMappings.EndDate.name])+1,u=Math.min(j,p-y);if(u>1){q.colspan=u}Ext.DomHelper.append(g,q)}}if(x>r){g=a(n.id,h,r);Ext.DomHelper.append(g,{tag:"td",cls:"ext-cal-ev-more",id:"ext-cal-ev-more-"+l.format("Ymd"),cn:{tag:"a",html:"+"+skipped+" more..."}})}if(e<n.evtMaxCount[h]){g=a(n.id,h,e);if(g){q={tag:"td",cls:"ext-cal-ev",id:n.id+"-empty-"+(e+1)+"-day-"+l.format("Ymd")};var z=n.evtMaxCount[h]-e;if(z>1){q.rowspan=z}Ext.DomHelper.append(g,q)}}}else{g=a(n.id,h,0);if(g){q={tag:"td",cls:"ext-cal-ev",id:n.id+"-empty-day-"+l.format("Ymd")};if(n.evtMaxCount[h]>1){q.rowSpan=n.evtMaxCount[h]}Ext.DomHelper.append(g,q)}}l=l.add(Date.DAY,1)}}}}}}();
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
;Ext.calendar.WeekView=Ext.extend(Ext.calendar.DayView,{dayCount:7});Ext.reg("weekview",Ext.calendar.WeekView);Ext.ns("Ext.calendar");(function(){Ext.apply(Ext.calendar,{Date:{diffDays:function(b,a){day=1000*60*60*24;diff=a.clearTime(true).getTime()-b.clearTime(true).getTime();return Math.ceil(diff/day)},copyTime:function(c,b){var a=b.clone();a.setHours(c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds());return a},compare:function(c,b,a){if(a!==true){c=c.clone();c.setMilliseconds(0);b=b.clone();b.setMilliseconds(0)}return b.getTime()-c.getTime()},maxOrMin:function(a){var g=(a?0:Number.MAX_VALUE),c=0,b=arguments[1],e=b.length;for(;c<e;c++){g=Math[a?"max":"min"](g,b[c].getTime())}return new Date(g)},max:function(){return this.maxOrMin.apply(this,[true,arguments])},min:function(){return this.maxOrMin.apply(this,[false,arguments])}}})})();Ext.calendar.DayHeaderTemplate=function(a){Ext.apply(this,a);this.allDayTpl=new Ext.calendar.BoxLayoutTemplate(a);this.allDayTpl.compile();Ext.calendar.DayHeaderTemplate.superclass.constructor.call(this,'<div class="ext-cal-hd-ct">','<table class="ext-cal-hd-days-tbl" cellspacing="0" cellpadding="0">',"<tbody>","<tr>",'<td class="ext-cal-gutter"></td>','<td class="ext-cal-hd-days-td"><div class="ext-cal-hd-ad-inner">{allDayTpl}</div></td>','<td class="ext-cal-gutter-rt"></td>',"</tr>","</tobdy>","</table>","</div>")};Ext.extend(Ext.calendar.DayHeaderTemplate,Ext.XTemplate,{applyTemplate:function(a){return Ext.calendar.DayHeaderTemplate.superclass.applyTemplate.call(this,{allDayTpl:this.allDayTpl.apply(a)})}});Ext.calendar.DayHeaderTemplate.prototype.apply=Ext.calendar.DayHeaderTemplate.prototype.applyTemplate;Ext.calendar.DayBodyTemplate=function(a){Ext.apply(this,a);Ext.calendar.DayBodyTemplate.superclass.constructor.call(this,'<table class="ext-cal-bg-tbl" cellspacing="0" cellpadding="0">',"<tbody>",'<tr height="1">','<td class="ext-cal-gutter"></td>','<td colspan="{dayCount}">','<div class="ext-cal-bg-rows">','<div class="ext-cal-bg-rows-inner">','<tpl for="times">','<tpl if="isWorker == true">','<div class="ext-cal-bg-row">','<div class="ext-cal-bg-row-div ext-row-{[xindex]}"></div>',"</div>","</tpl>",'<tpl if="isWorker == false">','<div class="ext-cal-bg-row" style="background: #b3b3b3;">','<div class="" style="background: #b3b3b3;"></div>',"</div>","</tpl>","</tpl>","</div>","</div>","</td>","</tr>","<tr>",'<td class="ext-cal-day-times">','<tpl for="times">','<div class="ext-cal-bg-row">','<div class="ext-cal-day-time-inner">{dt}</div>',"</div>","</tpl>","</td>",'<tpl for="days">','<td class="ext-cal-day-col">','<tpl if="worker == true">','<div class="ext-cal-day-col-inner">',"</tpl>",'<tpl if="worker == false">','<div class="ext-cal-day-col-inner" style="background: #b3b3b3;">',"</tpl>",'<div id="{[this.id]}-day-col-{dt:date("Ymd")}" class="ext-cal-day-col-gutter"></div>',"</div>","</td>","</tpl>","</tr>","</tbody>","</table>")};Ext.extend(Ext.calendar.DayBodyTemplate,Ext.XTemplate,{applyTemplate:function(j){this.today=new Date().clearTime();this.dayCount=this.dayCount||1;var c=0,k=[],b,g,e=j.viewStart.clone(),h;for(;c<this.dayCount;c++){b=e.add(Date.DAY,c);g=this.workDays.indexOf(parseInt(b.format("w"))+1)>=0;k[c]={dt:e.add(Date.DAY,c),worker:g}}h=[];e=new Date().clearTime();for(c=0;c<24;c++){var a=e.format("H:i");g=this.workTimes.indexOf(a)>=0;h.push({dt:e.format("H:i"),isWorker:g});e=e.add(Date.HOUR,1)}return Ext.calendar.DayBodyTemplate.superclass.applyTemplate.call(this,{days:k,dayCount:k.length,times:h,workDays:this.workDays,workTimes:this.workTimes})}});Ext.calendar.DayBodyTemplate.prototype.apply=Ext.calendar.DayBodyTemplate.prototype.applyTemplate;Ext.calendar.DayViewTemplate=function(a){Ext.apply(this,a);this.headerTpl=new Ext.calendar.DayHeaderTemplate(a);this.headerTpl.compile();this.bodyTpl=new Ext.calendar.DayBodyTemplate(a);this.bodyTpl.compile();Ext.calendar.DayViewTemplate.superclass.constructor.call(this,'<div class="ext-cal-inner-ct">',"{headerTpl}","{bodyTpl}","</div>")};Ext.extend(Ext.calendar.DayViewTemplate,Ext.XTemplate,{applyTemplate:function(a){return Ext.calendar.DayViewTemplate.superclass.applyTemplate.call(this,{headerTpl:this.headerTpl.apply(a),bodyTpl:this.bodyTpl.apply(a)})}});Ext.calendar.DayViewTemplate.prototype.apply=Ext.calendar.DayViewTemplate.prototype.applyTemplate;Ext.calendar.MonthViewTemplate=function(a){Ext.apply(this,a);this.weekTpl=new Ext.calendar.BoxLayoutTemplate(a);this.weekTpl.compile();var b=this.showWeekLinks?'<div class="ext-cal-week-link-hd">&nbsp;</div>':"";Ext.calendar.MonthViewTemplate.superclass.constructor.call(this,'<div class="ext-cal-inner-ct {extraClasses}">','<div class="ext-cal-hd-ct ext-cal-month-hd">',b,'<table class="ext-cal-hd-days-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for="days">','<th class="ext-cal-hd-day{[xindex==1 ? " ext-cal-day-first" : ""]}" title="{.:date("l, F j, Y")}">{.:date("D")}</th>',"</tpl>","</tr>","</tbody>","</table>","</div>",'<div class="ext-cal-body-ct">{weeks}</div>',"</div>")};Ext.extend(Ext.calendar.MonthViewTemplate,Ext.XTemplate,{applyTemplate:function(g){var h=[],e=this.weekTpl.apply(g),c=g.viewStart;for(var b=0;b<7;b++){h.push(c.add(Date.DAY,b))}var a=this.showHeader===true?"":"ext-cal-noheader";if(this.showWeekLinks){a+=" ext-cal-week-links"}return Ext.calendar.MonthViewTemplate.superclass.applyTemplate.call(this,{days:h,weeks:e,extraClasses:a})}});Ext.calendar.MonthViewTemplate.prototype.apply=Ext.calendar.MonthViewTemplate.prototype.applyTemplate;Ext.calendar.BoxLayoutTemplate=function(a){Ext.apply(this,a);var b=this.showWeekLinks?'<div id="{weekLinkId}" class="ext-cal-week-link">{weekNum}</div>':"";Ext.calendar.BoxLayoutTemplate.superclass.constructor.call(this,'<tpl for="weeks">','<div id="{[this.id]}-wk-{[xindex-1]}" class="ext-cal-wk-ct" style="top:{[this.getRowTop(xindex, xcount)]}%; height:{[this.getRowHeight(xcount)]}%;">',b,'<table class="ext-cal-bg-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-day-{date:date("Ymd")}" class="{cellCls}">&nbsp;</td>',"</tpl>","</tr>","</tbody>","</table>",'<table class="ext-cal-evt-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-ev-day-{date:date("Ymd")}" class="{titleCls}"><div>{title}</div></td>',"</tpl>","</tr>","</tbody>","</table>","</div>","</tpl>",{getRowTop:function(c,e){return((c-1)*(100/e))},getRowHeight:function(c){return 100/c}})};Ext.extend(Ext.calendar.BoxLayoutTemplate,Ext.XTemplate,{applyTemplate:function(e){Ext.apply(this,e);var p=0,n="",i=true,k=false,g=false,h=false,j=false,a=[[]],m=new Date().clearTime(),c=this.viewStart.clone(),b=this.startDate.getMonth();for(;p<this.weekCount||this.weekCount==-1;p++){if(c>this.viewEnd){break}a[p]=[];for(var l=0;l<this.dayCount;l++){k=c.getTime()===m.getTime();g=i||(c.getDate()==1);h=(c.getMonth()<b)&&this.weekCount==-1;j=(c.getMonth()>b)&&this.weekCount==-1;if(c.getDay()==1){a[p].weekNum=this.showWeekNumbers?c.format("W"):"&nbsp;";a[p].weekLinkId="ext-cal-week-"+c.format("Ymd")}if(g){if(k){n=this.getTodayText()}else{n=c.format(this.dayCount==1?"l, F j, Y":(i?"M j, Y":"M j"))}}else{var q=(p==0&&this.showHeader!==true)?"D j":"j";n=k?this.getTodayText():c.format(q)}a[p].push({title:n,date:c.clone(),titleCls:"ext-cal-dtitle "+(k?" ext-cal-dtitle-today":"")+(p==0?" ext-cal-dtitle-first":"")+(h?" ext-cal-dtitle-prev":"")+(j?" ext-cal-dtitle-next":""),cellCls:"ext-cal-day "+(k?" ext-cal-day-today":"")+(l==0?" ext-cal-day-first":"")+(h?" ext-cal-day-prev":"")+(j?" ext-cal-day-next":"")});c=c.add(Date.DAY,1);i=false}}return Ext.calendar.BoxLayoutTemplate.superclass.applyTemplate.call(this,{weeks:a})},getTodayText:function(){var b=new Date().format("l, F j, Y"),c=this.showTodayText!==false?this.todayText:"",a=this.showTime!==false?' <span id="'+this.id+'-clock" class="ext-cal-dtitle-time">'+new Date().format("g:i a")+"</span>":"",e=c.length>0||a.length>0?" &mdash; ":"";if(this.dayCount==1){return b+e+c+a}fmt=this.weekCount==1?"D j":"j";return c.length>0?c+a:new Date().format(fmt)+a}});Ext.calendar.BoxLayoutTemplate.prototype.apply=Ext.calendar.BoxLayoutTemplate.prototype.applyTemplate;Ext.calendar.DragZone=Ext.extend(Ext.dd.DragZone,{ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",constructor:function(b,a){if(!Ext.calendar._statusProxyInstance){Ext.calendar._statusProxyInstance=new Ext.calendar.StatusProxy()}this.proxy=Ext.calendar._statusProxyInstance;Ext.calendar.DragZone.superclass.constructor.call(this,b,a)},getDragData:function(b){var a=b.getTarget(this.eventSelector,3);if(a){var c=this.view.getEventRecordFromEl(a);return{type:"eventdrag",ddel:a,eventStart:c.data[Ext.calendar.EventMappings.StartDate.name],eventEnd:c.data[Ext.calendar.EventMappings.EndDate.name],proxy:this.proxy}}a=this.view.getDayAt(b.getPageX(),b.getPageY());if(a.el){return{type:"caldrag",start:a.date,proxy:this.proxy}}return null},onInitDrag:function(a,e){if(this.dragData.ddel){var b=this.dragData.ddel.cloneNode(true),c=Ext.fly(b).child("dl");Ext.fly(b).setWidth("auto");if(c){c.setHeight("auto")}this.proxy.update(b);this.onStartDrag(a,e)}else{if(this.dragData.start){this.onStartDrag(a,e)}}this.view.onInitDrag();return true},afterRepair:function(){if(Ext.enableFx&&this.dragData.ddel){Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9")}this.dragging=false},getRepairXY:function(a){if(this.dragData.ddel){return Ext.Element.fly(this.dragData.ddel).getXY()}},afterInvalidDrop:function(a,b){Ext.select(".ext-dd-shim").hide()}});Ext.calendar.DropZone=Ext.extend(Ext.dd.DropZone,{ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",shims:[],getTargetFromEvent:function(b){var a=this.dragOffset||0,g=b.getPageY()-a,c=this.view.getDayAt(b.getPageX(),g);return c.el?c:null},onNodeOver:function(g,l,k,i){var a=Ext.calendar.Date,b=i.type=="eventdrag"?g.date:a.min(i.start,g.date),h=i.type=="eventdrag"?g.date.add(Date.DAY,a.diffDays(i.eventStart,i.eventEnd)):a.max(i.start,g.date);if(!this.dragStartDate||!this.dragEndDate||(a.diffDays(b,this.dragStartDate)!=0)||(a.diffDays(h,this.dragEndDate)!=0)){this.dragStartDate=b;this.dragEndDate=h.clearTime().add(Date.DAY,1).add(Date.MILLI,-1);this.shim(b,h);var j=b.format("n/j");if(a.diffDays(b,h)>0){j+="-"+h.format("n/j")}var c=String.format(i.type=="eventdrag"?this.moveText:this.createText,j);i.proxy.updateMsg(c)}return this.dropAllowed},shim:function(a,g){this.currWeek=-1;var b=a.clone(),h=0,e,j,c=Ext.calendar.Date.diffDays(b,g)+1;Ext.each(this.shims,function(i){if(i){i.isActive=false}});while(h++<c){var k=this.view.getDayEl(b);if(k){var l=this.view.getWeekIndex(b);e=this.shims[l];if(!e){e=this.createShim();this.shims[l]=e}if(l!=this.currWeek){e.boxInfo=k.getBox();this.currWeek=l}else{j=k.getBox();e.boxInfo.right=j.right;e.boxInfo.width=j.right-e.boxInfo.x}e.isActive=true}b=b.add(Date.DAY,1)}Ext.each(this.shims,function(i){if(i){if(i.isActive){i.show();i.setBox(i.boxInfo)}else{if(i.isVisible()){i.hide()}}}})},createShim:function(){if(!this.shimCt){this.shimCt=Ext.get("ext-dd-shim-ct");if(!this.shimCt){this.shimCt=document.createElement("div");this.shimCt.id="ext-dd-shim-ct";Ext.getBody().appendChild(this.shimCt)}}var a=document.createElement("div");a.className="ext-dd-shim";this.shimCt.appendChild(a);return new Ext.Layer({shadow:false,useDisplay:true,constrain:false},a)},clearShims:function(){Ext.each(this.shims,function(a){if(a){a.hide()}})},onContainerOver:function(a,c,b){return this.dropAllowed},onCalendarDragComplete:function(){delete this.dragStartDate;delete this.dragEndDate;this.clearShims()},onNodeDrop:function(i,a,g,c){if(i&&c){if(c.type=="eventdrag"){var h=this.view.getEventRecordFromEl(c.ddel),b=Ext.calendar.Date.copyTime(h.data[Ext.calendar.EventMappings.StartDate.name],i.date);this.view.onEventDrop(h,b);this.onCalendarDragComplete();return true}if(c.type=="caldrag"){this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,this.onCalendarDragComplete.createDelegate(this));return true}}this.onCalendarDragComplete();return false},onContainerDrop:function(a,c,b){this.onCalendarDragComplete();return false},destroy:function(){Ext.calendar.DropZone.superclass.destroy.call(this);Ext.destroy(this.shimCt)}});Ext.dd.ScrollManager=function(){var c=Ext.dd.DragDropMgr,g={},b=null,j={},i=function(m){b=null;a()},k=function(){if(c.dragCurrent){c.refreshCache(c.dragCurrent.groups)}},e=function(){if(c.dragCurrent){var m=Ext.dd.ScrollManager,n=j.el.ddScrollConfig?j.el.ddScrollConfig.increment:m.increment;if(!m.animate){if(j.el.scroll(j.dir,n)){k()}}else{j.el.scroll(j.dir,n,true,m.animDuration,k)}}},a=function(){if(j.id){clearInterval(j.id)}j.id=0;j.el=null;j.dir=""},h=function(n,m){a();j.el=n;j.dir=m;var p=(n.ddScrollConfig&&n.ddScrollConfig.frequency)?n.ddScrollConfig.frequency:Ext.dd.ScrollManager.frequency,o=n.ddScrollConfig?n.ddScrollConfig.ddGroup:undefined;if(o===undefined||c.dragCurrent.ddGroup==o){j.id=setInterval(e,p)}},l=function(p,s){if(s||!c.dragCurrent){return}var t=Ext.dd.ScrollManager;if(!b||b!=c.dragCurrent){b=c.dragCurrent;t.refreshCache()}var u=Ext.lib.Event.getXY(p),v=new Ext.lib.Point(u[0],u[1]),n,o,m,q;for(n in g){if(g.hasOwnProperty(n)){o=g[n];m=o._region;q=o.ddScrollConfig?o.ddScrollConfig:t;if(m&&m.contains(v)&&o.isScrollable()){if(m.bottom-v.y<=q.vthresh){if(j.el!=o){h(o,"down")}return}else{if(m.right-v.x<=q.hthresh){if(j.el!=o){h(o,"left")}return}else{if(v.y-m.top<=q.vthresh){if(j.el!=o){h(o,"up")}return}else{if(v.x-m.left<=q.hthresh){if(j.el!=o){h(o,"right")}return}}}}}}}a()};c.fireEvents=c.fireEvents.createSequence(l,c);c.stopDrag=c.stopDrag.createSequence(i,c);return{register:function(o){if(Ext.isArray(o)){var n=0,m=o.length;for(;n<m;n++){this.register(o[n])}}else{o=Ext.get(o);g[o.id]=o}},unregister:function(o){if(Ext.isArray(o)){var n=0,m=o.length;for(;n<m;n++){this.unregister(o[n])}}else{o=Ext.get(o);delete g[o.id]}},vthresh:25,hthresh:25,increment:100,frequency:500,animate:true,animDuration:0.4,refreshCache:function(){var m;for(m in g){if(g.hasOwnProperty(m)){if(typeof g[m]=="object"){g[m]._region=g[m].getRegion()}}}}}}();Ext.calendar.DayViewDragZone=Ext.extend(Ext.calendar.DragZone,{ddGroup:"DayViewDD",resizeSelector:".ext-evt-rsz",getDragData:function(c){var a=c.getTarget(this.resizeSelector,2,true),b,g;if(a){b=a.parent(this.eventSelector);g=this.view.getEventRecordFromEl(b);return{type:"eventresize",ddel:b.dom,eventStart:g.data[Ext.calendar.EventMappings.StartDate.name],eventEnd:g.data[Ext.calendar.EventMappings.EndDate.name],proxy:this.proxy}}a=c.getTarget(this.eventSelector,3);if(a){g=this.view.getEventRecordFromEl(a);return{type:"eventdrag",ddel:a,eventStart:g.data[Ext.calendar.EventMappings.StartDate.name],eventEnd:g.data[Ext.calendar.EventMappings.EndDate.name],proxy:this.proxy}}a=this.view.getDayAt(c.getPageX(),c.getPageY());if(a.el){return{type:"caldrag",dayInfo:a,proxy:this.proxy}}return null}});Ext.calendar.DayViewDropZone=Ext.extend(Ext.calendar.DropZone,{ddGroup:"DayViewDD",onNodeOver:function(c,l,k,h){var b,i,j,m=this.createText,q,a,g,p,o;if(h.type=="caldrag"){if(!this.dragStartMarker){this.dragStartMarker=c.el.parent().createChild({style:"position:absolute;"});this.dragStartMarker.setBox(c.timeBox);this.dragCreateDt=c.date}i=this.dragStartMarker.getBox();i.height=Math.ceil(Math.abs(k.xy[1]-i.y)/c.timeBox.height)*c.timeBox.height;if(k.xy[1]<i.y){i.height+=c.timeBox.height;i.y=i.y-i.height+c.timeBox.height;j=this.dragCreateDt.add(Date.MINUTE,30)}else{c.date=c.date.add(Date.MINUTE,30)}this.shim(this.dragCreateDt,i);q=Ext.calendar.Date.copyTime(c.date,this.dragCreateDt);this.dragStartDate=Ext.calendar.Date.min(this.dragCreateDt,q);this.dragEndDate=j||Ext.calendar.Date.max(this.dragCreateDt,q);b=this.dragStartDate.format("g:ia-")+this.dragEndDate.format("g:ia")}else{p=Ext.get(h.ddel);o=p.parent().parent();i=p.getBox();i.width=o.getWidth();if(h.type=="eventdrag"){if(this.dragOffset===undefined){this.dragOffset=c.timeBox.y-i.y;i.y=c.timeBox.y-this.dragOffset}else{i.y=c.timeBox.y}b=c.date.format("n/j g:ia");i.x=c.el.getLeft();this.shim(c.date,i);m=this.moveText}if(h.type=="eventresize"){if(!this.resizeDt){this.resizeDt=c.date}i.x=o.getLeft();i.height=Math.ceil(Math.abs(k.xy[1]-i.y)/c.timeBox.height)*c.timeBox.height;if(k.xy[1]<i.y){i.y-=i.height}else{c.date=c.date.add(Date.MINUTE,30)}this.shim(this.resizeDt,i);q=Ext.calendar.Date.copyTime(c.date,this.resizeDt);a=Ext.calendar.Date.min(h.eventStart,q);g=Ext.calendar.Date.max(h.eventStart,q);h.resizeDates={StartDate:a,EndDate:g};b=a.format("g:ia-")+g.format("g:ia");m=this.resizeText}}h.proxy.updateMsg(String.format(m,b));return this.dropAllowed},shim:function(b,a){Ext.each(this.shims,function(e){if(e){e.isActive=false;e.hide()}});var c=this.shims[0];if(!c){c=this.createShim();this.shims[0]=c}c.isActive=true;c.show();c.setBox(a)},onNodeDrop:function(h,a,c,b){var g;if(h&&b){if(b.type=="eventdrag"){g=this.view.getEventRecordFromEl(b.ddel);this.view.onEventDrop(g,h.date);this.onCalendarDragComplete();delete this.dragOffset;return true}if(b.type=="eventresize"){g=this.view.getEventRecordFromEl(b.ddel);this.view.onEventResize(g,b.resizeDates);this.onCalendarDragComplete();delete this.resizeDt;return true}if(b.type=="caldrag"){Ext.destroy(this.dragStartMarker);delete this.dragStartMarker;delete this.dragCreateDt;this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,this.onCalendarDragComplete.createDelegate(this));return true}}this.onCalendarDragComplete();return false}});Ext.calendar.StatusProxy=function(a){Ext.apply(this,a);this.id=this.id||Ext.id();this.el=new Ext.Layer({dh:{id:this.id,cls:"ext-dd-drag-proxy x-dd-drag-proxy "+this.dropNotAllowed,cn:[{cls:"x-dd-drop-icon"},{cls:"ext-dd-ghost-ct",cn:[{cls:"x-dd-drag-ghost"},{cls:"ext-dd-msg"}]}]},shadow:!a||a.shadow!==false});this.ghost=Ext.get(this.el.dom.childNodes[1].childNodes[0]);this.message=Ext.get(this.el.dom.childNodes[1].childNodes[1]);this.dropStatus=this.dropNotAllowed};Ext.extend(Ext.calendar.StatusProxy,Ext.dd.StatusProxy,{moveEventCls:"ext-cal-dd-move",addEventCls:"ext-cal-dd-add",update:function(a){if(typeof a=="string"){this.ghost.update(a)}else{this.ghost.update("");a.style.margin="0";this.ghost.dom.appendChild(a)}var b=this.ghost.dom.firstChild;if(b){Ext.fly(b).setStyle("float","none").setHeight("auto");Ext.getDom(b).id+="-ddproxy"}},updateMsg:function(a){this.message.update(a)}});String.prototype.lpadding=function(a){var c="0",e="";for(var b=0;b<a;b++){e+=c}return e.substr(0,a-this.length)+this};Number.prototype.lpadding=function(a){var e=this+"",c="0",g="";for(var b=0;b<a;b++){g+=c}return g.substr(0,a-e.length)+e};Ext.apply(Ext.form.VTypes,{daterange:function(e,c){var b=c.parseDate(e);if(!b){return}if(c.startDateField&&(!this.dateRangeMax||(b.getTime()!=this.dateRangeMax.getTime()))){var g=Ext.getCmp(c.startDateField);g.setMaxValue(b);g.validate();this.dateRangeMax=b}else{if(c.endDateField&&(!this.dateRangeMin||(b.getTime()!=this.dateRangeMin.getTime()))){var a=Ext.getCmp(c.endDateField);a.setMinValue(b);a.validate();this.dateRangeMin=b}}return true},timerange:function(e,c){var b=e;if(c.startTimeField&&(!this.timeRangeMax||(b!=this.timeRangeMax))){var g=Ext.getCmp(c.startTimeField);g.setMaxValue(b);g.validate();this.timeRangeMax=b}else{if(c.endTimeField&&(!this.timeRangeMin||(b!=this.timeRangeMin))){var a=Ext.getCmp(c.endTimeField);a.setMinValue(b);a.validate();this.timeRangeMin=b}}return true}});Ext.ux.ComboField=Ext.extend(Ext.form.ComboBox,{url:"",keyId:"id",keyName:"name",bean:null,root:null,idProperty:null,totalProperty:null,initComponent:function(){var a=this;a.mode="local";a.editable=false;if(!a.store){if(!a.bean){a.bean=[a.keyId,a.keyName]}a.reader=new Ext.data.JsonReader({root:a.root,idProperty:a.idProperty,totalProperty:a.totalProperty},a.bean);a.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:a.url}),reader:a.reader})}a.valueField=a.keyId;a.displayField=a.keyName;a.triggerAction="all";a.typeAhead=true;a.selectOnFocus=true;a.forceSelection=true;Ext.ux.ComboField.superclass.initComponent.call(a)}});Ext.reg("combox",Ext.ux.ComboField);Ext.ux.CourseField=Ext.extend(Ext.form.ComboBox,{bean:null,root:null,idProperty:null,totalProperty:null,url:"",coachId:null,initComponent:function(){var b=this;if(!b.store){var a=b.displayField||"name";b.bean=Ext.data.Record.create([{name:"id",type:"int"},{name:a,type:"string"},{name:"charge",type:"string"}]);b.reader=new Ext.data.JsonReader({root:b.root,idProperty:b.idProperty,totalProperty:b.totalProperty},b.bean);b.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:b.url}),reader:b.reader});b.store.on("beforeload",b.handleParam,b)}b.mode="local";b.editable=false;b.valueField="id";b.displayField="name";b.triggerAction="all";b.typeAhead=true;b.selectOnFocus=true;b.forceSelection=true;b.on("select",b.selectData,b);Ext.ux.CourseField.superclass.initComponent.call(b)},handleParam:function(a){Ext.apply(a.baseParams,{coachId:this.coachId})},setCoachId:function(a){this.coachId=a;this.store.reload()},selectData:function(b,c,a){if(this.type==1||this.type==3){Ext.getCmp("Intensity").setValue(c.get("intensity"))}}});Ext.reg("course",Ext.ux.CourseField);Ext.ux.WeekNumField=Ext.extend(Ext.form.ComboBox,{initComponent:function(){this.mode="local";this.editable=false;this.store=new Ext.data.JsonStore({root:"nums",idProperty:"id",autoLoad:true,proxy:new Ext.data.MemoryProxy(),fields:["id","title"],data:weekOfNoList});this.valueField="id";this.displayField="title";this.triggerAction="all";this.typeAhead=true;this.selectOnFocus=true;this.forceSelection=true;Ext.ux.WeekNumField.superclass.initComponent.call(this)}});Ext.reg("weeknum",Ext.ux.WeekNumField);Ext.ux.WeeksField=Ext.extend(Ext.form.ComboBox,{initComponent:function(){this.mode="local";this.editable=false;this.store=new Ext.data.JsonStore({root:"weeks",idProperty:"id",autoLoad:true,proxy:new Ext.data.MemoryProxy(),fields:["id","title"],data:weekOfList});this.valueField="id";this.displayField="title";this.triggerAction="all";this.typeAhead=true;this.selectOnFocus=true;this.forceSelection=true;Ext.ux.WeeksField.superclass.initComponent.call(this)}});Ext.reg("weeks",Ext.ux.WeeksField);Ext.ux.ColorField=Ext.extend(Ext.form.TriggerField,{triggerConfig:{src:Ext.BLANK_IMAGE_URL,tag:"img",cls:"x-form-trigger x-form-color-trigger"},invalidText:"Colors must be in a the hex format #FFFFFF.",regex:/^\#[0-9A-F]{6}$/i,editable:false,allowBlank:true,initComponent:function(){Ext.ux.ColorField.superclass.initComponent.call(this);this.addEvents("select");this.on("change",function(b,a){this.onSelect(b,a)},this)},onDestroy:function(){Ext.destroy(this.menu);Ext.ux.ColorField.superclass.onDestroy.call(this)},afterRender:function(){Ext.ux.ColorField.superclass.afterRender.call(this);this.el.setStyle("background",this.value);this.detectFontColor()},onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new Ext.ux.ColorMenu({hideOnClick:false,fallback:this.fallback})}this.onFocus();this.menu.picker.setValue(this.getValue()||"#FFFFFF");this.menu.show(this.el,"tl-bl?");this.menuEvents("on")},menuEvents:function(a){this.menu[a]("select",this.onSelect,this);this.menu[a]("hide",this.onMenuHide,this);this.menu[a]("show",this.onFocus,this)},onSelect:function(a,b){this.setValue(b);this.fireEvent("select",this,b);this.el.setStyle("background",b);this.detectFontColor()},detectFontColor:function(){if(!this.menu||!this.menu.picker.rawValue){if(!this.value){b="FFFFFF"}else{var a=function(e){return parseInt(e,16)};var b=[a(this.value.slice(1,3)),a(this.value.slice(3,5)),a(this.value.slice(5))]}}else{var b=this.menu.picker.rawValue}var c=(b[0]+b[1]+b[2])/3;this.el.setStyle("color",(c>128)?"#000":"#FFF")},onMenuHide:function(){this.focus(false,60);this.menuEvents("un")}});Ext.ux.ColorMenu=Ext.extend(Ext.menu.Menu,{enableScrolling:false,initComponent:function(){Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new Ext.ux.ColorPicker(Ext.apply({internalRender:this.strict||!Ext.isIE,wheelImage:this.wheelImage,gradientImage:this.gradientImage,fallback:this.fallback},this.initialConfig))});this.picker.purgeListeners();Ext.ux.ColorMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}},menuHide:function(){if(this.hideOnClick){this.hide(true)}},doLayout:function(b,a){Ext.ux.ColorMenu.superclass.doLayout.call(this,b,a);this.getEl().setZIndex(30000)}});Ext.ux.ColorMenu.prototype.wheelImage=(function(){var a=new Image();a.onload=Ext.emptyFn;a.src="images/wheel.png";return a})();Ext.ux.ColorMenu.prototype.gradientImage=(function(){var a=new Image();a.onload=Ext.emptyFn;a.src="images/gradient.png";return a})();Ext.ux.ColorPicker=function(a){Ext.ux.ColorPicker.superclass.constructor.call(this,a);this.addEvents("select");if(!this.value){this.value=this.defaultValue}if(this.handler){this.on("select",this.handler,this.scope,true)}};Ext.extend(Ext.ux.ColorPicker,Ext.ColorPalette,{canvasSupported:true,itemCls:"x-color-picker",defaultValue:"#333333",width:200,onRender:function(b,a){if(!this.value){this.value=this.defaultValue}var c=document.createElement("div");c.className=this.itemCls;b.dom.insertBefore(c,a);Ext.get(c).setWidth(this.width);this.canvasdiv=Ext.get(c).createChild({tag:"div"});this.wheel=this.canvasdiv.dom.appendChild(document.createElement("canvas"));this.wheel.setAttribute("width","200");this.wheel.setAttribute("height","200");this.wheel.setAttribute("class","x-color-picker-wheel");if(this.fallback||!this.wheel.getContext||!this.wheel.getContext("2d").getImageData){this.canvasSupported=false;this.itemCls="x-color-palette";while(b.dom.firstChild){b.dom.removeChild(b.dom.firstChild)}Ext.ux.ColorPicker.superclass.onRender.call(this,b,a);return}this.wheel.getContext("2d").drawImage(this.wheelImage,0,0);this.drawGradient();Ext.get(this.wheel).on("click",this.select,this);this.el=Ext.get(c)},afterRender:function(){Ext.ColorPalette.superclass.afterRender.call(this);if(!this.canvasSupported){return}var b=new Ext.dd.DragDrop(this.wheel);var a=this;b.onDrag=function(g,c){a.select(g,this.DDM.currentTarget)}},select:function(h,b){if(!this.canvasSupported){this.value=h;Ext.ux.ColorPicker.superclass.select.call(this,h);this.fireEvent("select",this,"#"+this.value);return}var a=this.wheel.getContext("2d");var g=[h.xy[0]-Ext.get(b).getLeft(),h.xy[1]-Ext.get(b).getTop()];try{var c=a.getImageData(g[0],g[1],1,1)}catch(h){return}if(c.data[3]==0){var a=this.gradient.getContext("2d");var c=a.getImageData(g[0],g[1],1,1);if(c.data[3]==0){return}this.rawValue=c.data;this.value=this.hexValue(c.data[0],c.data[1],c.data[2]);this.fireEvent("select",this,this.value)}else{this.rawValue=c.data;this.value=this.hexValue(c.data[0],c.data[1],c.data[2]);this.drawGradient();this.fireEvent("select",this,this.value)}},drawGradient:function(){if(!this.gradient){this.gradient=this.canvasdiv.dom.appendChild(document.createElement("canvas"));this.gradient.setAttribute("width","200");this.gradient.setAttribute("height","200");this.gradient.setAttribute("class","x-color-picker-gradient");if(typeof G_vmlCanvasManager!="undefined"){this.gradient=G_vmlCanvasManager.initElement(this.gradient)}Ext.get(this.gradient).on("click",this.select,this)}var b=this.gradient.getContext("2d");var a=[97.5,98];b.clearRect(0,0,this.gradient.width,this.gradient.height);b.beginPath();b.fillStyle=this.value;b.strokeStyle=this.value;b.arc(a[0],a[0],65,0,2*Math.PI,false);b.closePath();b.fill();this.gradient.getContext("2d").drawImage(this.gradientImage,33,32)},hexValue:function(h,e,a){var c="0123456789ABCDEF";return"#"+(c[parseInt(h/16)]+c[parseInt(h%16)]+c[parseInt(e/16)]+c[parseInt(e%16)]+c[parseInt(a/16)]+c[parseInt(a%16)])},getValue:function(){return this.value},setValue:function(a){this.value=a}});Ext.reg("colorfield",Ext.ux.ColorField);Ext.calendar.ColorPicker=Ext.extend(Ext.form.ComboBox,{fieldLabel:"事件颜色",valueField:"Id",displayField:"Title",triggerAction:"all",mode:"local",forceSelection:true,width:200,initComponent:function(){this.store=new Ext.data.JsonStore({storeId:"colorStore",root:"colors",idProperty:"id",data:colorList,proxy:new Ext.data.MemoryProxy(),autoLoad:true,fields:[{name:"Id",mapping:"id",type:"int"},{name:"Title",mapping:"title",type:"string"}],sortInfo:{field:"Id",direction:"ASC"}});Ext.calendar.ColorPicker.superclass.initComponent.call(this);this.tpl=this.tpl||'<tpl for="."><div class="x-combo-list-item ext-color-{'+this.valueField+'}"><div class="ext-cal-picker-icon">&nbsp;</div>{'+this.displayField+"}</div></tpl>"},afterRender:function(){Ext.calendar.ColorPicker.superclass.afterRender.call(this);this.wrap=this.el.up(".x-form-field-wrap");this.wrap.addClass("ext-calendar-picker");this.icon=Ext.DomHelper.append(this.wrap,{tag:"div",cls:"ext-cal-picker-icon ext-cal-picker-mainicon"})},setValue:function(a){this.wrap.removeClass("ext-color-"+this.getValue());if(!a&&this.store!==undefined){a=this.store.getAt(0).data.Id}Ext.calendar.ColorPicker.superclass.setValue.call(this,a);this.wrap.addClass("ext-color-"+a)}});Ext.reg("colorpicker",Ext.calendar.ColorPicker);Ext.calendar.DateRepeatField=Ext.extend(Ext.form.Field,{toText:"to",onRender:function(b,a){if(!this.el){this.whereField=new Ext.form.RadioGroup({id:"mode",columns:1,disabled:this.disabled,items:[{boxLabel:"按日",name:"mode",inputValue:1},{boxLabel:"按周",name:"mode",inputValue:2},{boxLabel:"按月",name:"mode",inputValue:3}]});this.whereField.on("change",this.changeView,this);this.dayField=new Ext.form.CompositeField({disabled:this.disabled,items:[{xtype:"displayfield",value:"每",style:"margin-top:5px;"},{xtype:"numberfield",id:"dayNum",name:"dayNum",width:50},{xtype:"displayfield",value:"天",style:"margin-top:5px;"}]});this.weekField=new Ext.form.CheckboxGroup({hidden:true,columns:3,disabled:this.disabled,items:[{boxLabel:"星期日",name:"cb-auto-1",inputValue:1},{boxLabel:"星期一",name:"cb-auto-2",inputValue:2},{boxLabel:"星期二",name:"cb-auto-3",inputValue:3},{boxLabel:"星期三",name:"cb-auto-4",inputValue:4},{boxLabel:"星期四",name:"cb-auto-5",inputValue:5},{boxLabel:"星期五",name:"cb-auto-5",inputValue:6},{boxLabel:"星期六",name:"cb-auto-5",inputValue:7}]});this.dayOfMonth=new Ext.form.CompositeField({hidden:true,disabled:this.disabled,items:[{xtype:"radio",id:"month1",name:"month",boxLabel:"每月的第"},{xtype:"numberfield",id:"dayNum1",width:50},{xtype:"displayfield",value:"天",style:"margin-top:5px;"}]});this.weekOfMonth=new Ext.form.CompositeField({hidden:true,disabled:this.disabled,items:[{xtype:"radio",id:"month2",name:"month",boxLabel:"每月的第"},{xtype:"weeknum",id:"weekNum1",width:60},{xtype:"weeks",id:"weekNum2",width:60}]});this.fieldCt=new Ext.Container({autoEl:{id:this.id},cls:"ext-dt-range",renderTo:b,layout:"column",height:65,defaults:{hideParent:true},items:[{columnWidth:0.3,baseCls:"x-plain",items:[this.whereField]},{columnWidth:0.7,baseCls:"x-plain",items:[this.dayField,this.weekField,this.dayOfMonth,this.weekOfMonth]}]});this.fieldCt.ownerCt=this;this.el=this.fieldCt.getEl();this.items=new Ext.util.MixedCollection();this.items.addAll([this.whereField,this.dayField,this.weekField,this.dayOfMonth,this.weekOfMonth])}Ext.calendar.DateRepeatField.superclass.onRender.call(this,b,a)},changeView:function(a,b){if(a.getValue()){var c=a.getValue().inputValue;if(c==1){this.weekField.hide();this.dayOfMonth.hide();this.weekOfMonth.hide();this.dayField.show()}else{if(c==2){this.dayField.hide();this.weekField.show();this.dayOfMonth.hide();this.weekOfMonth.hide()}else{this.dayField.hide();this.weekField.hide();this.dayOfMonth.show();this.weekOfMonth.show()}}}},getValue:function(){var b={};if(this.whereField.getValue()){var a=this.whereField.getValue().inputValue;if(a==1){b={RepeatMode:1,RepeatValue:Ext.getCmp("dayNum").getValue()}}else{if(a==2){var e="";arr=this.weekField.getValue();for(var c=0;c<arr.length;c++){e=e+(c>0?",":"")+arr[c].inputValue}b={RepeatMode:2,RepeatValue:e}}else{if(a==3){if(Ext.getCmp("month1").getValue()==true){b={RepeatMode:3,RepeatValue:Ext.getCmp("dayNum1").getValue()}}else{if(Ext.getCmp("month2").getValue()==true){b={RepeatMode:4,RepeatValue:Ext.getCmp("weekNum1").getValue(),RepeatWeekOf:Ext.getCmp("weekNum2").getValue()}}}}}}}return b},setValue:function(a){if(a!=null&&a.mode){var e=a.mode;var b=e==4?3:e;this.whereField.items.each(function(g){if(g.inputValue==b){g.setValue(true)}});if(e==1){Ext.getCmp("dayNum").setValue(a.value)}else{if(e==2){var c=a.value.split(",")+",";this.weekField.items.each(function(g){if(c.indexOf(g.inputValue+",")!=-1){g.setValue(true)}})}else{if(e==3){Ext.getCmp("month1").setValue(true);Ext.getCmp("dayNum1").setValue(a.value)}else{Ext.getCmp("month2").setValue(true);Ext.getCmp("weekNum1").setValue(a.value);Ext.getCmp("weekNum2").setValue(a.weekOf)}}}}else{this.whereField.items.each(function(g){g.setValue(false)})}},isValidate:function(){if(!this.whereField.getValue()){alert("您的重复条件未选择，请先选择！");return false}var a=this.whereField.getValue().inputValue;if(a==1){if(Ext.getCmp("dayNum").getValue()<=0){alert("您的频率天数未输入！");return false}}else{if(a==2){var b=false;this.weekField.items.each(function(c){if(c.getValue()==true){b=true}});if(!b){alert("您的频率周期未选择！");return false}}else{if(Ext.getCmp("month1").getValue()==false&&Ext.getCmp("month2").getValue()==false){alert("您选择的按月的频率未设置！");return false}if(Ext.getCmp("month1").getValue()==true){if(Ext.getCmp("dayNum1").getValue()<=0){alert("您的月频率未设置！");return false}}if(Ext.getCmp("month2").getValue()==true){if(Ext.getCmp("weekNum1").getValue==""){alert("您的月频率未设置！");return false}if(Ext.getCmp("weekNum2").getValue==""){alert("您的月频率未设置！");return false}}}}return true},isDirty:function(){var a=false;if(this.rendered&&!this.disabled){this.items.each(function(b){if(b.isDirty()){a=true;return false}})}return a},onDisable:function(){this.delegateFn("disable")},onEnable:function(){this.delegateFn("enable")},reset:function(){this.delegateFn("reset")},delegateFn:function(a){this.items.each(function(b){if(b[a]){b[a]()}})},beforeDestroy:function(){Ext.destroy(this.fieldCt);Ext.calendar.DateRepeatField.superclass.beforeDestroy.call(this)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.reg("repeatfield",Ext.calendar.DateRepeatField);var colorList={colors:[{id:1,title:"蓝色"},{id:2,title:"绿色"},{id:3,title:"其它"}]};var weekOfList={weeks:[{id:1,title:"星期日"},{id:2,title:"星期一"},{id:3,title:"星期二"},{id:4,title:"星期三"},{id:5,title:"星期四"},{id:6,title:"星期五"},{id:7,title:"星期六"}]};var weekOfNoList={nums:[{id:1,title:"第一个"},{id:2,title:"第二个"},{id:3,title:"第三个"},{id:4,title:"第四个"}]};var remindList={reminders:[{id:240,title:"4个小时"},{id:480,title:"8个小时"},{id:720,title:"12个小时"},{id:960,title:"16个小时"},{id:1200,title:"20个小时"},{id:1440,title:"24个小时"}]};Ext.calendar.DateTimeField=Ext.extend(Ext.form.Field,{fromText:"开始时间",toText:"结束时间",timeSplit:":",readOnly:false,onRender:function(b,a){if(!this.el){this.startDate=new Ext.form.DateField({id:this.id+"-start-date",format:"Y-m-d",minValue:new Date(),width:100,readOnly:this.readOnly});this.startHour=new Ext.form.NumberField({id:this.id+"-start-time-hour",labelWidth:0,hideLabel:true,width:25});this.startMinute=new Ext.form.NumberField({id:this.id+"-start-time-minute",fieldLabel:this.timeSplit,labelWidth:10,width:25});this.endHour=new Ext.form.NumberField({id:this.id+"-end-time-hour",labelWidth:0,hideLabel:true,width:25});this.endMinute=new Ext.form.NumberField({id:this.id+"-end-time-minute",fieldLabel:this.timeSplit,labelWidth:10,width:25});this.fromLabel=new Ext.form.Label({style:"margin-top:5px;",id:this.id+"-from-label",text:this.fromText});this.fromSplit=new Ext.form.Label({style:"margin-top:5px;",id:this.id+"-from-split-label",text:this.timeSplit});this.toLabel=new Ext.form.Label({style:"margin-top:5px;",id:this.id+"-to-label",text:this.toText});this.toSplit=new Ext.form.Label({style:"margin-top:5px;",id:this.id+"-to-split-label",text:this.timeSplit});Ext.applyIf(this.formLabel,this.defaults);Ext.applyIf(this.toLabel,this.defaults);Ext.applyIf(this.fromSplit,this.defaults);Ext.applyIf(this.toSplit,this.defaults);this.fieldCt=new Ext.Container({autoEl:{id:this.id},cls:"ext-dt-range",renderTo:b,layout:"hbox",items:[this.startDate,this.fromLabel,this.startHour,this.fromSplit,this.startMinute,this.toLabel,this.endHour,this.toSplit,this.endMinute]});this.fieldCt.ownerCt=this;this.el=this.fieldCt.getEl();this.items=new Ext.util.MixedCollection();this.items.addAll([this.startDate,this.fromLabel,this.startHour,this.fromSplit,this.startMinute,this.toLabel,this.endHour,this.toSplit,this.endMinute])}Ext.calendar.DateTimeField.superclass.onRender.call(this,b,a)},getValue:function(){return{start:this.getDT("start"),end:this.getDT("end")}},getDT:function(h){var c=this.startDate.getValue();if(Ext.isDate(c)){c=c.format(this["startDate"].format)}else{return null}var a=this[h+"Hour"].getValue(),a=a.lpadding(2);var g=this[h+"Minute"].getValue(),g=g.lpadding(2);var e=a+this.timeSplit+g;var b=Date.parseDate(c+" "+e+":00","Y-m-d H:i:s");return b},setValue:function(a){if(a&&a.start){this.setDT(a.start,"start");this.setDT(a.end,"end")}},setReadOnly:function(a){this.readOnly=a;this.startDate.setReadOnly(a)},setDT:function(a,c){if(a&&Ext.isDate(a)){this.startDate.setValue(a);var b=a.format("H:i").split(":");this[c+"Hour"].setValue(b[0].lpadding(2));this[c+"Minute"].setValue(b[1].lpadding(2));return true}},isDirty:function(){var a=false;if(this.rendered&&!this.disabled){this.items.each(function(b){if(b.isDirty()){a=true;return false}})}return a},onDisable:function(){this.delegateFn("disable")},onEnable:function(){this.delegateFn("enable")},reset:function(){this.delegateFn("reset")},delegateFn:function(a){this.items.each(function(b){if(b[a]){b[a]()}})},beforeDestroy:function(){Ext.destroy(this.fieldCt);Ext.calendar.DateTimeField.superclass.beforeDestroy.call(this)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.reg("datetimefield",Ext.calendar.DateTimeField);Ext.calendar.RemindField=Ext.extend(Ext.form.Field,{startText:"在开始前",endText:"提醒",onRender:function(b,a){if(!this.el){this.checkBox=new Ext.form.Checkbox();this.checkBox.on("check",this.setStatus,this);this.reminder=new Ext.form.ComboBox({id:this.id+"-reminder-checkbox",mode:"local",width:100,disabled:true,editable:false,valueField:"id",displayField:"title",store:new Ext.data.JsonStore({root:"reminders",idProperty:"id",autoLoad:true,proxy:new Ext.data.MemoryProxy(),fields:["id","title"],data:remindList}),triggerAction:"all",typeAhead:true,selectOnFocus:true,forceSelection:true});this.startLabel=new Ext.form.Label({style:"margin-top:5px;",id:this.id+"-start-label",text:this.startText});this.endLabel=new Ext.form.Label({style:"margin-top:5px;",id:this.id+"-end-label",text:this.endText});Ext.applyIf(this.formLabel,this.defaults);Ext.applyIf(this.toLabel,this.defaults);this.fieldCt=new Ext.Container({autoEl:{id:this.id},cls:"ext-dt-range",renderTo:b,layout:"hbox",items:[this.checkBox,this.startLabel,this.reminder,this.endLabel]});this.fieldCt.ownerCt=this;this.el=this.fieldCt.getEl();this.items=new Ext.util.MixedCollection();this.items.addAll([this.checkBox,this.startLabel,this.reminder,this.endLabel])}Ext.calendar.RemindField.superclass.onRender.call(this,b,a)},setStatus:function(b,a){this.reminder.setDisabled(!a)},getValue:function(){if(this.checkBox.getValue()==true){return{hasReminder:this.checkBox.getValue()==true?"1":"0",reminder:this.reminder.getValue()}}else{return{hasReminder:0}}},setValue:function(a){if(a&&a.hasReminder){this.checkBox.setValue(a.hasReminder=="1"?true:false);this.reminder.setValue(a.reminder)}},setReadOnly:function(a){this.checkBox.setReadOnly(a);this.reminder.setReadOnly(a)},isDirty:function(){var a=false;if(this.rendered&&!this.disabled){this.items.each(function(b){if(b.isDirty()){a=true;return false}})}return a},onDisable:function(){this.delegateFn("disable")},onEnable:function(){this.delegateFn("enable")},reset:function(){this.delegateFn("reset")},delegateFn:function(a){this.items.each(function(b){if(b[a]){b[a]()}})},beforeDestroy:function(){Ext.destroy(this.fieldCt);Ext.calendar.RemindField.superclass.beforeDestroy.call(this)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.reg("remindfield",Ext.calendar.RemindField);Ext.calendar.RepeatScopeField=Ext.extend(Ext.form.Field,{toText:"to",onRender:function(b,a){if(!this.el){this.dayField=new Ext.form.CompositeField({disabled:this.disabled,items:[{xtype:"radio",id:"sd1",name:"startDates",boxLabel:"开始日期"},{xtype:"datefield",id:"startDate1",width:90,format:"Y-m-d",minValue:new Date()},{xtype:"displayfield",value:"重复次数",style:"margin-top:2px;",width:50},{xtype:"numberfield",width:90,id:"endDate1"}]});this.dateField=new Ext.form.CompositeField({disabled:this.disabled,items:[{xtype:"radio",id:"sd2",name:"startDates",boxLabel:"开始日期 "},{xtype:"datefield",id:"startDate2",minValue:new Date(),vtype:"daterange",endDateField:"endDate2",width:90,format:"Y-m-d"},{xtype:"displayfield",value:"结束日期",style:"margin-top:2px;",width:50},{xtype:"datefield",width:90,id:"endDate2",vtype:"daterange",startDateField:"startDate2",format:"Y-m-d"}]});this.fieldCt=new Ext.Container({autoEl:{id:this.id},cls:"ext-dt-range",renderTo:b,layout:"column",height:45,defaults:{hideParent:true},items:[{columnWidth:1,baseCls:"x-plain",items:[this.dayField,this.dateField]}]});this.fieldCt.ownerCt=this;this.el=this.fieldCt.getEl();this.items=new Ext.util.MixedCollection();this.items.addAll([this.dayField,this.dateField])}Ext.calendar.RepeatScopeField.superclass.onRender.call(this,b,a)},getValue:function(){return(Ext.getCmp("sd1").getValue()==true?{RepeatStart:Ext.getCmp("startDate1").getValue().format("Y-m-d"),RepeatNum:Ext.getCmp("endDate1").getValue(),RepeatEnd:null}:(Ext.getCmp("sd2").getValue()==true?{RepeatStart:Ext.getCmp("startDate2").getValue().format("Y-m-d"),RepeatNum:"",RepeatEnd:Ext.getCmp("endDate2").getValue().format("Y-m-d")}:null))},setValue:function(a){if(a&&a.start){if(a.num&&a.num>0){Ext.getCmp("sd1").setValue(true);Ext.getCmp("startDate1").setValue(a.start.substring(0,10));Ext.getCmp("endDate1").setValue(a.num)}else{Ext.getCmp("sd2").setValue(true);Ext.getCmp("startDate2").setValue(a.start.substring(0,10));Ext.getCmp("endDate2").setValue(a.end.substring(0,10))}}else{this.items.each(function(b){b.setValue("")})}},isDirty:function(){var a=false;if(this.rendered&&!this.disabled){this.items.each(function(b){if(b.isDirty()){a=true;return false}})}return a},onDisable:function(){this.delegateFn("disable")},onEnable:function(){this.delegateFn("enable")},reset:function(){this.delegateFn("reset")},delegateFn:function(a){this.items.each(function(b){if(b[a]){b[a]()}})},isValidate:function(){if(Ext.getCmp("sd1").getValue()==false&&Ext.getCmp("sd2").getValue()==false){alert("重复范围必须选择一个！");return false}if(Ext.getCmp("sd1").getValue()==true){if(Ext.getCmp("startDate1").getValue()==""){alert("开始日期不能为空！");Ext.getCmp("startDate1").focus();return false}if(Ext.getCmp("endDate1").getValue()==""||Ext.getCmp("endDate1").getValue()<=0){alert("重复次数必须为一个大于零的数值！");Ext.getCmp("endDate1").focus();return false}}if(Ext.getCmp("sd2").getValue()==true){if(Ext.getCmp("startDate2").getValue()==""){alert("开始日期不能为空！");Ext.getCmp("startDate2").focus();return false}if(Ext.getCmp("endDate2").getValue()==""){alert("结束日期不能为空！");Ext.getCmp("endDate2").focus();return false}}return true},beforeDestroy:function(){Ext.destroy(this.fieldCt);Ext.calendar.RepeatScopeField.superclass.beforeDestroy.call(this)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.reg("scopefield",Ext.calendar.RepeatScopeField);Ext.ButtonDatePicker=Ext.extend(Ext.Button,{format:"Y-m-d",initComponent:function(){this.text="　"+new Date().format(this.format)+"　";this.menu=new Ext.menu.DateMenu({hideOnClick:false,focusOnSelect:false});this.menuEvents("on");Ext.ButtonDatePicker.superclass.initComponent.call(this);this.addEvents("select")},menuEvents:function(a){this.menu[a]("select",this.onSelect,this)},onSelect:function(a,b){this.setText("　"+b.format("Y-m-d")+"　");this.fireEvent("select",this,b);this.menu.hide()}});Ext.reg("buttondatepicker",Ext.ButtonDatePicker);Ext.calendar.EventRepeatGrid=Ext.extend(Ext.grid.GridPanel,{width:200,height:120,columnLines:true,params:{},stripeRows:true,initComponent:function(){var b=new Ext.data.Record.create([{name:"id",type:"int"},{name:"name",type:"string",mapping:"course.name"},{name:"start",type:"string",mapping:"startTime"},{name:"end",type:"string",mapping:"endTime"}]);var a=new Ext.data.JsonReader({idProperty:"id"},b);this.store=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"clubShift!findGroup.asp"}),reader:a});this.store.on("beforeload",this.handlerParam,this);this.sm=new Ext.grid.CheckboxSelectionModel();this.cm=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:[new Ext.grid.RowNumberer({width:30}),this.sm,{id:"name",header:"课程名称",dataIndex:"name",width:200},{id:"start",header:"开始时间",dataIndex:"start",width:200},{id:"end",header:"结束时间",dataIndex:"end",width:200}]});Ext.calendar.EventRepeatGrid.superclass.initComponent.call(this)},handlerParam:function(a,b){Ext.apply(a.baseParams,this.params)},setParams:function(a){this.params=a;this.store.reload()},onClean:function(){this.store.removeAll()},getRecords:function(){return this.getSelectionModel().getSelections()},getJsons:function(){var a=this.getSelectionModel().getSelections();if(a.length>0){var c="";for(var b=0;b<a.length;b++){obj=a[b].data;if(b>0){c+="&"}c+="ids="+obj.id}return c}return""}});Ext.reg("eventrepeatgrid",Ext.calendar.EventRepeatGrid);Ext.calendar.EventMappings={EventId:{name:"EventId",mapping:"id",type:"int"},Place:{name:"Place",mapping:"place",type:"string"},MemberId:{name:"MemberId",mapping:"member.id",type:"int"},MemberName:{name:"MemberName",mapping:"member.name",type:"string"},Color:{name:"Color",mapping:"color",type:"string"},CourseName:{name:"CourseName",mapping:"courseInfo.name",type:"string"},CourseId:{name:"CourseId",mapping:"courseInfo.id",type:"int"},CoachId:{name:"CoachId",mapping:"coach.id",type:"int"},CoachName:{name:"CoachName",mapping:"coach.name",type:"string"},Intensity:{name:"Intensity",mapping:"courseInfo.intensity",type:"string"},Costs:{name:"Costs",mapping:"costs",type:"string"},MemberPrice:{name:"MemberPrice",mapping:"memberPrice",type:"float"},HourPrice:{name:"HourPrice",mapping:"hourPrice",type:"float"},JoinNum:{name:"JoinNum",mapping:"joinNum",type:"int"},Count:{name:"Count",mapping:"count",type:"int"},Score:{name:"Score",mapping:"grade",type:"int"},Memo:{name:"Memo",mapping:"memo",type:"string"},Type:{name:"Type",mapping:"type",type:"string"},StartDate:{name:"StartDate",mapping:"startDate",type:"date",dateFormat:"c"},EndDate:{name:"EndDate",mapping:"endDate",type:"date",dateFormat:"c"},RepeatMode:{name:"RepeatMode",mapping:"mode",type:"string"},RepeatValue:{name:"RepeatValue",mapping:"value",type:"string"},RepeatWeekOf:{name:"RepeatWeekOf",mapping:"weekOf",type:"string"},RepeatWhere:{name:"RepeatWhere",mapping:"repeatWhere",type:"string"},RepeatStart:{name:"RepeatStart",mapping:"repeatStart",type:"string"},RepeatNum:{name:"RepeatNum",mapping:"repeatNum",type:"int"},RepeatEnd:{name:"RepeatEnd",mapping:"repeatEnd",type:"string"},HasReminder:{name:"HasReminder",mapping:"hasReminder",type:"string"},Reminder:{name:"Reminder",mapping:"reminder",type:"string"},GroupBy:{name:"GroupBy",mapping:"groupBy",type:"int"},IsAllDay:{name:"IsAllDay",mapping:"ad",type:"boolean"},CanEdit:{name:"CanEdit",mapping:"canEdit",type:"int"},CanJoin:{name:"CanJoin",mapping:"canJoin",type:"int"},CanDel:{name:"CanDel",mapping:"canDel",type:"int"},UIType:{name:"UIType",mapping:"uiType",type:"int"}};(function(){var a=Ext.calendar.EventMappings;Ext.calendar.EventRecord=Ext.data.Record.create([a.EventId,a.Place,a.MemberId,a.MemberName,a.Color,a.CourseName,a.CourseId,a.CoachName,a.CoachId,a.Intensity,a.Costs,a.MemberPrice,a.HourPrice,a.JoinNum,a.Count,a.Score,a.Memo,a.Type,a.StartDate,a.EndDate,a.RepeatMode,a.RepeatValue,a.RepeatWeekOf,a.RepeatStart,a.RepeatNum,a.RepeatEnd,a.HasReminder,a.Reminder,a.IsAllDay,a.GroupBy,a.CanEdit,a.CanJoin,a.CanDel,a.UIType]);Ext.calendar.EventRecord.reconfigure=function(){Ext.calendar.EventRecord=Ext.data.Record.create([a.EventId,a.Place,a.MemberId,a.MemberName,a.Color,a.CourseName,a.CourseId,a.CoachName,a.CoachId,a.Intensity,a.Costs,a.MemberPrice,a.HourPrice,a.JoinNum,a.Count,a.Score,a.Memo,a.StartDate,a.EndDate,a.Type,a.RepeatMode,a.RepeatValue,a.RepeatWeekOf,a.RepeatStart,a.RepeatNum,a.RepeatEnd,a.HasReminder,a.Reminder,a.IsAllDay,a.GroupBy,a.CanEdit,a.CanJoin,a.CanDel,a.UIType])}})();Ext.calendar.CostField=Ext.extend(Ext.form.Field,{startText:"非会员价：",onRender:function(b,a){if(!this.el){this.priceField=new Ext.form.NumberField({width:100}),this.priceField1=new Ext.form.NumberField({width:100});this.label=new Ext.form.Label({text:this.startText,style:"margin-top:2px;"});this.fieldCt=new Ext.Container({autoEl:{id:this.id},cls:"ext-dt-range",renderTo:b,layout:"hbox",items:[this.priceField,this.label,this.priceField1]});this.fieldCt.ownerCt=this;this.el=this.fieldCt.getEl();this.items=new Ext.util.MixedCollection();this.items.addAll([this.priceField,this.label,this.priceField1])}Ext.calendar.CostField.superclass.onRender.call(this,b,a)},getValue:function(){return{memberPrice:this.priceField.getValue(),hourPrice:this.priceField1.getValue()}},setValue:function(a){if(a&&Ext.isObject(a)){this.priceField.setValue(a.memberPrice);this.priceField1.setValue(a.hourPrice)}},setReadOnly:function(a){this.priceField.setReadOnly(a);this.priceField1.setReadOnly(a)},isDirty:function(){var a=false;if(this.rendered&&!this.disabled){this.items.each(function(b){if(b.isDirty()){a=true;return false}})}return a},onDisable:function(){this.delegateFn("disable")},onEnable:function(){this.delegateFn("enable")},reset:function(){this.delegateFn("reset")},delegateFn:function(a){this.items.each(function(b){if(b[a]){b[a]()}})},beforeDestroy:function(){Ext.destroy(this.fieldCt);Ext.calendar.CostField.superclass.beforeDestroy.call(this)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.reg("costfield",Ext.calendar.CostField);Ext.calendar.EmpNumField=Ext.extend(Ext.form.Field,{joinText:"已预约人数：",onRender:function(b,a){if(!this.el){this.countField=new Ext.form.NumberField({width:100}),this.joinField=new Ext.form.NumberField({width:100});this.label=new Ext.form.Label({text:this.joinText,style:"margin-top:2px;"});this.fieldCt=new Ext.Container({autoEl:{id:this.id},cls:"ext-dt-range",renderTo:b,layout:"hbox",items:[this.countField,this.label,this.joinField]});this.fieldCt.ownerCt=this;this.el=this.fieldCt.getEl();this.items=new Ext.util.MixedCollection();this.items.addAll([this.countField,this.label,this.joinField])}Ext.calendar.EmpNumField.superclass.onRender.call(this,b,a)},getValue:function(){return{count:this.countField.getValue(),joinNum:this.joinField.getValue()}},setValue:function(a){if(a&&Ext.isObject(a)){this.countField.setValue(a.count);this.joinField.setValue(a.joinNum)}},setReadOnly:function(a){this.countField.setReadOnly(a);this.joinField.setReadOnly(a)},isDirty:function(){var a=false;if(this.rendered&&!this.disabled){this.items.each(function(b){if(b.isDirty()){a=true;return false}})}return a},onDisable:function(){this.delegateFn("disable")},onEnable:function(){this.delegateFn("enable")},reset:function(){this.delegateFn("reset")},delegateFn:function(a){this.items.each(function(b){if(b[a]){b[a]()}})},beforeDestroy:function(){Ext.destroy(this.fieldCt);Ext.calendar.EmpNumField.superclass.beforeDestroy.call(this)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn});Ext.reg("empfield",Ext.calendar.EmpNumField);Ext.BLANK_IMAGE_URL="images/s.gif";Ext.calendar.MainPanel=Ext.extend(Ext.Panel,{renderTo:"calendar-ct",layout:"border",height:500,activeItem:1,role:{current:"M"},funcs:{},parameter:{},workDays:"2,3,4,5,6",workTimes:"07:00,08:00,09:00,10:00,11:00,12:00,14:00,15:00,16:00,17:00,18:00,19:00,20:00",initComponent:function(){var a=this;if(!a.role.access){a.listUrl="course!findCalendar.asp";a.delUrl="course!delete.asp";a.saveUrl="course!save.asp";a.courseStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"mycourse!findCourse.asp"}),reader:new Ext.data.JsonReader({root:null,idProperty:null,totalProperty:null},[{name:"id",type:"int"},{name:"name",type:"string"},{name:"charge",type:"string"}])});a.memberStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"member!findMember.asp"}),reader:new Ext.data.JsonReader({root:null,idProperty:null,totalProperty:null},[{name:"id",type:"int"},{name:"nick",type:"string",mapping:"name"}])})}else{a.listUrl="coursewindow!findCalendar.asp";a.delUrl="coursewindow!delete.asp";a.saveUrl="coursewindow!save.asp";a.courseStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"mycourse!findCourseBy.asp"}),reader:new Ext.data.JsonReader({root:null,idProperty:null,totalProperty:null},[{name:"id",type:"int"},{name:"name",type:"string"},{name:"charge",type:"string"}])});a.memberStore=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"member!findCoach.asp"}),reader:new Ext.data.JsonReader({root:null,idProperty:null,totalProperty:null},[{name:"id",type:"int"},{name:"nick",type:"string",mapping:"name"}])})}a.eventStore=new Ext.data.JsonStore({id:"eventStore",root:"evts",idProperty:"id",url:this.listUrl,fields:Ext.calendar.EventRecord.prototype.fields.getRange()});this.calendarPanel=new Ext.calendar.CalendarPanel({eventStore:this.eventStore,border:false,id:"app-calendar",region:"center",canDrag:this.funcs.canDrag,activeItem:this.activeItem,showTime:true,parameter:this.parameter,workDays:this.workDays,workTimes:this.workTimes,monthViewCfg:{showHeader:true,showWeekLinks:true,showWeekNumbers:true}});this.calendarPanel.on("eventclick",this.onEventClick,this);this.calendarPanel.on("viewchange",this.onViewChange,this);this.calendarPanel.on("dayclick",this.onDayClick,this);this.calendarPanel.on("rangeselect",this.onRangeSelect,this);if(this.funcs.canEdit===true){this.calendarPanel.on("eventmove",this.onEventMove,this);this.calendarPanel.on("eventresize",this.onEventResize,this);this.calendarPanel.on("initdrag",this.onInitDrag,this)}this.calendarPanel.on("eventdelete",this.onEventDelete,this);this.items=[this.calendarPanel];Ext.calendar.MainPanel.superclass.initComponent.call(this)},onEventClick:function(b,c,a){if(this.editWin){this.editWin.destroy();this.editWin=null}this.showEditWindow(c,a)},onViewChange:function(c,a,b){if(this.editWin){this.editWin.close()}},initialize:function(){if(this.editWin){this.editWin.destroy();this.editWin=null}this.calendarPanel.setStartDate(new Date())},onDayClick:function(e,c,b,a){if(e.isHead&&e.isHead==true){this.calendarPanel.setCurrentDate(c)}else{if(this.workTimes.indexOf(c.format("H:i"))>=0&&this.workDays.indexOf(c.format("w")+1)>=0){if(this.editWin){this.editWin.destroy();this.editWin=null}this.showEditWindow({StartDate:c,IsAllDay:b},a)}}},onRangeSelect:function(h,g,e){var c=g.StartDate;var a=c.format("Hi");var b=c.format("w")+1;if(this.hasPermission()&&this.isValids(a)&&this.workDays.indexOf(b)>=0){if(this.editWin){this.editWin.destroy();this.editWin=null}this.showEditWindow(g);this.editWin.on("close",e,this,{single:true})}else{e();return}},isValids:function(a){var g=this.workTimes.split(","),c,e;for(var b=0;b<g.length;b++){c=g[b].replace(":","");if(b+1<g.length){e=g[b+1].replace(":","");if((e-c)<=100&&a>=c&&a<=e){return true}}}return false},hasPermission:function(){if(this.funcs.canEdit===true){return true}return false},onEventMove:function(a,b){if(this.funcs.canEdit===true){this.saveData(b)}},onEventResize:function(a,b){if(this.funcs.canEdit===true){this.saveData(b)}},onEventDelete:function(a,b){this.eventStore.remove(b);if(a.isVisible()){a.destroy()}},onInitDrag:function(a){if(this.editWin&&this.editWin.isVisible()){this.editWin.destroy()}},saveData:function(b){var a=this.getParams(b);Ext.Ajax.request({method:"post",url:this.saveUrl,params:a,scope:this,success:function(c){b.commit()}})},setParameter:function(b){for(var a in b){this.parameter[a]=b[a]}this.calendarPanel.setParameter(this.parameter)},getParams:function(c){var e=Ext.calendar.EventMappings,a="";if(c){for(var b in c.data){if(e[b]){if(b=="StartDate"){a+="course.startTime="+c.get(b).format("H:i")+"&"}else{if(b=="EndDate"){a+="course.endTime="+c.get(b).format("H:i")+"&"}else{a+="course."+e[b].mapping+"="+c.get(b)+"&"}}}}a+="course.planDate="+c.get("StartDate").format("Y-m-d")}return a},showEditWindow:function(g,e){var i=Ext.calendar.EventMappings,c=this;if(!g||!g.data){if(c.funcs.canEdit!==true&&c.funcs.canAdd!=true){return}var h=g[i.StartDate.name],b=g[i.EndDate.name]||h.add("h",1);g=new Ext.calendar.EventRecord();g.data[i.StartDate.name]=h;g.data[i.EndDate.name]=b;g.data[i.GroupBy.name]=0;g.data[i.Type.name]=0;g.data[i.CoachId.name]=c.parameter.toMember||c.parameter.coachId;g.data[i.Place.name]=c.parameter.place;g.data[i.MemberId.name]=c.parameter.memberId;g.data[i.CanEdit.name]=1;g.data[i.CanJoin.name]=0;g.data[i.CanDel.name]=1;if(c.role.access){if(c.role.current.role==="M"){if(c.role.access.role==="S"){g.data[i.UIType.name]=1;g.data[i.CoachName.name]=c.role.access.nick}}}else{if(c.role.current.role==="S"){g.data[i.UIType.name]=2}else{if(c.role.current.role==="E"){g.data[i.UIType.name]=3}}}}var a=0;if(g.get(i.GroupBy.name)>0&&(c.funcs.canEdit===true)){if(confirm("该课程是批次课程，您现在是需要编辑本次课程还是整批次课程？\n如果您需要编辑整批次课程，请点击【确定】按钮！\n否则请点击【取消】按钮！")){a=1}}c.editWin=new Ext.calendar.EventEditWindow({role:c.role,funcs:c.funcs,courseStore:c.courseStore,coachStore:c.coachStore,memberStore:c.memberStore,url:{saveUrl:c.saveUrl,delUrl:c.delUrl},handlerType:a,activeRecord:g,parent:c});c.editWin.on("eventadd",c.onEventAdd,c);c.editWin.on("eventupdate",c.onEventUpdate,c);c.editWin.on("eventdelete",c.onEventDelete,c);c.editWin.show(g,e)},onEventAdd:function(a,b){a.destroy();this.eventStore.add(b)},onEventUpdate:function(a,b){a.destroy();b.commit()},destroy:function(){Ext.calendar.MainPanel.superclass.destroy.call(this);if(this.editWin){this.editWin.destroy()}}});Ext.calendar.EventEditWindow=Ext.extend(Ext.Window,{titleTextAdd:"新增课程安排",titleTextEdit:"课程预约",titleTextView:"课程安排查看",url:{},funcs:{},role:{},width:460,autoHeight:true,autocreate:true,border:true,closeAction:"close",modal:false,resizable:false,buttonAlign:"left",savingMessage:"Saving changes...",deletingMessage:"Deleting event...",modified:false,courseStore:null,coachStore:null,memberStore:null,handlerType:0,parent:null,activeRecord:null,initComponent:function(){var b=this;b.buttonAlign="center";var a=b.getFields();b.fbar=b.getButton();b.items=[{xtype:"form",labelWidth:70,labelAlign:"right",frame:false,bodyStyle:"background:transparent;padding:5px 10px 10px;",bodyBorder:false,border:false,defaultType:"textfield",items:a}];Ext.calendar.EventEditWindow.superclass.initComponent.call(b);b.formPanel=this.items.items[0];b.addEvents({eventadd:true,eventupdate:true,eventdelete:true,eventcancel:true,editdetails:true})},getButton:function(){var b=this,c=Ext.calendar.EventMappings,a=b.activeRecord.get(c.UIType.name);if(a===1||a===2){if(b.funcs.canAdd===true){return[{id:"see-btn",text:"查看计划",disabled:false,handler:b.onSee,scope:b},{id:"save-btn",text:"保存",disabled:false,handler:b.onSave,scope:b},{id:"delete-btn",text:"删除",disabled:false,handler:b.onDelete,scope:b,hideMode:"offsets"},{text:"关闭",disabled:false,handler:b.onClose,scope:b,hideMode:"offsets"}]}else{return[{text:"关闭",disabled:false,handler:b.onClose,scope:b,hideMode:"offsets"}]}}else{if(a===4){return[{id:"join-btn",text:"预约",disabled:false,handler:b.onJoin,scope:b},{text:"确定",disabled:false,handler:b.onClose,scope:b,hideMode:"offsets"}]}else{if(a===3){return[{id:"save-btn",text:"保存",disabled:false,handler:b.onSave,scope:b},{id:"delete-btn",text:"删除",disabled:false,handler:b.onDelete,scope:b,hideMode:"offsets"},{text:"关闭",disabled:false,handler:b.onClose,scope:b,hideMode:"offsets"}]}else{if(a===5){return[{id:"see-btn",text:"查看计划",disabled:false,handler:b.onSee,scope:b},{id:"save-btn",text:"保存",disabled:false,handler:b.onSave,scope:b},{id:"delete-btn",text:"删除",disabled:false,handler:b.onDelete,scope:b,hideMode:"offsets"},{text:"关闭",disabled:false,handler:b.onClose,scope:b,hideMode:"offsets"}]}else{if(a===6){return[{text:"取消预约",disabled:false,handler:b.onUndo1,scope:b,hideMode:"offsets"},{text:"评分",disabled:false,handler:b.onGrade,scope:b,hideMode:"offsets"},{text:"关闭",disabled:false,handler:b.onClose,scope:b,hideMode:"offsets"}]}else{if(a===7){return[{text:"取消预约",disabled:false,handler:b.onUndo2,scope:b,hideMode:"offsets"},{text:"评分",disabled:false,handler:b.onGrade,scope:b,hideMode:"offsets"},{text:"关闭",disabled:false,handler:b.onClose,scope:b,hideMode:"offsets"}]}else{if(a===8){return[{id:"join-btn",text:"预约",disabled:false,handler:b.onJoin,scope:b},{text:"关闭",disabled:false,handler:b.onClose,scope:b,hideMode:"offsets"}]}else{return[]}}}}}}}},getFields:function(){var e=Ext.calendar.EventMappings,a=this.activeRecord.get(e.UIType.name),c=this,b=c.activeRecord.get(e.EventId.name);if(a===1){return[{id:"EventId",name:"eventID",inputType:"hidden"},{id:"CourseId",fieldLabel:"课程名称",xtype:"course",store:c.courseStore,anchor:"60%",allowBlank:false},{id:"CoachName",fieldLabel:"授课教练",xtype:"textfield",anchor:"50%",readOnly:true},{id:"Intensity",fieldLabel:"运动强度",xtype:"textfield",anchor:"40%"},{id:"Costs",fieldLabel:"收费方式",xtype:"textfield",anchor:"50%"},{id:"Memo",fieldLabel:"备注",xtype:"textfield",anchor:"100%"},{id:"datetime",fieldLabel:"课程日期",xtype:"datetimefield",anchor:"100%",readOnly:true},{id:"Reminder",fieldLabel:"是否提醒",xtype:"remindfield",anchor:"100%"},{id:"Type",fieldLabel:"周期课程",xtype:"checkbox",anchor:"50%",listeners:{check:c.changeState,scope:c}},{id:"other",xtype:"fieldset",title:"课程周期",items:[{id:"repeatWhere",name:"repeat",fieldLabel:"周期条件",xtype:"repeatfield",anchor:"100%"},{id:"repeatScope",name:"repeatScope",fieldLabel:"周期范围",xtype:"scopefield",anchor:"100%"}]}]}else{if(a===2){return[{id:"EventId",inputType:"hidden"},{id:"GroupBy",inputType:"hidden"},{id:"CoachId",inputType:"hidden"},{id:"CourseId",fieldLabel:"选择课程",xtype:"course",store:c.courseStore,width:200,allowBlank:false},{id:"MemberId",fieldLabel:"选择会员",xtype:"combox",width:140,store:c.memberStore,keyName:"nick",allowBlank:false},{id:"Costs",name:"charge",fieldLabel:"收费方式",xtype:"textfield",anchor:"100%"},{id:"Place",name:"house",fieldLabel:"授课地点",xtype:"textfield",anchor:"100%"},{id:"Memo",name:"memo",fieldLabel:"备注",xtype:"textfield",anchor:"100%",allowBlank:true},{id:"datetime",name:"datetime",fieldLabel:"排课日期",xtype:"datetimefield",anchor:"100%",allowBlank:false,readOnly:true},{id:"Color",fieldLabel:"课程颜色",xtype:"colorfield",value:"#ffcc00",msgTarget:"qtip",fallback:true,width:140},{id:"Reminder",name:"reminder",fieldLabel:"是否提醒",xtype:"remindfield",anchor:"100%"},{id:"Type",fieldLabel:"周期课程",xtype:"checkbox",anchor:"50%",listeners:{check:c.changeState,scope:c}},{id:"other",xtype:"fieldset",title:"课程周期",items:[{id:"repeatWhere",name:"repeat",fieldLabel:"周期条件",xtype:"repeatfield",anchor:"100%"},{id:"repeatScope",name:"repeatScope",fieldLabel:"周期范围",xtype:"scopefield",anchor:"100%"}]}]}else{if(a===3){return[{id:"EventId",inputType:"hidden"},{id:"MemberId",inputType:"hidden"},{id:"Place",inputType:"hidden"},{id:"GroupBy",inputType:"hidden"},{id:"JoinNum",inputType:"hidden"},{id:"CourseId",fieldLabel:"选择课程",xtype:"course",store:c.courseStore,anchor:"60%",allowBlank:false},{id:"CoachId",fieldLabel:"授课教练",xtype:"combox",anchor:"50%",store:c.memberStore,keyName:"nick",allowBlank:false},{id:"Intensity",fieldLabel:"运动强度",xtype:"textfield",anchor:"100%",readOnly:true},{id:"prices",fieldLabel:"会员价(元)",xtype:"costfield",anchor:"100%"},{id:"Count",fieldLabel:"人数上限",xtype:"numberfield",anchor:"40%",allowBlank:false},{id:"Memo",fieldLabel:"备注",xtype:"textfield",anchor:"100%"},{id:"datetime",name:"datetime",fieldLabel:"排课日期",xtype:"datetimefield",anchor:"100%",allowBlank:false,readOnly:true},{id:"Color",fieldLabel:"课程颜色",xtype:"colorfield",value:"#ffcc00",msgTarget:"qtip",fallback:true,width:140},{id:"Reminder",fieldLabel:"是否提醒",xtype:"remindfield",anchor:"100%"},{id:"Type",fieldLabel:"周期课程",xtype:"checkbox",anchor:"50%",listeners:{check:c.changeState,scope:c}},{id:"other",xtype:"fieldset",title:"课程周期",items:[{id:"repeatWhere",name:"repeat",fieldLabel:"周期条件",xtype:"repeatfield",anchor:"100%",disabled:true},{id:"repeatScope",name:"repeatScope",fieldLabel:"周期范围",xtype:"scopefield",anchor:"100%",disabled:true}]}]}else{if(a===4){return[{id:"EventId",inputType:"hidden"},{id:"CourseName",fieldLabel:"课程名称",anchor:"60%",allowBlank:false},{id:"CoachName",fieldLabel:"教练昵称",anchor:"50%",allowBlank:false},{id:"Intensity",fieldLabel:"运动强度",xtype:"textfield",anchor:"100%",readOnly:true},{id:"prices",fieldLabel:"会员价（元）",xtype:"costfield",anchor:"100%"},{id:"Count",fieldLabel:"人数上限",xtype:"empfield",anchor:"100%",allowBlank:false},{id:"Memo",fieldLabel:"备注",xtype:"textfield",anchor:"100%"},{id:"datetime",name:"datetime",fieldLabel:"排课日期",xtype:"datetimefield",anchor:"100%",allowBlank:false,readOnly:true},{id:"Reminder",fieldLabel:"是否提醒",xtype:"remindfield",anchor:"100%"},{id:"Score",fieldLabel:"分数",xtype:"panel",html:'<div id="divscore" data-number="0"></div>'}]}else{if(a===5){return[{id:"EventId",inputType:"hidden"},{id:"CourseName",fieldLabel:"课程名称",anchor:"60%",allowBlank:false},{id:"CoachName",fieldLabel:"授课教练",anchor:"50%",allowBlank:false},{id:"Intensity",fieldLabel:"运动强度",xtype:"textfield",anchor:"100%",readOnly:true},{id:"prices",fieldLabel:"会员价（元）",xtype:"costfield",anchor:"100%"},{id:"Count",fieldLabel:"人数上限",xtype:"numberfield",anchor:"40%",allowBlank:false},{id:"Memo",fieldLabel:"备注",xtype:"textfield",anchor:"100%"},{id:"datetime",name:"datetime",fieldLabel:"排课日期",xtype:"datetimefield",anchor:"100%",allowBlank:false,readOnly:true},{id:"Reminder",fieldLabel:"是否提醒",xtype:"remindfield",anchor:"100%"},{id:"Type",fieldLabel:"周期课程",xtype:"checkbox",anchor:"50%",listeners:{check:c.changeState,scope:c}},{id:"other",xtype:"fieldset",title:"课程周期",items:[{id:"repeatWhere",name:"repeat",fieldLabel:"周期条件",xtype:"repeatfield",anchor:"100%",disabled:true},{id:"repeatScope",name:"repeatScope",fieldLabel:"周期范围",xtype:"scopefield",anchor:"100%",disabled:true}]}]}else{if(a===6){return[{id:"EventId",inputType:"hidden"},{id:"MemberId",inputType:"hidden"},{id:"CourseName",fieldLabel:"课程名称",anchor:"60%",allowBlank:false},{id:"CoachName",fieldLabel:"教练昵称",anchor:"100%",allowBlank:false},{id:"Intensity",fieldLabel:"运动强度",xtype:"textfield",anchor:"100%",readOnly:true},{id:"prices",fieldLabel:"会员价（元）",xtype:"costfield",anchor:"100%"},{id:"Count",fieldLabel:"人数上限",xtype:"empfield",anchor:"100%",allowBlank:false},{id:"Memo",fieldLabel:"备注",xtype:"textfield",anchor:"100%"},{id:"datetime",name:"datetime",fieldLabel:"排课日期",xtype:"datetimefield",anchor:"100%",allowBlank:false,readOnly:true},{id:"Reminder",fieldLabel:"是否提醒",xtype:"remindfield",anchor:"100%"},{id:"Score",fieldLabel:"分数",xtype:"panel",html:'<div id="divscore" data-number="5"></div>'},{id:"Appriase",fieldLabel:"评价内容",xtype:"textarea",anchor:"100%"}]}else{if(a===7){return[{id:"EventId",inputType:"hidden"},{id:"GroupBy",inputType:"hidden"},{id:"CoachId",inputType:"hidden"},{id:"MemberId",inputType:"hidden"},{id:"CourseName",fieldLabel:"选择课程",xtype:"textfield",width:200,allowBlank:false},{id:"CoachName",fieldLabel:"教练",xtype:"textfield",anchor:"100%"},{id:"Costs",name:"costs",fieldLabel:"收费方式",xtype:"textfield",anchor:"100%",readOnly:b&&b>0?true:false},{id:"Place",name:"place",fieldLabel:"授课地点",xtype:"textfield",anchor:"100%",allowBlank:false,readOnly:b&&b>0?true:false},{id:"Memo",fieldLabel:"备注",xtype:"textfield",anchor:"100%"},{id:"datetime",name:"datetime",fieldLabel:"排课日期",xtype:"datetimefield",anchor:"100%",allowBlank:false,readOnly:true},{id:"Color",fieldLabel:"课程颜色",xtype:"colorfield",value:"#ffcc00",msgTarget:"qtip",fallback:true,width:140},{id:"Reminder",name:"reminder",fieldLabel:"是否提醒",xtype:"remindfield",anchor:"100%"},{id:"Score",fieldLabel:"分数",xtype:"panel",html:'<div id="divscore" data-number="5"></div>'},{id:"Appriase",fieldLabel:"评价内容",xtype:"textarea",anchor:"100%"}]}else{if(a===8){return[{id:"EventId",inputType:"hidden"},{id:"MemberId",inputType:"hidden"},{id:"CourseName",fieldLabel:"课程名称",anchor:"60%",allowBlank:false},{id:"CoachName",fieldLabel:"教练昵称",anchor:"100%",allowBlank:false},{id:"Intensity",fieldLabel:"运动强度",xtype:"textfield",anchor:"100%",readOnly:true},{id:"prices",fieldLabel:"会员价(元)",xtype:"costfield",anchor:"100%"},{id:"Count",fieldLabel:"人数上限",xtype:"empfield",anchor:"100%",allowBlank:false},{id:"Memo",fieldLabel:"备注",xtype:"textfield",anchor:"100%"},{id:"datetime",name:"datetime",fieldLabel:"排课日期",xtype:"datetimefield",anchor:"100%",allowBlank:false,readOnly:true},{id:"Reminder",fieldLabel:"是否提醒",xtype:"remindfield",anchor:"100%"}]}}}}}}}}},afterRender:function(){Ext.calendar.EventEditWindow.superclass.afterRender.call(this);this.el.addClass("ext-cal-event-win")},onRepeat:function(){Ext.getCmp("other").show()},changeState:function(c,e){Ext.getCmp("repeatWhere").setDisabled(!e);Ext.getCmp("repeatScope").setDisabled(!e);var a=Ext.getCmp("repeatWhere").getValue();if(a==null||!a||!a.mode){a={mode:1,value:1};Ext.getCmp("repeatWhere").setValue(a)}var b=Ext.getCmp("repeatScope").getValue();if(b==null||!b||!b.start){b={start:Ext.getCmp("datetime").getValue().start.format("Y-m-d"),num:7};Ext.getCmp("repeatScope").setValue(b)}},show:function(g,e){var c=(Ext.isIE8&&Ext.isStrict)?null:e;Ext.calendar.EventEditWindow.superclass.show.call(this,c,function(){});var g,i=Ext.calendar.EventMappings;f=this.formPanel.form;f.reset();if(g.data[i.EventId.name]){this.setTitle(this.titleTextEdit)}else{this.setTitle(this.titleTextAdd)}Ext.getCmp("datetime").setValue({start:g.data[i.StartDate.name],end:g.data[i.EndDate.name]});if(Ext.getCmp("prices")){Ext.getCmp("prices").setValue({memberPrice:g.data[i.MemberPrice.name],hourPrice:g.data[i.HourPrice.name]})}if(Ext.getCmp("Reminder")){Ext.getCmp("Reminder").setValue({hasReminder:g.get(i.HasReminder.name),reminder:g.get(i.Reminder.name)})}f.loadRecord(g);if(g.get(i.Type.name)==1){var a={mode:g.get(i.RepeatMode.name),value:g.get(i.RepeatValue.name),weekOf:g.get(i.RepeatWeekOf.name)};if(Ext.getCmp("repeatWhere")){Ext.getCmp("repeatWhere").setValue(a)}var b={start:g.get(i.RepeatStart.name),num:g.get(i.RepeatNum.name),end:g.get(i.RepeatEnd.name)};if(Ext.getCmp("repeatScope")){Ext.getCmp("repeatScope").setValue(b)}}if(Ext.getCmp("Count")&&Ext.getCmp("Count").getXType()==="empfield"){Ext.getCmp("Count").setValue({count:g.data[i.Count.name],joinNum:g.data[i.JoinNum.name]})}if(Ext.getCmp("Score")){var h=g.get(i.Score.name);$("#divscore").jRating({type:"big",length:10,decimalLength:1,rateMax:100})}return this},roundTime:function(b,c){c=c||15;var a=parseInt(b.getMinutes(),10);return b.add("mi",c-(a%c))},onClose:function(){this.cleanup(true);this.fireEvent("eventcancel",this)},cleanup:function(a){if(this.activeRecord&&this.activeRecord.dirty){this.activeRecord.reject()}delete this.activeRecord;if(a===true){this.destroy()}},onUndo:function(b){var c=this,a=Ext.getCmp("EventId").getValue();var e=Ext.getCmp("datetime").getValue();Ext.Msg.confirm("提示","是否确认撤消当前课程的预约？",function(g){if(g=="yes"){Ext.Ajax.request({method:"post",url:"course!undo.asp",params:{id:a,saveType:b},scope:c,success:function(h){var i=Ext.util.JSON.decode(h.responseText);if(i.success===true){Ext.Msg.alert("提示","当前课程已经成功撤消！");c.close();c.fireEvent("eventdelete",c,c.activeRecord);c.parent.calendarPanel.setStartDate(e.start)}else{Ext.Msg.alert("提示","当前预约课程撤消失败！可能的原因为："+i.message)}}})}})},onUndo1:function(){this.onUndo(1)},onUndo2:function(){this.onUndo(2)},onGrade:function(){var c=this,e=$("#divscore").attr("rate"),a=Ext.getCmp("Appriase").getValue(),b=Ext.getCmp("EventId").getValue();Ext.Ajax.request({method:"post",url:"course!grade.asp",params:{id:b,grade:e,memo:a},scope:this,success:function(g){var h=Ext.util.JSON.decode(g.responseText);if(h.success===true){Ext.Msg.alert("提示","当前分数已经提交！");c.close()}else{Ext.Msg.alert("提示","当前分数提交失败，可能的原因为："+h.message)}}})},onJoin:function(){var b=this,a=Ext.getCmp("EventId").getValue();if(!b.role.current){b.onClose();openLogin();return}Ext.getCmp("join-btn").setDisabled(true);Ext.Ajax.request({method:"post",url:"coursewindow!onJoin.asp",params:"course.id="+a,scope:this,success:function(c){Ext.getCmp("join-btn").setDisabled(false);var e=Ext.util.JSON.decode(c.responseText);if(e.success===true){if(e.message==="pay"){window.location.href="order!submitProd.asp?prodType=5&id="+a}else{alert("您的申请已经成功提交，请等待俱乐部的审核！")}b.close()}else{if(e.message==="full"){alert("当前课程的人数已经达到上限，不能进行申请！")}else{if(e.message==="joining"){alert("您已经申请过该课程，请不要重复进行申请！")}else{if(e.message==="exist"){alert("您当前时间已经有安排的课程，请换个时间段再申请！")}else{if(e.message==="nomemeber"){alert("您还不是当前俱乐部会员，请先加入该俱乐部！")}else{alert("未知错误，请联系系统设计人员。可能的原因为："+e.message)}}}}}}})},onSee:function(){if(!this.formPanel.form.isValid()){alert("请先输入需要必填的数据后再查看计划！");return}this.updateRecord();var a="",c=Ext.calendar.EventMappings;if(this.activeRecord){for(var b in this.activeRecord.data){if(c[b]){if(b=="StartDate"){a+="course.startTime="+this.activeRecord.get(b).format("H:i")+"&"}else{if(b=="EndDate"){a+="course.endTime="+this.activeRecord.get(b).format("H:i")+"&"}else{a+="course."+c[b].mapping+"="+escape(this.activeRecord.get(b))+"&"}}}}a+="course.planDate="+this.activeRecord.get("StartDate").format("Y-m-d")}window.location.href=this.type<=3?"workout.asp?"+a:"workoutwindow.asp?"+a},updateRecord:function(){var g=this.formPanel.form,a=Ext.getCmp("datetime").getValue(),h=Ext.calendar.EventMappings,i=Ext.getCmp("Type").getValue(),e=Ext.getCmp("Reminder").getValue(),c=i===true?Ext.getCmp("repeatWhere").getValue():null,k=i===true?Ext.getCmp("repeatScope").getValue():null;g.updateRecord(this.activeRecord);for(var b in c){this.activeRecord.set(b,c[b])}for(var b in k){this.activeRecord.set(b,k[b])}this.activeRecord.set(h.Reminder.name,e.reminder?e.reminder:null);this.activeRecord.set(h.HasReminder.name,e.hasReminder);this.activeRecord.set(h.Type.name,i===true?1:0);this.activeRecord.set(h.CourseName.name,Ext.get("CourseId").dom.value);if(Ext.getCmp("CoachId")&&Ext.getCmp("CoachId").getXType()==="combox"){this.activeRecord.set(h.CoachName.name,Ext.get("CoachId").dom.value)}if(Ext.getCmp("MemberId")&&Ext.getCmp("MemberId").getXType()==="combox"){this.activeRecord.set(h.MemberName.name,Ext.get("MemberId").dom.value)}if(Ext.getCmp("prices")){var j=Ext.getCmp("prices").getValue();this.activeRecord.set(h.MemberPrice.name,j.memberPrice);this.activeRecord.set(h.HourPrice.name,j.hourPrice)}this.activeRecord.set(h.StartDate.name,a.start);this.activeRecord.set(h.EndDate.name,a.end)},onSave:function(){var a=this;if(!a.formPanel.form.isValid()){alert("请输入必须填写的栏位的数据！");return}a.updateRecord();if(!a.activeRecord.dirty){a.onClose();return}if(Ext.getCmp("Type").getValue()==true){if(!Ext.getCmp("repeatWhere").isValidate()){return}if(!Ext.getCmp("repeatScope").isValidate()){return}}Ext.getCmp("save-btn").setDisabled(true);var c=a.getParameter();var b=Ext.getCmp("datetime").getValue();c+="&saveType="+a.handlerType;Ext.Ajax.request({method:"post",url:a.url.saveUrl,params:c,scope:a,success:function(e){Ext.getCmp("save-btn").setDisabled(false);var h=Ext.util.JSON.decode(e.responseText);if(h.success===true){var g=a.activeRecord.get[Ext.calendar.EventMappings.EventId.name];a.fireEvent(g?"eventupdate":"eventadd",a,a.activeRecord);a.parent.calendarPanel.setStartDate(b.start)}else{alert(h.desc)}}})},getParameter:function(){var a="",c=Ext.calendar.EventMappings;if(this.activeRecord){for(var b in this.activeRecord.data){if(c[b]){if(b=="StartDate"){a+="course.startTime="+this.activeRecord.get(b).format("H:i")+"&"}else{if(b=="EndDate"){a+="course.endTime="+this.activeRecord.get(b).format("H:i")+"&"}else{a+="course."+c[b].mapping+"="+this.activeRecord.get(b)+"&"}}}}a+="course.planDate="+this.activeRecord.get("StartDate").format("Y-m-d")}return a},onDelete:function(){var b=this,g=Ext.getCmp("EventId").getValue();if(g==null||g==""){b.fireEvent("eventdelete",b,b.activeRecord);return}if(confirm("是否确认删除当前课程安排？")){Ext.getCmp("delete-btn").setDisabled(true);var a=b.handlerType==1?b.activeRecord.get(Ext.calendar.EventMappings.GroupBy.name):0;var e="id="+g+"&saveType="+a;var c=Ext.getCmp("datetime").getValue();Ext.Ajax.request({method:"post",url:b.url.delUrl,params:e,scope:b,success:function(h){Ext.getCmp("delete-btn").setDisabled(false);var i=h.responseText;if(i=="OK"){alert((a>0?"当前所有循环的":"当前")+"课程安排已经成功删除！");b.fireEvent("eventdelete",b,b.activeRecord);b.parent.calendarPanel.setStartDate(c.start)}else{alert("删除错误，错误原因可能为："+i)}}})}},setStatus:function(a){this.formPanel.items.each(function(g,c,b){if(!g.inputType||g.inputType!="hidden"){try{g.setDisabled(a)}catch(h){}}})}});